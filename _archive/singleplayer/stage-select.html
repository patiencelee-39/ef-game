<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é—œå¡é¸æ“‡ - åŸ·è¡ŒåŠŸèƒ½è¨“ç·´éŠæˆ²</title>
    <link rel="stylesheet" href="../css/main.css" />
    <style>
      .stage-select-container {
        max-width: 900px;
        margin: 2rem auto;
        padding: 2rem;
      }

      .difficulty-tabs {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        justify-content: center;
      }

      .difficulty-tab {
        padding: 1rem 2rem;
        border: 2px solid #ddd;
        border-radius: 8px;
        background: white;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 1.1rem;
        font-weight: bold;
      }

      .difficulty-tab:hover {
        background: #f8f9fa;
        transform: translateY(-2px);
      }

      .difficulty-tab.active {
        background: #4caf50;
        color: white;
        border-color: #4caf50;
      }

      .difficulty-tab .emoji {
        font-size: 1.5rem;
        margin-right: 0.5rem;
      }

      .stages-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .stage-card {
        background: white;
        border: 2px solid #ddd;
        border-radius: 12px;
        padding: 1.5rem;
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
      }

      .stage-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        border-color: #4caf50;
      }

      .stage-card.locked {
        background: #f8f9fa;
        cursor: not-allowed;
        opacity: 0.6;
      }

      .stage-card.locked:hover {
        transform: none;
        box-shadow: none;
      }

      .stage-card .emoji {
        font-size: 3rem;
        text-align: center;
        display: block;
        margin-bottom: 1rem;
      }

      .stage-card h3 {
        text-align: center;
        margin-bottom: 0.5rem;
        color: #333;
      }

      .stage-card .description {
        text-align: center;
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 1rem;
      }

      .stage-card .difficulty-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: bold;
      }

      .difficulty-badge.easy {
        background: #d4edda;
        color: #155724;
      }

      .difficulty-badge.medium {
        background: #fff3cd;
        color: #856404;
      }

      .difficulty-badge.hard {
        background: #f8d7da;
        color: #721c24;
      }

      .stage-card .best-score {
        text-align: center;
        margin-top: 1rem;
        font-weight: bold;
        color: #4caf50;
      }

      .stage-card .lock-icon {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 1.5rem;
      }

      .selected-stage-info {
        background: #e7f3ff;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 2rem;
        display: none;
      }

      .selected-stage-info.show {
        display: block;
      }

      .selected-stage-info h3 {
        color: #0066cc;
        margin-bottom: 1rem;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .info-item {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem;
        background: white;
        border-radius: 6px;
      }

      .action-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
      }

      .action-buttons button {
        min-width: 150px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ğŸŒŸ é—œå¡é¸æ“‡</h1>
        <p class="subtitle">é¸æ“‡æ‚¨æƒ³æŒ‘æˆ°çš„é—œå¡</p>
      </header>

      <main class="stage-select-container">
        <!-- é›£åº¦é¸æ“‡ -->
        <div class="difficulty-tabs">
          <div
            class="difficulty-tab active"
            data-difficulty="easy"
            onclick="filterByDifficulty('easy')"
          >
            <span class="emoji">ğŸŸ¢</span>
            ç°¡å–®
          </div>
          <div
            class="difficulty-tab"
            data-difficulty="medium"
            onclick="filterByDifficulty('medium')"
          >
            <span class="emoji">ğŸŸ¡</span>
            ä¸­ç­‰
          </div>
          <div
            class="difficulty-tab"
            data-difficulty="hard"
            onclick="filterByDifficulty('hard')"
          >
            <span class="emoji">ğŸ”´</span>
            å›°é›£
          </div>
          <div
            class="difficulty-tab"
            data-difficulty="all"
            onclick="filterByDifficulty('all')"
          >
            <span class="emoji">â­</span>
            å…¨éƒ¨
          </div>
        </div>

        <!-- å·²é¸é—œå¡è³‡è¨Š -->
        <div class="selected-stage-info" id="selectedInfo">
          <h3>ğŸ“‹ é—œå¡è³‡è¨Š</h3>
          <div class="info-grid">
            <div class="info-item">
              <span>é—œå¡åç¨±ï¼š</span>
              <span id="stageName">-</span>
            </div>
            <div class="info-item">
              <span>é›£åº¦ï¼š</span>
              <span id="stageDifficulty">-</span>
            </div>
            <div class="info-item">
              <span>é¡Œç›®æ•¸é‡ï¼š</span>
              <span id="questionCount">-</span>
            </div>
            <div class="info-item">
              <span>æœ€é«˜åˆ†æ•¸ï¼š</span>
              <span id="bestScore">-</span>
            </div>
          </div>
          <div class="action-buttons">
            <button class="btn-secondary" onclick="deselectStage()">
              å–æ¶ˆé¸æ“‡
            </button>
            <button class="btn-primary" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
          </div>
        </div>

        <!-- é—œå¡åˆ—è¡¨ -->
        <div class="stages-grid" id="stagesGrid"></div>

        <div class="action-buttons" style="margin-top: 2rem">
          <button
            class="btn-secondary"
            onclick="location.href = '../index.html'"
          >
            è¿”å›é¦–é 
          </button>
        </div>
      </main>

      <footer>
        <p>&copy; 2026 åŸ·è¡ŒåŠŸèƒ½è¨“ç·´éŠæˆ². All rights reserved.</p>
      </footer>
    </div>

    <script src="../js/firebase-config.js"></script>
    <script src="../js/utils/constants.js"></script>
    <script>
      // é—œå¡è³‡æ–™
      const stages = [
        {
          id: "A",
          name: "å ´åœ°Aï¼šèµ·å¸æ£®æ—",
          icon: "ğŸ§€",
          description: "å­¸ç¿’èµ·å¸åˆ†é¡çš„åŸºæœ¬è¦å‰‡",
          difficulty: "easy",
          questions: 10,
          locked: false,
        },
        {
          id: "B",
          name: "å ´åœ°Bï¼šäººé¡æ‘èŠ",
          icon: "ğŸ§‘",
          description: "ç·´ç¿’è¾¨è­˜ä¸åŒçš„äººç‰©ç‰¹å¾µ",
          difficulty: "medium",
          questions: 10,
          locked: false,
        },
        {
          id: "C",
          name: "å ´åœ°Cï¼šæµ·æ´‹ä¸–ç•Œ",
          icon: "ğŸŸ",
          description: "æŒ‘æˆ°é­šé¡åˆ†é¡çš„é€²éšè¦å‰‡",
          difficulty: "medium",
          questions: 12,
          locked: false,
        },
        {
          id: "D",
          name: "å ´åœ°Dï¼šæ™å¤œè¿·å®®",
          icon: "ğŸŒ™",
          description: "çµåˆæ—¥å¤œæƒ…å¢ƒçš„æŒ‘æˆ°",
          difficulty: "hard",
          questions: 15,
          locked: false,
        },
        {
          id: "E",
          name: "å ´åœ°Eï¼šè½‰æ›æ˜Ÿçƒ",
          icon: "ğŸ”„",
          description: "å¿«é€Ÿåˆ‡æ›ä¸åŒçš„åˆ†é¡è¦å‰‡",
          difficulty: "hard",
          questions: 20,
          locked: false,
        },
        {
          id: "F",
          name: "å ´åœ°Fï¼šè€åŠ›è³½é“",
          icon: "ğŸ’ª",
          description: "çµåˆæ‰€æœ‰è¦å‰‡çš„çµ‚æ¥µæŒ‘æˆ°",
          difficulty: "hard",
          questions: 25,
          locked: false,
        },
        {
          id: "G",
          name: "å ´åœ°Gï¼šæ¥µé€ŸæŒ‘æˆ°",
          icon: "âš¡",
          description: "çµ‚æ¥µé€Ÿåº¦èˆ‡æº–ç¢ºåº¦çš„è€ƒé©—",
          difficulty: "hard",
          questions: 30,
          locked: false,
        },
        {
          id: "H",
          name: "å ´åœ°Hï¼šå¤§å¸«è€ƒé©—",
          icon: "ğŸ‘‘",
          description: "çµ‚æ¥µæŒ‘æˆ°ï¼Œè€ƒé©—æ‚¨çš„æ¥µé™",
          difficulty: "hard",
          questions: 50,
          locked: false,
        },
      ];

      let currentFilter = "easy";
      let selectedStage = null;

      // è¼‰å…¥æœ€é«˜åˆ†æ•¸
      function loadBestScores() {
        const scores = JSON.parse(localStorage.getItem("bestScores") || "{}");
        return scores;
      }

      // æ¸²æŸ“é—œå¡
      function renderStages(filter = "all") {
        const grid = document.getElementById("stagesGrid");
        const bestScores = loadBestScores();

        const filteredStages =
          filter === "all"
            ? stages
            : stages.filter((s) => s.difficulty === filter);

        grid.innerHTML = filteredStages
          .map((stage) => {
            const bestScore = bestScores[stage.id] || 0;
            const lockedClass = stage.locked ? "locked" : "";

            return `
            <div class="stage-card ${lockedClass}" onclick="selectStage('${stage.id}')">
              ${stage.locked ? '<span class="lock-icon">ğŸ”’</span>' : ""}
              <div class="emoji">${stage.icon}</div>
              <h3>${stage.name}</h3>
              <p class="description">${stage.description}</p>
              <div style="text-align: center">
                <span class="difficulty-badge ${stage.difficulty}">
                  ${stage.difficulty === "easy" ? "ç°¡å–®" : stage.difficulty === "medium" ? "ä¸­ç­‰" : "å›°é›£"}
                </span>
              </div>
              ${stage.locked ? `<p style="text-align: center; color: #999; margin-top: 0.5rem; font-size: 0.85rem;">ğŸ”’ ${stage.unlockCondition}</p>` : ""}
              ${!stage.locked && bestScore > 0 ? `<div class="best-score">ğŸ† æœ€é«˜åˆ†ï¼š${bestScore} åˆ†</div>` : ""}
            </div>
          `;
          })
          .join("");
      }

      // ç¯©é¸é›£åº¦
      function filterByDifficulty(difficulty) {
        currentFilter = difficulty;

        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        document.querySelectorAll(".difficulty-tab").forEach((tab) => {
          tab.classList.remove("active");
        });
        document
          .querySelector(`.difficulty-tab[data-difficulty="${difficulty}"]`)
          .classList.add("active");

        renderStages(difficulty);
      }

      // é¸æ“‡é—œå¡
      function selectStage(stageId) {
        const stage = stages.find((s) => s.id === stageId);

        if (!stage || stage.locked) {
          if (stage && stage.locked) {
            alert(`ğŸ”’ æ­¤é—œå¡å·²é–å®š\nè§£é–æ¢ä»¶ï¼š${stage.unlockCondition}`);
          }
          return;
        }

        selectedStage = stage;

        // é¡¯ç¤ºé—œå¡è³‡è¨Š
        const bestScores = loadBestScores();
        const bestScore = bestScores[stageId] || 0;

        document.getElementById("stageName").textContent = stage.name;
        document.getElementById("stageDifficulty").textContent =
          stage.difficulty === "easy"
            ? "ç°¡å–®"
            : stage.difficulty === "medium"
              ? "ä¸­ç­‰"
              : "å›°é›£";
        document.getElementById("questionCount").textContent = stage.questions;
        document.getElementById("bestScore").textContent =
          bestScore > 0 ? `${bestScore} åˆ†` : "å°šæœªæŒ‘æˆ°";

        document.getElementById("selectedInfo").classList.add("show");

        // æ»¾å‹•åˆ°è³‡è¨Šå€
        document
          .getElementById("selectedInfo")
          .scrollIntoView({ behavior: "smooth" });
      }

      // å–æ¶ˆé¸æ“‡
      function deselectStage() {
        selectedStage = null;
        document.getElementById("selectedInfo").classList.remove("show");
      }

      // é–‹å§‹éŠæˆ²
      function startGame() {
        if (!selectedStage) return;

        // å„²å­˜é¸æ“‡çš„é—œå¡åˆ° localStorage
        localStorage.setItem("selectedStage", JSON.stringify(selectedStage));

        // è·³è½‰åˆ°å–®äººéŠæˆ²é é¢
        location.href = "game.html";
      }

      // åˆå§‹åŒ–
      renderStages(currentFilter);
    </script>
  </body>
</html>
