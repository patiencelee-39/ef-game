<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <!-- ===== åŸºç¤è¨­å®š ===== -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- ===== ç¶²ç«™æ¨™é¡Œ ===== -->
    <title>åŸ·è¡ŒåŠŸèƒ½èªçŸ¥è¨“ç·´ - ä¸­åŸå¤§å­¸ç‰¹æ•™ç³»ç ”ç©¶å·¥å…·</title>

    <!-- ===== ç¶²ç«™èº«åˆ†è­˜åˆ¥ï¼ˆGoogle å®‰å…¨è¦ç¯„ï¼‰ ===== -->
    <meta
      name="description"
      content="ä¸­åŸå¤§å­¸ç‰¹æ®Šæ•™è‚²å­¸ç³»ç¢©å£«ç­å­¸è¡“ç ”ç©¶å·¥å…·ï¼Œç”¨æ–¼è½è¦ºéšœç¤™å­¸ç”Ÿçš„åŸ·è¡ŒåŠŸèƒ½è¨“ç·´ã€‚ä¸æ”¶é›†ä»»ä½•å€‹äººè³‡è¨Šï¼Œæ‰€æœ‰è³‡æ–™åƒ…å­˜æ–¼æœ¬åœ°ç€è¦½å™¨ã€‚"
    />
    <meta name="author" content="ä¸­åŸå¤§å­¸ç‰¹æ®Šæ•™è‚²å­¸ç³»ç¢©å£«ç­" />
    <meta
      name="keywords"
      content="åŸ·è¡ŒåŠŸèƒ½, èªçŸ¥è¨“ç·´, ç‰¹æ®Šæ•™è‚², è½è¦ºéšœç¤™, å­¸è¡“ç ”ç©¶"
    />
    <meta name="classification" content="Education, Academic Research" />
    <meta name="category" content="Education" />
    <meta name="robots" content="index, follow" />

    <!-- ===== å…§å®¹å®‰å…¨æ”¿ç­–ï¼ˆCSPï¼‰===== -->
    <!-- [å®‰å…¨è¦ç¯„] é˜²æ­¢ XSS æ”»æ“Šï¼Œåªå…è¨±æœ¬åœ°è³‡æº -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'none'; frame-ancestors 'none'; form-action 'self';"
    />

    <!-- ===== å…¶ä»–å®‰å…¨æ¨™é ­ ===== -->
    <meta http-equiv="X-Frame-Options" content="DENY" />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />

    <style>
      /* ========================================
         CSS è®Šæ•¸å®šç¾©å€
         [è‰¯å¥½å¯¦è¸] ä½¿ç”¨ CSS è®Šæ•¸ä¾¿æ–¼ç¶­è­·å’Œä¿®æ”¹
         [DRY åŸå‰‡] é¿å…é‡è¤‡å®šç¾©ç›¸åŒçš„é¡è‰²å€¼
         ======================================== */
      :root {
        /* ä¸»é¡Œé¡è‰² */
        --bg-color: #2c3e50; /* æ·±è—è‰²èƒŒæ™¯ */
        --text-color: #ecf0f1; /* æ·ºç°è‰²æ–‡å­— */
        --primary-color: #3498db; /* ä¸»è¦è—è‰² */
        --success-color: #2ecc71; /* æˆåŠŸç¶ è‰² */
        --error-color: #e74c3c; /* éŒ¯èª¤ç´…è‰² */

        /* åˆºæ¿€é¡è‰² */
        --star-color: #f1c40f; /* æ˜Ÿæ˜Ÿé»ƒè‰² */
        --sun-color: #f39c12; /* å¤ªé™½æ©˜è‰² */

        /* å›åˆé¡è‰² */
        --round1-color: #e67e22; /* ç¬¬ä¸€å›æ©˜è‰² */
        --round2-color: #9b59b6; /* ç¬¬äºŒå›ç´«è‰² */
        --practice-color: #1abc9c; /* ç·´ç¿’æ¨¡å¼é’ç¶ è‰² */
      }

      /* ========================================
         åŸºç¤æ¨£å¼
         ======================================== */
      body {
        font-family: "å¾®è»Ÿæ­£é»‘é«”", "Microsoft JhengHei", sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        text-align: center;
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        /* [åˆå­¸è€…] touch-action é˜²æ­¢è§¸æ§è£ç½®çš„æ„å¤–ç¸®æ”¾ */
        touch-action: manipulation;
      }

      /* ========================================
         é¦–é è³‡è¨Šå€å¡Š
         [Google å®‰å…¨] æ¸…æ¥šèªªæ˜ç¶²ç«™ç”¨é€”èˆ‡èº«åˆ†
         ======================================== */
      .landing-info {
        background: rgba(255, 255, 255, 0.1);
        padding: 30px;
        border-radius: 15px;
        max-width: 600px;
        margin-bottom: 20px;
        text-align: left;
        border-left: 5px solid var(--primary-color);
      }

      .landing-info h3 {
        margin-top: 0;
        color: var(--primary-color);
      }

      .landing-info p {
        line-height: 1.6;
        opacity: 0.9;
      }

      /* ========================================
         æ•™å­¸èªªæ˜å®¹å™¨
         [ç”¨é€”] é¡¯ç¤ºéŠæˆ²è¦å‰‡çš„å·¦å³å°ç…§åœ–ç¤º
         ======================================== */
      .tutorial-container {
        display: flex;
        flex-direction: row;
        justify-content: center;
        gap: 20px;
        margin-bottom: 30px;
        width: 100%;
      }

      /* [åˆå­¸è€…] è¦å‰‡æ¡† - ç”¨æ–¼é¡¯ç¤ºã€Œæ˜Ÿæ˜Ÿâ†’Fã€ã€ã€Œå¤ªé™½â†’Jã€çš„èªªæ˜ */
      .rule-box {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1; /* [åˆå­¸è€…] å¹³å‡åˆ†é…ç©ºé–“ */
        border: 2px solid rgba(255, 255, 255, 0.1);
      }

      /* å·¦é‚Šæ¡†ï¼ˆé»ƒè‰² - æ˜Ÿæ˜Ÿï¼‰ */
      .rule-box.left-box {
        background: rgba(241, 196, 15, 0.2);
      }

      /* å³é‚Šæ¡†ï¼ˆæ©˜è‰² - å¤ªé™½ï¼‰ */
      .rule-box.right-box {
        background: rgba(243, 156, 18, 0.2);
      }

      .rule-icon {
        font-size: 4em;
        margin-bottom: 10px;
      }

      .rule-arrow {
        font-size: 2em;
        color: #bdc3c7;
        margin: 10px 0;
      }

      .rule-key {
        border: 3px solid #fff;
        border-radius: 10px;
        padding: 10px 25px;
        font-size: 2em;
        font-weight: bold;
        margin: 10px 0;
        background: rgba(0, 0, 0, 0.3);
      }

      .key-desc {
        font-size: 1.2em;
        color: #95a5a6;
      }

      /* ========================================
         éŠæˆ²ç•«é¢å€å¡Š
         ======================================== */
      .game-container {
        max-width: 800px;
        width: 100%;
      }

      /* [åˆå­¸è€…] screen-layer é¡åˆ¥ç”¨æ–¼ç®¡ç†ä¸åŒç•«é¢çš„é¡¯ç¤º/éš±è— */
      .screen-layer {
        padding: 20px;
        border-radius: 20px;
        background: rgba(255, 255, 255, 0.05);
        min-height: 400px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      /* [åˆå­¸è€…] .hidden é¡åˆ¥ç”¨æ–¼éš±è—å…ƒç´  */
      .hidden {
        display: none !important;
      }

      /* åé¥‹å‹•ç•« - æ­£ç¢ºæ™‚çš„ç¶ è‰²é–ƒå…‰ */
      .feedback-success {
        animation: feedback-flash-success 0.5s ease-out;
      }

      /* åé¥‹å‹•ç•« - éŒ¯èª¤æ™‚çš„ç´…è‰²é–ƒå…‰ */
      .feedback-error {
        animation: feedback-flash-error 0.5s ease-out;
      }

      /* ===== å‹•ç•«å®šç¾© ===== */
      /* [åˆå­¸è€…] @keyframes å®šç¾©å‹•ç•«çš„å„å€‹éšæ®µ */
      @keyframes feedback-flash-success {
        0% {
          background: rgba(255, 255, 255, 0.05);
        }
        50% {
          background: rgba(46, 204, 113, 0.3);
        }
        100% {
          background: rgba(255, 255, 255, 0.05);
        }
      }

      @keyframes feedback-flash-error {
        0% {
          background: rgba(255, 255, 255, 0.05);
        }
        50% {
          background: rgba(231, 76, 60, 0.3);
        }
        100% {
          background: rgba(255, 255, 255, 0.05);
        }
      }

      /* ===== è¦–è¦ºå›é¥‹å¼·åŒ–å‹•ç•« ===== */
      /* [æ–°å¢] æ­£ç¢ºåæ‡‰ï¼šç¶ è‰²è„ˆè¡æ”¾å¤§ */
      @keyframes pulse-correct {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.3);
          filter: brightness(1.5);
        }
        100% {
          transform: scale(1);
        }
      }

      /* [æ–°å¢] éŒ¯èª¤åæ‡‰ï¼šç´…è‰²éœ‡å‹• */
      @keyframes shake-error {
        0%,
        100% {
          transform: translateX(0) rotate(0deg);
        }
        25% {
          transform: translateX(-10px) rotate(-5deg);
        }
        75% {
          transform: translateX(10px) rotate(5deg);
        }
      }

      /* [åˆå­¸è€…] é€™å…©å€‹é¡åˆ¥æœƒè¢« JavaScript å‹•æ…‹æ·»åŠ åˆ°åˆºæ¿€ç‰©ä¸Š */
      .correct-flash {
        animation: pulse-correct 0.5s ease-out;
        filter: drop-shadow(0 0 20px #2ecc71);
      }

      .error-flash {
        animation: shake-error 0.4s ease-in-out;
        filter: drop-shadow(0 0 20px #e74c3c);
      }

      /* ========================================
         åˆºæ¿€ç‰©é¡¯ç¤ºå€
         [ç”¨é€”] é¡¯ç¤ºæ˜Ÿæ˜Ÿæˆ–å¤ªé™½åœ–ç¤º
         ======================================== */
      .stimulus-area {
        min-height: 250px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 30px;
      }

      #stimulusDisplay {
        font-size: 8em;
        /* [åˆå­¸è€…] transition è®“è®ŠåŒ–æ›´å¹³æ»‘ */
        transition: transform 0.2s;
      }

      /* ========================================
         å›åˆæ¨™ç±¤æ¨£å¼
         ======================================== */
      .round-label {
        display: inline-block;
        padding: 10px 25px;
        border-radius: 25px;
        font-weight: bold;
        font-size: 1.3em;
        margin-bottom: 20px;
        border: 2px solid;
      }

      /* ç·´ç¿’æ¨¡å¼æ¨™ç±¤ï¼ˆé’ç¶ è‰²ï¼‰ */
      .practice-badge {
        background: var(--practice-color);
        color: white;
        border-color: var(--practice-color);
      }

      /* ç¬¬ä¸€å›æ¨™ç±¤ï¼ˆæ©˜è‰²ï¼‰ */
      .round1-badge {
        background: var(--round1-color);
        color: white;
        border-color: var(--round1-color);
      }

      /* ç¬¬äºŒå›æ¨™ç±¤ï¼ˆç´«è‰²ï¼‰ */
      .round2-badge {
        background: var(--round2-color);
        color: white;
        border-color: var(--round2-color);
      }

      /* ========================================
         æŒ‰éˆ•å€åŸŸ
         ======================================== */
      .controls-area {
        width: 100%;
        display: flex;
        justify-content: space-around;
        padding-bottom: 20px;
        gap: 20px;
      }

      /* æŒ‰éµæ¨£å¼ */
      .btn-key {
        font-size: 4em;
        padding: 30px;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        color: white;
        /* [åˆå­¸è€…] transition è®“æŒ‰éˆ•æŒ‰ä¸‹æ™‚æœ‰å¹³æ»‘çš„ç¸®æ”¾æ•ˆæœ */
        transition: transform 0.1s, opacity 0.1s;
        flex: 1;
        max-width: 200px;
        position: relative;
      }

      /* F éµï¼ˆé»ƒè‰²ï¼‰ */
      .btn-f {
        background-color: var(--star-color);
      }

      /* J éµï¼ˆæ©˜è‰²ï¼‰ */
      .btn-j {
        background-color: var(--sun-color);
      }

      /* æŒ‰éˆ•æŒ‰ä¸‹æ•ˆæœ */
      .btn-key:active {
        transform: scale(0.95);
      }

      /* éµç›¤æç¤ºæ–‡å­— */
      .key-hint {
        position: absolute;
        top: 5px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.3em;
        opacity: 0.7;
        white-space: nowrap;
      }

      /* ç¦ç”¨ç‹€æ…‹ */
      .btn-disabled {
        background-color: #7f8c8d;
        opacity: 0.3;
        pointer-events: none;
      }

      /* ========================================
         é€²åº¦æ¢
         [æ–°å¢] è¦–è¦ºåŒ–é¡¯ç¤ºé€²åº¦
         ======================================== */
      .progress-container {
        width: 100%;
        height: 8px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        overflow: hidden;
        margin-top: 10px;
      }

      .progress-bar {
        height: 100%;
        /* [åˆå­¸è€…] linear-gradient å‰µé€ æ¼¸å±¤æ•ˆæœ */
        background: linear-gradient(90deg, #3498db, #2ecc71);
        border-radius: 10px;
        transition: width 0.3s ease;
        width: 0%;
      }

      /* ========================================
         é€šç”¨æŒ‰éˆ•æ¨£å¼
         ======================================== */
      .btn {
        background-color: var(--primary-color);
        color: white;
        border: none;
        padding: 15px 40px;
        font-size: 1.5em;
        border-radius: 50px;
        cursor: pointer;
        transition: transform 0.1s;
        margin: 10px;
      }

      .btn:hover {
        opacity: 0.9;
      }

      .btn:active {
        transform: scale(0.95);
      }

      /* ========================================
         æˆç¸¾é¡¯ç¤ºå€
         ======================================== */
      .result-container {
        background: rgba(255, 255, 255, 0.1);
        padding: 30px;
        border-radius: 15px;
        margin: 20px 0;
      }

      .score-display {
        font-size: 3em;
        margin: 20px 0;
        color: var(--success-color);
      }

      .accuracy-display {
        font-size: 2em;
        margin: 10px 0;
      }

      /* ========================================
         é€£çµæ¨£å¼
         ======================================== */
      a {
        color: var(--primary-color);
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }

      /* ========================================
         éŸ¿æ‡‰å¼è¨­è¨ˆ
         [åˆå­¸è€…] @media ç”¨æ–¼æ‰‹æ©Ÿç•«é¢çš„é©é…
         ======================================== */
      @media (max-width: 600px) {
        #stimulusDisplay {
          font-size: 5em;
        }

        .btn-key {
          font-size: 3em;
          padding: 20px;
        }

        .landing-info {
          padding: 20px;
        }

        .tutorial-container {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <!-- ========================================
         ä¸»å®¹å™¨
         ======================================== -->
    <div class="game-container">
      <!-- =====================================
           ç•«é¢ 1: é¦–é ï¼ˆlandingPageï¼‰
           [Google å®‰å…¨] æ¸…æ¥šèªªæ˜ç¶²ç«™æ€§è³ªèˆ‡ç”¨é€”
           ===================================== -->
      <div id="landingPage" class="screen-layer">
        <h1>ğŸ® åŸ·è¡ŒåŠŸèƒ½èªçŸ¥è¨“ç·´éŠæˆ²</h1>

        <!-- [Google å®‰å…¨è¦ç¯„] æ˜ç¢ºæ¨™ç¤ºç¶²ç«™èº«åˆ†èˆ‡ç”¨é€” -->
        <div class="landing-info">
          <h3>ğŸ“š å­¸è¡“ç ”ç©¶å·¥å…·</h3>
          <p>
            æœ¬ç¶²ç«™ç‚º<strong>ä¸­åŸå¤§å­¸ç‰¹æ®Šæ•™è‚²å­¸ç³»ç¢©å£«ç­</strong>å­¸è¡“ç ”ç©¶å·¥å…·ã€‚
          </p>
          <p>
            <strong>ç ”ç©¶å°è±¡ï¼š</strong>è½è¦ºéšœç¤™å­¸ç”Ÿ<br />
            <strong>è¨“ç·´ç›®æ¨™ï¼š</strong>åŸ·è¡ŒåŠŸèƒ½ï¼ˆå·¥ä½œè¨˜æ†¶èˆ‡æŠ‘åˆ¶æ§åˆ¶ï¼‰
          </p>
          <p style="color: var(--success-color); font-weight: bold">
            âœ… ä¸æ”¶é›†ä»»ä½•å€‹äººè³‡è¨Š<br />
            âœ… æ‰€æœ‰è³‡æ–™åƒ…å­˜æ–¼æ‚¨çš„ç€è¦½å™¨
          </p>
        </div>

        <button class="btn" onclick="game.showTutorial()">
          ğŸ“– é–‹å§‹æ¸¬é©—èªªæ˜
        </button>

        <!-- [Google å®‰å…¨] æä¾›éš±ç§æ¬Šæ”¿ç­–é€£çµ -->
        <p style="margin-top: 30px; opacity: 0.7">
          <a href="privacy.html" target="_blank">ğŸ”’ éš±ç§æ¬Šæ”¿ç­–</a> |
          <a
            href="https://github.com/patiencelee-39/ef-training-game"
            target="_blank"
            rel="noopener"
          >
            ğŸ’» é–‹æºå°ˆæ¡ˆ
          </a>
          |
          <a href="https://www.cycu.edu.tw/" target="_blank" rel="noopener">
            ğŸ« ä¸­åŸå¤§å­¸
          </a>
        </p>
      </div>

      <!-- =====================================
           ç•«é¢ 2: ç·´ç¿’æ¨¡å¼èªªæ˜ï¼ˆpracticeScreenï¼‰
           ===================================== -->
      <div id="practiceScreen" class="screen-layer hidden">
        <h2 style="color: var(--practice-color)">ğŸ® ç·´ç¿’æ¨¡å¼</h2>
        <p style="color: #bdc3c7; margin-bottom: 30px">
          å…ˆä¾†ç·´ç¿’ 3 é¡Œï¼Œç†Ÿæ‚‰éŠæˆ²è¦å‰‡ï¼
        </p>

        <div class="tutorial-container">
          <!-- å·¦é‚Šï¼šæ˜Ÿæ˜Ÿ â†’ F éµ -->
          <div class="rule-box left-box">
            <span class="rule-icon">â­</span>
            <span class="rule-arrow">â¬‡</span>
            <span class="rule-key">F</span>
            <span class="key-desc">å·¦æ‰‹</span>
          </div>

          <!-- å³é‚Šï¼šå¤ªé™½ â†’ J éµ -->
          <div class="rule-box right-box">
            <span class="rule-icon">â˜€ï¸</span>
            <span class="rule-arrow">â¬‡</span>
            <span class="rule-key">J</span>
            <span class="key-desc">å³æ‰‹</span>
          </div>
        </div>

        <button class="btn" onclick="game.startPractice()">
          ğŸš€ é–‹å§‹ç·´ç¿’
          <span style="opacity: 0.7; font-size: 0.8em">(æŒ‰ç©ºç™½éµ)</span>
        </button>
      </div>

      <!-- =====================================
           ç•«é¢ 3: ç·´ç¿’çµæŸï¼ˆpracticeEndï¼‰
           ===================================== -->
      <div id="practiceEnd" class="screen-layer hidden">
        <h2 style="color: #2ecc71">âœ… ç·´ç¿’å®Œæˆï¼</h2>
        <p style="color: #bdc3c7; font-size: 1.2em; margin: 20px 0">
          ä½ å·²ç¶“ç†Ÿæ‚‰éŠæˆ²è¦å‰‡äº†ï¼<br />
          æº–å‚™å¥½é€²å…¥æ­£å¼æ¸¬é©—äº†å—ï¼Ÿ
        </p>

        <div
          style="
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
          "
        >
          <p style="margin: 0">
            ğŸ‘‰ æ¥ä¸‹ä¾†æœƒæœ‰ <b>å…©å€‹å›åˆ</b>ï¼š<br /><br />
            <b style="color: var(--round1-color)">ç¬¬ä¸€å›</b>ï¼šè¾¨è­˜ç·´ç¿’ï¼ˆ5
            é¡Œï¼‰<br />
            <b style="color: var(--round2-color)">ç¬¬äºŒå›</b>ï¼šæŠ‘åˆ¶ç·´ç¿’ï¼ˆ10 é¡Œï¼‰
          </p>
        </div>

        <button class="btn" onclick="game.showScreen('intro')">
          ğŸš€ é–‹å§‹æ­£å¼æ¸¬é©—
          <span style="opacity: 0.7; font-size: 0.8em">(æŒ‰ç©ºç™½éµ)</span>
        </button>
      </div>

      <!-- =====================================
           ç•«é¢ 4: ç¬¬ä¸€å›èªªæ˜ï¼ˆintroScreenï¼‰
           ===================================== -->
      <div id="introScreen" class="screen-layer hidden">
        <h2>ç¬¬ä¸€å›ï¼šè¾¨è­˜ç·´ç¿’</h2>
        <p style="margin-bottom: 20px; color: #bdc3c7">
          çœ‹ â­ æŒ‰å·¦é‚ŠFéµï¼Œçœ‹ â˜€ï¸ æŒ‰å³é‚ŠJéµ
        </p>

        <div class="tutorial-container">
          <div class="rule-box left-box">
            <span class="rule-icon">â­</span>
            <span class="rule-arrow">â¬‡</span>
            <span class="rule-key">F</span>
            <span class="key-desc">å·¦æ‰‹</span>
          </div>

          <div class="rule-box right-box">
            <span class="rule-icon">â˜€ï¸</span>
            <span class="rule-arrow">â¬‡</span>
            <span class="rule-key">J</span>
            <span class="key-desc">å³æ‰‹</span>
          </div>
        </div>

        <button class="btn" onclick="game.startRound1()">
          ğŸš€ é–‹å§‹ç¬¬ä¸€å›
          <span style="opacity: 0.7; font-size: 0.8em">(æŒ‰ç©ºç™½éµ)</span>
        </button>
      </div>

      <!-- =====================================
           ç•«é¢ 5: ä¸­å ´ä¼‘æ¯ï¼ˆintermissionScreenï¼‰
           ===================================== -->
      <div id="intermissionScreen" class="screen-layer hidden">
        <h2>âš ï¸ è¦å‰‡æ”¹è®Šäº†ï¼</h2>

        <div class="tutorial-container">
          <!-- å·¦é‚Šï¼šæ˜Ÿæ˜Ÿ â†’ ç¦æ­¢æŒ‰ï¼ˆç´…è‰²èƒŒæ™¯ï¼‰ -->
          <div
            class="rule-box left-box"
            style="opacity: 0.8; background: rgba(231, 76, 60, 0.2)"
          >
            <span class="rule-icon">â­</span>
            <span class="rule-arrow">â¬‡</span>
            <span class="rule-icon" style="font-size: 3em">ğŸ›‘</span>
            <span
              class="key-desc"
              style="color: var(--error-color); font-weight: bold"
              >ä¸è¦æŒ‰ï¼</span
            >
          </div>

          <!-- å³é‚Šï¼šå¤ªé™½ â†’ è¦æŒ‰ -->
          <div class="rule-box right-box">
            <span class="rule-icon">â˜€ï¸</span>
            <span class="rule-arrow">â¬‡</span>
            <span class="rule-key">J</span>
            <span class="key-desc">è¦æŒ‰ï¼</span>
          </div>
        </div>

        <button class="btn" onclick="game.startRound2()">
          ğŸš€ é–‹å§‹ç¬¬äºŒå›
          <span style="opacity: 0.7; font-size: 0.8em">(æŒ‰ç©ºç™½éµ)</span>
        </button>
      </div>

      <!-- =====================================
           ç•«é¢ 6: éŠæˆ²é€²è¡Œä¸­ï¼ˆplayScreenï¼‰
           ===================================== -->
      <div id="playScreen" class="screen-layer hidden">
        <div style="width: 100%">
          <!-- å›åˆæ¨™ç±¤ -->
          <div id="roundLabel" class="round-label round1-badge">ç¬¬ä¸€å›</div>

          <!-- é€²åº¦é¡¯ç¤º -->
          <div
            style="
              margin-top: 25px;
              display: flex;
              justify-content: space-between;
            "
          >
            <span
              >é€²åº¦: <span id="currentTrialDisplay">0</span>/<span
                id="totalTrialDisplay"
                >10</span
              ></span
            >
          </div>

          <!-- [æ–°å¢] é€²åº¦æ¢ -->
          <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
          </div>
        </div>

        <!-- åˆºæ¿€é¡¯ç¤ºå€ -->
        <div class="stimulus-area">
          <div id="stimulusDisplay"></div>
        </div>

        <!-- æŒ‰éˆ•å€ -->
        <div class="controls-area">
          <!-- F éµæŒ‰éˆ•ï¼ˆæ˜Ÿæ˜Ÿ/é»ƒè‰²ï¼‰ -->
          <button
            id="btnF"
            class="btn-key btn-f"
            onpointerdown="game.handleInput('F')"
          >
            <span class="key-hint">Keyboard F</span>
            â­
          </button>

          <!-- J éµæŒ‰éˆ•ï¼ˆå¤ªé™½/æ©˜è‰²ï¼‰ -->
          <button
            id="btnJ"
            class="btn-key btn-j"
            onpointerdown="game.handleInput('J')"
          >
            <span class="key-hint">Keyboard J</span>
            â˜€ï¸
          </button>
        </div>
      </div>

      <!-- =====================================
           ç•«é¢ 7: çµæœç•«é¢ï¼ˆresultScreenï¼‰
           ===================================== -->
      <div id="resultScreen" class="screen-layer hidden">
        <h2>ğŸ‰ æ¸¬é©—å®Œæˆï¼</h2>

        <div class="result-container">
          <div class="score-display">
            å¾—åˆ†: <span id="scoreDisplay">0</span>
          </div>
          <div class="accuracy-display">
            æ­£ç¢ºç‡: <span id="accuracyDisplay">0</span>%
          </div>
        </div>

        <!-- [Google å®‰å…¨] æ¸…æ¥šèªªæ˜åŒ¯å‡ºåŠŸèƒ½ -->
        <div
          style="
            background: rgba(52, 152, 219, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
          "
        >
          <h4>ğŸ“Š è³‡æ–™åŒ¯å‡ºèªªæ˜</h4>
          <p style="font-size: 0.9em; line-height: 1.6">
            é»æ“Šä¸‹æ–¹æŒ‰éˆ•å°‡ä¸‹è¼‰ <strong>CSV ç´”æ–‡å­—æª”æ¡ˆ</strong>ï¼Œå…§å®¹åŒ…å«ï¼š<br />
            â€¢ è©¦é¡Œç·¨è™Ÿ<br />
            â€¢ åˆºæ¿€é¡å‹ï¼ˆæ˜Ÿæ˜Ÿæˆ–å¤ªé™½ï¼‰<br />
            â€¢ åæ‡‰çµæœï¼ˆæ­£ç¢ºæˆ–éŒ¯èª¤ï¼‰<br />
            â€¢ åæ‡‰æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰<br />
            <span style="color: var(--success-color); font-weight: bold"
              >âœ… ä¸åŒ…å«ä»»ä½•å€‹äººè­˜åˆ¥è³‡è¨Š</span
            >
          </p>
        </div>

        <button class="btn" onclick="game.exportData()">
          ğŸ“¥ åŒ¯å‡ºç ”ç©¶è³‡æ–™ (CSV)
        </button>

        <button class="btn" onclick="location.reload()">ğŸ”„ é‡æ–°é–‹å§‹</button>
      </div>
    </div>

    <!-- ========================================
         JavaScript ç¨‹å¼å€åŸŸ
         ======================================== -->
    <script>
      /**
       * ========================================
       * éŠæˆ²è¨­å®šå¸¸æ•¸
       * [è‰¯å¥½å¯¦è¸] ä½¿ç”¨å…¨å¤§å¯«å‘½åå¸¸æ•¸
       * [ç”¨é€”] é›†ä¸­ç®¡ç†éŠæˆ²åƒæ•¸ï¼Œä¾¿æ–¼èª¿æ•´
       * ========================================
       */
      const CONFIG = {
        // åˆºæ¿€é¡¯ç¤ºæ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
        STIMULUS_DURATION: 1000,

        // åˆºæ¿€é–“éš”æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
        INTER_STIMULUS_INTERVAL: 500,

        // Go åˆºæ¿€æ¯”ä¾‹ï¼ˆ0.8 è¡¨ç¤º 80% æ˜¯å¤ªé™½ï¼‰
        goRatio: 0.8,

        // ç¬¬ä¸€å›åˆè©¦é¡Œæ•¸
        round1Trials: 5,

        // ç¬¬äºŒå›åˆè©¦é¡Œæ•¸
        round2Trials: 10,
      };

      /**
       * ========================================
       * éŠæˆ²ä¸»ç‰©ä»¶
       * [è‰¯å¥½å¯¦è¸] ä½¿ç”¨ç‰©ä»¶å°è£ç›¸é—œåŠŸèƒ½
       * [å–®ä¸€è·è²¬] æ¯å€‹æ–¹æ³•åªè² è²¬ä¸€å€‹åŠŸèƒ½
       * ========================================
       */
      const game = {
        /**
         * ===== ç‹€æ…‹ç®¡ç† =====
         * [åˆå­¸è€…] state ç‰©ä»¶å„²å­˜éŠæˆ²çš„æ‰€æœ‰ç‹€æ…‹
         */
        state: {
          currentRound: 1, // ç•¶å‰å›åˆï¼ˆ0=ç·´ç¿’, 1=ç¬¬ä¸€å›, 2=ç¬¬äºŒå›ï¼‰
          currentTrial: 0, // ç•¶å‰è©¦é¡Œç·¨è™Ÿ
          totalTrials: 0, // ç¸½è©¦é¡Œæ•¸
          score: 0, // å¾—åˆ†
          results: [], // çµæœè¨˜éŒ„é™£åˆ—
          isPlaying: false, // æ˜¯å¦æ­£åœ¨éŠæˆ²ä¸­
          currentStimulus: "", // ç•¶å‰åˆºæ¿€é¡å‹
          trialStartTime: 0, // è©¦é¡Œé–‹å§‹æ™‚é–“
          isPractice: false, // æ˜¯å¦ç‚ºç·´ç¿’æ¨¡å¼
        },

        /**
         * ===== DOM å…ƒç´ å¿«å– =====
         * [è‰¯å¥½å¯¦è¸] é¿å…é‡è¤‡æŸ¥è©¢ DOMï¼Œæå‡æ•ˆèƒ½
         * [åˆå­¸è€…] getElementById ç”¨æ–¼å–å¾— HTML å…ƒç´ 
         */
        elements: {
          landingPage: document.getElementById("landingPage"),
          practiceScreen: document.getElementById("practiceScreen"),
          practiceEnd: document.getElementById("practiceEnd"),
          introScreen: document.getElementById("introScreen"),
          intermissionScreen: document.getElementById("intermissionScreen"),
          playScreen: document.getElementById("playScreen"),
          resultScreen: document.getElementById("resultScreen"),
          stimulus: document.getElementById("stimulusDisplay"),
          trialDisplay: document.getElementById("currentTrialDisplay"),
          totalDisplay: document.getElementById("totalTrialDisplay"),
          roundLabel: document.getElementById("roundLabel"),
          btnF: document.getElementById("btnF"),
          btnJ: document.getElementById("btnJ"),
          container: document.getElementById("playScreen"),
        },

        /**
         * ===================================
         * [åŠŸèƒ½] é¡¯ç¤ºæŒ‡å®šç•«é¢
         * [åƒæ•¸] screenName - è¦é¡¯ç¤ºçš„ç•«é¢åç¨±
         * [ç”¨é€”] æ§åˆ¶ä¸åŒç•«é¢çš„åˆ‡æ›
         * ===================================
         */
        showScreen: function (screenName) {
          // [åˆå­¸è€…] å°‡æ‰€æœ‰ç•«é¢éƒ½è¨­ç‚ºéš±è—
          this.elements.landingPage.classList.add("hidden");
          this.elements.practiceScreen.classList.add("hidden");
          this.elements.practiceEnd.classList.add("hidden");
          this.elements.introScreen.classList.add("hidden");
          this.elements.intermissionScreen.classList.add("hidden");
          this.elements.playScreen.classList.add("hidden");
          this.elements.resultScreen.classList.add("hidden");

          // [åˆå­¸è€…] æ ¹æ“š screenName é¡¯ç¤ºå°æ‡‰ç•«é¢
          const screenMap = {
            landing: this.elements.landingPage,
            practice: this.elements.practiceScreen,
            practiceEnd: this.elements.practiceEnd,
            intro: this.elements.introScreen,
            intermission: this.elements.intermissionScreen,
            play: this.elements.playScreen,
            result: this.elements.resultScreen,
          };

          // ç§»é™¤ hidden é¡åˆ¥ä»¥é¡¯ç¤ºç•«é¢
          if (screenMap[screenName]) {
            screenMap[screenName].classList.remove("hidden");
          }
        },

        /**
         * ===================================
         * [åŠŸèƒ½] é¡¯ç¤ºç·´ç¿’æ¨¡å¼èªªæ˜
         * [æµç¨‹] é¦–é  â†’ ç·´ç¿’èªªæ˜
         * ===================================
         */
        showTutorial: function () {
          this.showScreen("practice");
        },

        /**
         * ===================================
         * [åŠŸèƒ½] é–‹å§‹ç·´ç¿’æ¨¡å¼
         * [è¨­è¨ˆ] åªæœ‰ 3 é¡Œï¼Œç”¨æ–¼ç†Ÿæ‚‰æ“ä½œ
         * ===================================
         */
        startPractice: function () {
          // è¨­å®šç·´ç¿’æ¨¡å¼åƒæ•¸
          this.state.currentRound = 0;
          this.state.totalTrials = 3;
          this.state.results = [];
          this.state.currentTrial = 0;
          this.state.score = 0;
          this.state.isPlaying = true;
          this.state.isPractice = true; // è¨­å®šç·´ç¿’æ——æ¨™

          // æ›´æ–°ä»‹é¢é¡¯ç¤º
          this.elements.roundLabel.innerText = "ç·´ç¿’æ¨¡å¼";
          this.elements.roundLabel.className = "round-label practice-badge";
          this.elements.totalDisplay.innerText = this.state.totalTrials;

          // å•Ÿç”¨ F éµæŒ‰éˆ•
          this.elements.btnF.classList.remove("btn-disabled");
          this.elements.btnF.innerHTML =
            '<span class="key-hint">Keyboard F</span>â­';

          // é–‹å§‹éŠæˆ²
          this.showScreen("play");
          this.nextTrial();
        },

        /**
         * ===================================
         * [åŠŸèƒ½] é–‹å§‹ç¬¬ä¸€å›
         * [è¦å‰‡] æ˜Ÿæ˜Ÿâ†’Féµ, å¤ªé™½â†’Jéµï¼ˆå…©å€‹éƒ½è¦æŒ‰ï¼‰
         * ===================================
         */
        startRound1: function () {
          // è¨­å®šç¬¬ä¸€å›åƒæ•¸
          this.state.currentRound = 1;
          this.state.totalTrials = CONFIG.round1Trials;
          this.state.results = [];
          this.state.currentTrial = 0;
          this.state.score = 0;
          this.state.isPlaying = true;
          this.state.isPractice = false; // æ¸…é™¤ç·´ç¿’æ——æ¨™

          // æ›´æ–°ä»‹é¢é¡¯ç¤º
          this.elements.roundLabel.innerText = "ç¬¬ä¸€å›ï¼šè¾¨è­˜ç·´ç¿’";
          this.elements.roundLabel.className = "round-label round1-badge";
          this.elements.totalDisplay.innerText = this.state.totalTrials;

          // å•Ÿç”¨ F éµæŒ‰éˆ•
          this.elements.btnF.classList.remove("btn-disabled");
          this.elements.btnF.innerHTML =
            '<span class="key-hint">Keyboard F</span>â­';

          // é–‹å§‹éŠæˆ²
          this.showScreen("play");
          this.nextTrial();
        },

        /**
         * ===================================
         * [åŠŸèƒ½] é–‹å§‹ç¬¬äºŒå›
         * [è¦å‰‡] æ˜Ÿæ˜Ÿâ†’ç¦æ­¢æŒ‰, å¤ªé™½â†’Jéµï¼ˆæŠ‘åˆ¶è¨“ç·´ï¼‰
         * ===================================
         */
        startRound2: function () {
          // è¨­å®šç¬¬äºŒå›åƒæ•¸
          this.state.currentRound = 2;
          this.state.totalTrials = CONFIG.round2Trials;
          this.state.results = [];
          this.state.currentTrial = 0;
          this.state.score = 0;
          this.state.isPlaying = true;

          // æ›´æ–°ä»‹é¢é¡¯ç¤º
          this.elements.roundLabel.innerText = "ç¬¬äºŒå›ï¼šæŠ‘åˆ¶ç·´ç¿’";
          this.elements.roundLabel.className = "round-label round2-badge";
          this.elements.totalDisplay.innerText = this.state.totalTrials;

          // ç¦ç”¨ F éµæŒ‰éˆ•
          this.elements.btnF.classList.add("btn-disabled");
          this.elements.btnF.innerHTML =
            '<span class="key-hint">ç¦æ­¢æŒ‰</span>ğŸ›‘';

          // é–‹å§‹éŠæˆ²
          this.showScreen("play");
          this.nextTrial();
        },

        /**
         * ===================================
         * [åŠŸèƒ½] é€²å…¥ä¸‹ä¸€é¡Œ
         * [æµç¨‹] æ¸…ç©º â†’ ç­‰å¾… â†’ é¡¯ç¤ºåˆºæ¿€
         * ===================================
         */
        nextTrial: function () {
          // æª¢æŸ¥æ˜¯å¦å·²å®Œæˆæ‰€æœ‰è©¦é¡Œ
          if (this.state.currentTrial >= this.state.totalTrials) {
            this.endSession();
            return;
          }

          // å¢åŠ è©¦é¡Œè¨ˆæ•¸
          this.state.currentTrial++;
          this.updateUI();

          // æ¸…ç©ºåˆºæ¿€é¡¯ç¤º
          this.elements.stimulus.innerText = "";

          // [åˆå­¸è€…] setTimeout ç”¨æ–¼å»¶é²åŸ·è¡Œ
          // ç­‰å¾… 500ms å¾Œé¡¯ç¤ºåˆºæ¿€
          setTimeout(() => {
            if (this.state.isPlaying) {
              this.showStimulus();
            }
          }, CONFIG.INTER_STIMULUS_INTERVAL);
        },

        /**
         * ===================================
         * [åŠŸèƒ½] é¡¯ç¤ºåˆºæ¿€ç‰©
         * [é‚è¼¯] 80% é¡¯ç¤ºå¤ªé™½ï¼ˆGoï¼‰ï¼Œ20% é¡¯ç¤ºæ˜Ÿæ˜Ÿï¼ˆNoGoï¼‰
         * ===================================
         */
        showStimulus: function () {
          // [åˆå­¸è€…] Math.random() ç”¢ç”Ÿ 0~1 çš„éš¨æ©Ÿæ•¸
          // å¦‚æœå°æ–¼ 0.8ï¼ˆ80%æ©Ÿç‡ï¼‰ï¼Œé¡¯ç¤ºå¤ªé™½
          const isSun = Math.random() < CONFIG.goRatio;
          this.state.currentStimulus = isSun ? "sun" : "star";

          if (isSun) {
            // å¤ªé™½ï¼ˆGo åˆºæ¿€ï¼‰
            this.elements.stimulus.innerText = "â˜€ï¸";
            this.elements.stimulus.style.color = "#f39c12";
          } else {
            // æ˜Ÿæ˜Ÿï¼ˆNoGo åˆºæ¿€ï¼‰
            this.elements.stimulus.innerText = "â­";
            this.elements.stimulus.style.color = "#f1c40f";
          }

          // è¨˜éŒ„è©¦é¡Œé–‹å§‹æ™‚é–“
          this.state.trialStartTime = Date.now();

          // 1 ç§’å¾Œè‡ªå‹•é€²å…¥ä¸‹ä¸€é¡Œï¼ˆå¦‚æœæ²’æœ‰åæ‡‰ï¼‰
          setTimeout(() => {
            if (
              this.state.isPlaying &&
              this.elements.stimulus.innerText !== ""
            ) {
              this.recordResult(false, null, null);
              this.nextTrial();
            }
          }, CONFIG.STIMULUS_DURATION);
        },

        /**
         * ===================================
         * [åŠŸèƒ½] è™•ç†ä½¿ç”¨è€…è¼¸å…¥
         * [åƒæ•¸] key - ä½¿ç”¨è€…æŒ‰çš„éµï¼ˆ'F' æˆ– 'J'ï¼‰
         * [é‚è¼¯] åˆ¤æ–·åæ‡‰æ˜¯å¦æ­£ç¢º
         * ===================================
         */
        handleInput: function (key) {
          // å¦‚æœä¸åœ¨éŠæˆ²ä¸­æˆ–æ²’æœ‰åˆºæ¿€ï¼Œå¿½ç•¥è¼¸å…¥
          if (!this.state.isPlaying || !this.elements.stimulus.innerText) {
            return;
          }

          // è¨ˆç®—åæ‡‰æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
          const reactionTime = Date.now() - this.state.trialStartTime;

          let isCorrect = false;

          // [å–®ä¸€è·è²¬] åˆ†åˆ¥åˆ¤æ–·å…©å€‹å›åˆçš„æ­£ç¢ºæ€§
          if (this.state.currentRound === 1 || this.state.currentRound === 0) {
            // ç¬¬ä¸€å›/ç·´ç¿’ï¼šæ˜Ÿæ˜Ÿâ†’F, å¤ªé™½â†’J
            if (this.state.currentStimulus === "star" && key === "F") {
              isCorrect = true;
            } else if (this.state.currentStimulus === "sun" && key === "J") {
              isCorrect = true;
            }
          } else if (this.state.currentRound === 2) {
            // ç¬¬äºŒå›ï¼šåªæœ‰å¤ªé™½â†’J æ˜¯æ­£ç¢ºçš„
            if (this.state.currentStimulus === "sun" && key === "J") {
              isCorrect = true;
            }
            // æ˜Ÿæ˜Ÿä¸æ‡‰è©²æŒ‰ï¼Œä½†æŒ‰äº†å°±æ˜¯éŒ¯èª¤
          }

          // è¨˜éŒ„çµæœ
          this.recordResult(isCorrect, reactionTime, key);

          // é¡¯ç¤ºè¦–è¦ºå›é¥‹
          this.triggerFeedback(isCorrect);

          // é€²å…¥ä¸‹ä¸€é¡Œ
          this.nextTrial();
        },

        /**
         * ===================================
         * [åŠŸèƒ½] è¨˜éŒ„è©¦é¡Œçµæœ
         * [åƒæ•¸] isCorrect - æ˜¯å¦æ­£ç¢º
         * [åƒæ•¸] rt - åæ‡‰æ™‚é–“
         * [åƒæ•¸] inputKey - æŒ‰çš„éµ
         * ===================================
         */
        recordResult: function (isCorrect, rt, inputKey) {
          if (isCorrect) {
            this.state.score++;

            // [æ–°å¢] åˆ†æ•¸å¢åŠ å‹•ç•«
            const scoreEl = document.getElementById("scoreDisplay");
            if (scoreEl) {
              scoreEl.style.transform = "scale(1.3)";
              scoreEl.style.color = "#2ecc71";
              setTimeout(() => {
                scoreEl.style.transform = "scale(1)";
              }, 300);
            }
          }

          // å°‡çµæœå­˜å…¥é™£åˆ—
          this.state.results.push({
            trial: this.state.currentTrial,
            round: this.state.currentRound,
            stimulus: this.state.currentStimulus,
            inputKey: inputKey,
            isCorrect: isCorrect,
            reactionTime: rt,
          });
        },

        /**
         * ===================================
         * [åŠŸèƒ½] è§¸ç™¼è¦–è¦ºå›é¥‹ï¼ˆå‹•ç•«ï¼‰
         * [åƒæ•¸] isSuccess - æ˜¯å¦æˆåŠŸ
         * [æ–°å¢] åˆºæ¿€ç‰©é–ƒçˆå‹•ç•«
         * ===================================
         */
        triggerFeedback: function (isSuccess) {
          // ç§»é™¤èˆŠå‹•ç•«é¡åˆ¥
          this.elements.container.classList.remove(
            "feedback-success",
            "feedback-error"
          );
          this.elements.stimulus.classList.remove(
            "correct-flash",
            "error-flash"
          );

          // [åˆå­¸è€…] void å¼·åˆ¶ç€è¦½å™¨é‡ç¹ªï¼Œè®“å‹•ç•«å¯ä»¥é‡è¤‡æ’­æ”¾
          void this.elements.container.offsetWidth;

          if (isSuccess) {
            // æ­£ç¢ºï¼šç¶ è‰²é–ƒå…‰ + åˆºæ¿€ç‰©è„ˆè¡æ”¾å¤§
            this.elements.container.classList.add("feedback-success");
            this.elements.stimulus.classList.add("correct-flash");
          } else {
            // éŒ¯èª¤ï¼šç´…è‰²é–ƒå…‰ + åˆºæ¿€ç‰©éœ‡å‹•
            this.elements.container.classList.add("feedback-error");
            this.elements.stimulus.classList.add("error-flash");
          }
        },

        /**
         * ===================================
         * [åŠŸèƒ½] æ›´æ–°ä»‹é¢é¡¯ç¤º
         * [æ–°å¢] é€²åº¦æ¢é¡è‰²è®ŠåŒ–
         * ===================================
         */
        updateUI: function () {
          // æ›´æ–°è©¦é¡Œç·¨è™Ÿé¡¯ç¤º
          this.elements.trialDisplay.innerText = this.state.currentTrial;

          // [æ–°å¢] é€²åº¦æ¢æ›´æ–°
          const progressBar = document.getElementById("progressBar");
          if (progressBar) {
            const progress =
              (this.state.currentTrial / this.state.totalTrials) * 100;
            progressBar.style.width = progress + "%";

            // æ ¹æ“šé€²åº¦æ”¹è®Šé¡è‰²
            if (progress < 30) {
              progressBar.style.background = "#3498db"; // è—è‰²
            } else if (progress < 70) {
              progressBar.style.background = "#f39c12"; // æ©˜è‰²
            } else {
              progressBar.style.background = "#2ecc71"; // ç¶ è‰²
            }
          }
        },

        /**
         * ===================================
         * [åŠŸèƒ½] çµæŸå›åˆ
         * [é‚è¼¯] åˆ¤æ–·è¦é€²å…¥ä¸‹ä¸€å›åˆæˆ–çµæŸ
         * ===================================
         */
        endSession: function () {
          this.state.isPlaying = false;

          if (this.state.isPractice) {
            // ç·´ç¿’çµæŸ â†’ é¡¯ç¤ºç·´ç¿’å®Œæˆç•«é¢
            this.showScreen("practiceEnd");
          } else if (this.state.currentRound === 1) {
            // ç¬¬ä¸€å›çµæŸ â†’ é€²å…¥ç¬¬äºŒå›èªªæ˜
            this.showScreen("intermission");
          } else {
            // ç¬¬äºŒå›çµæŸ â†’ é¡¯ç¤ºæœ€çµ‚æˆç¸¾
            this.showFinalResult();
          }
        },

        /**
         * ===================================
         * [åŠŸèƒ½] é¡¯ç¤ºæœ€çµ‚æˆç¸¾
         * [è¨ˆç®—] æ­£ç¢ºç‡ = (å¾—åˆ† / ç¸½è©¦é¡Œæ•¸) Ã— 100
         * ===================================
         */
        showFinalResult: function () {
          // è¨ˆç®—æ­£ç¢ºç‡
          const totalTrials = CONFIG.round1Trials + CONFIG.round2Trials;
          const accuracy = ((this.state.score / totalTrials) * 100).toFixed(1);

          // æ›´æ–°æˆç¸¾é¡¯ç¤º
          document.getElementById("scoreDisplay").innerText = this.state.score;
          document.getElementById("accuracyDisplay").innerText = accuracy;

          // é¡¯ç¤ºçµæœç•«é¢
          this.showScreen("result");
        },

        /**
         * ===================================
         * [åŠŸèƒ½] åŒ¯å‡ºè³‡æ–™ç‚º CSV æª”æ¡ˆ
         * [Google å®‰å…¨] ä½¿ç”¨è€…ä¸»å‹•è§¸ç™¼ï¼Œç´”æ–‡å­—æª”æ¡ˆ
         * [æ ¼å¼] CSVï¼ˆé€—è™Ÿåˆ†éš”å€¼ï¼‰
         * ===================================
         */
        exportData: function () {
          // å»ºç«‹ CSV æ¨™é ­
          let csvContent =
            "è©¦é¡Œç·¨è™Ÿ,å›åˆ,åˆºæ¿€é¡å‹,æŒ‰éµ,æ˜¯å¦æ­£ç¢º,åæ‡‰æ™‚é–“(ms)\n";

          // [åˆå­¸è€…] forEach éæ­·é™£åˆ—ä¸­çš„æ¯å€‹å…ƒç´ 
          this.state.results.forEach((result) => {
            // å°‡æ¯å€‹çµæœè½‰æ›ç‚º CSV æ ¼å¼çš„ä¸€è¡Œ
            const row = [
              result.trial,
              result.round === 1 ? "ç¬¬ä¸€å›" : "ç¬¬äºŒå›",
              result.stimulus === "sun" ? "å¤ªé™½" : "æ˜Ÿæ˜Ÿ",
              result.inputKey || "æœªåæ‡‰",
              result.isCorrect ? "æ­£ç¢º" : "éŒ¯èª¤",
              result.reactionTime || "N/A",
            ].join(",");

            csvContent += row + "\n";
          });

          // [è‰¯å¥½å¯¦è¸] ä½¿ç”¨æè¿°æ€§å‡½æ•¸åç¨±
          this.downloadCSVFile(csvContent, "åŸ·è¡ŒåŠŸèƒ½è¨“ç·´è³‡æ–™.csv");
        },

        /**
         * ===================================
         * [åŠŸèƒ½] è§¸ç™¼æª”æ¡ˆä¸‹è¼‰
         * [åƒæ•¸] content - æª”æ¡ˆå…§å®¹
         * [åƒæ•¸] filename - æª”æ¡ˆåç¨±
         * [Google å®‰å…¨] ç´”æ–‡å­— CSVï¼Œéå¯åŸ·è¡Œæª”
         * ===================================
         */
        downloadCSVFile: function (content, filename) {
          // [åˆå­¸è€…] Blob ä»£è¡¨ä¸€å€‹æª”æ¡ˆç‰©ä»¶
          const blob = new Blob(["\uFEFF" + content], {
            type: "text/csv;charset=utf-8",
          });

          // å»ºç«‹ä¸‹è¼‰é€£çµ
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = url;
          link.download = filename;

          // è§¸ç™¼ä¸‹è¼‰
          document.body.appendChild(link);
          link.click();

          // æ¸…ç†
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        },

        /**
         * ===================================
         * [åŠŸèƒ½] è™•ç†ç©ºç™½éµï¼ˆé–‹å§‹æŒ‰éˆ•ï¼‰
         * [é‚è¼¯] æ ¹æ“šç•¶å‰ç•«é¢æ±ºå®šè§¸ç™¼å“ªå€‹é–‹å§‹å‡½æ•¸
         * [æ–°å¢] æ”¯æ´ç”¨ç©ºç™½éµé–‹å§‹éŠæˆ²
         * ===================================
         */
        handleSpaceKey: function () {
          // ç·´ç¿’æ¨¡å¼èªªæ˜é é¢
          if (!this.elements.practiceScreen.classList.contains("hidden")) {
            this.startPractice();
          }
          // ç·´ç¿’å®Œæˆé é¢
          else if (!this.elements.practiceEnd.classList.contains("hidden")) {
            this.showScreen("intro");
          }
          // ç¬¬ä¸€å›èªªæ˜é é¢
          else if (!this.elements.introScreen.classList.contains("hidden")) {
            this.startRound1();
          }
          // ç¬¬äºŒå›èªªæ˜é é¢
          else if (
            !this.elements.intermissionScreen.classList.contains("hidden")
          ) {
            this.startRound2();
          }
        },
      };

      /**
       * ========================================
       * éµç›¤äº‹ä»¶ç›£è½
       * [ç”¨é€”] è®“ä½¿ç”¨è€…å¯ä»¥ç”¨éµç›¤ Fã€J å’Œç©ºç™½éµ
       * ========================================
       */
      document.addEventListener("keydown", function (event) {
        // [åˆå­¸è€…] event.key å–å¾—æŒ‰ä¸‹çš„éµ
        const key = event.key.toUpperCase();

        // è™•ç† F å’Œ J éµï¼ˆéŠæˆ²ä¸­ï¼‰
        if (key === "F" || key === "J") {
          game.handleInput(key);
        }

        // [æ–°å¢] è™•ç†ç©ºç™½éµï¼ˆé–‹å§‹æŒ‰éˆ•ï¼‰
        // [åˆå­¸è€…] event.code æ¯” event.key æ›´æº–ç¢ºï¼Œä¸å—èªè¨€å½±éŸ¿
        if (event.code === "Space" || event.key === " ") {
          // [åˆå­¸è€…] preventDefault() é˜²æ­¢ç©ºç™½éµçš„é è¨­è¡Œç‚ºï¼ˆæ»¾å‹•é é¢ï¼‰
          event.preventDefault();
          game.handleSpaceKey();
        }
      });
    </script>
  </body>
</html>
