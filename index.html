<!DOCTYPE html>

<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>è½éšœEFè¨“ç·´éŠæˆ² - DCCSä¸‰å›åˆä¿®æ­£ç‰ˆ</title>

    <meta
      name="description"
      content="ä¸­åŸå¤§å­¸ç‰¹æ®Šæ•™è‚²å­¸ç³»é–‹ç™¼çš„åŸ·è¡ŒåŠŸèƒ½èªçŸ¥è¨“ç·´å·¥å…· - æ¡ç”¨Go/No-Goå…¸ç¯„è¨­è¨ˆçµåˆDCCSé‚Šæ¡†æ¢ä»¶"
    />
    <meta name="author" content="ä¸­åŸå¤§å­¸ç‰¹æ®Šæ•™è‚²å­¸ç³»ç ”ç©¶åœ˜éšŠ" />
    <meta
      name="keywords"
      content="åŸ·è¡ŒåŠŸèƒ½, èªçŸ¥è¨“ç·´, è½éšœæ•™è‚², ä¸­åŸå¤§å­¸, Go-NoGo, æŠ‘åˆ¶æ§åˆ¶, DCCS"
    />

    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;"
    />

    <style>
      /* === [è‰¯å¥½å¯¦è¸] CSS è®Šæ•¸ (Variables) === */
      :root {
        --bg-color: #2c3e50; /* èƒŒæ™¯è‰²ï¼šæ·±è—ç° */
        --text-color: #ecf0f1; /* æ–‡å­—è‰²ï¼šç±³ç™½ */
        --primary-color: #3498db; /* ä¸»è¦æŒ‰éˆ•è—è‰² */
        --success-color: #2ecc71; /* ç­”å°æ™‚çš„ç¶ è‰² */
        --error-color: #e74c3c; /* ç­”éŒ¯æ™‚çš„ç´…è‰² */
        --accent-yellow: #f1c40f; /* èµ·å¸çš„é»ƒè‰² */
        --round1-color: #e67e22; /* ç¬¬ä¸€å›ä»£è¡¨è‰² (æ©˜è‰²) */
        --round2-color: #e74c3c; /* ç¬¬äºŒå›ä»£è¡¨è‰² (ç´…è‰²) */
        --round3-color: #9b59b6; /* ç¬¬ä¸‰å›ä»£è¡¨è‰² (ç´«è‰²) */
        --practice-color: #1abc9c; /* ç·´ç¿’æ¨¡å¼ä»£è¡¨è‰² (é’è‰²) */
        --person-border: #ff6b6b; /* [æ–°å¢] æœ‰äººæ™‚çš„ç´…è‰²é‚Šæ¡†è‰²/æç¤ºè‰² */
      }

      /* body æ˜¯ç¶²é çš„ã€Œèº«é«”ã€ï¼Œè¨­å®šå…¨åŸŸçš„åŸºç¤æ¨£å¼ */
      body {
        font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        text-align: center;
        margin: 0;
        padding: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        touch-action: manipulation;
        box-sizing: border-box;
      }

      /* === ä¸»è¦éŠæˆ²å€åŸŸ === */
      .game-area {
        background-color: #34495e;
        border-radius: 15px;
        padding: 20px;
        width: 100%;
        max-width: 600px;
        margin: 10px auto;
        min-height: 500px;
        height: auto;
        border: 5px solid transparent;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        position: relative;
        box-sizing: border-box;
      }

      /* === åˆºæ¿€ç‰©å®¹å™¨ï¼šè€é¼ æ´ + èµ·å¸/è²“å’ª + äºº === */
      .stimulus-container {
        position: relative;
        width: 300px;
        height: 400px; /* é«˜åº¦å¢åŠ ï¼Œè®“èƒŒæ™¯å¾€ä¸‹å»¶ä¼¸ */
        margin: 20px auto;
      }

      /* èƒŒæ™¯å±¤ */
      .background-layer {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 1;
        top: 0;
        left: 0;
      }

      /* åˆºæ¿€ç‰© (èµ·å¸/è²“å’ª/é­š/é¯Šé­š) */
      .stimulus {
        position: absolute;
        z-index: 10;
        width: 120px; /* ç¸®å°å°ºå¯¸ */
        height: 120px;
        bottom: 50px; /* å›ºå®šåœ¨ä¸‹æ–¹åœ°æ¿ä½ç½® */
        left: 50%;
        transform: translateX(-50%); /* æ°´å¹³ç½®ä¸­ */
        display: flex;
        justify-content: center;
        align-items: center;
        transition: transform 0.1s;
      }

      /* [æ–°å¢] äººç‰©æŒ‡ç¤ºå™¨å®¹å™¨ (DCCS) */
      #personIndicator {
        position: absolute;
        width: 200px;
        height: 200px;
        top: 40px; /* [èª¿æ•´] é…åˆæ”¾å¤§ï¼Œç¨å¾®å¾€ä¸Šç§» */
        left: 50%;
        transform: translateX(-50%); /* æ°´å¹³ç½®ä¸­ */
        z-index: 5; /* ä½æ–¼åˆºæ¿€ç‰©å¾Œæ–¹ï¼Œä½†åœ¨èƒŒæ™¯å‰æ–¹ */
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: none;
        opacity: 0.9;
      }

      #personIndicator svg {
        width: 100%;
        height: 100%;
        filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.5));
      }

      /* ç•¶åœ–æ¡ˆåŠ ä¸Š pop é€™å€‹ class æ™‚ï¼Œæœƒæ”¾å¤§ 1.2 å€ */
      .stimulus.pop {
        transform: translateX(-50%) scale(1.2); /* ä¿æŒæ°´å¹³ç½®ä¸­ä¸¦æ”¾å¤§ */
      }

      /* SVG åœ–ç‰‡çµ±ä¸€æ¨£å¼ */
      .stimulus svg {
        width: 100%;
        height: 100%;
        filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
      }

      /* æŒ‰éˆ•å€å®¹å™¨ */
      .controls-area {
        width: 100%;
        display: flex;
        justify-content: center;
        padding-bottom: 10px;
        gap: 15px;
      }

      /* æŒ‰éµæ¨£å¼ */
      .btn-key {
        width: 200px;
        height: 120px;
        border: none;
        border-radius: 15px;
        font-size: 2.5em;
        color: white;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        transition: transform 0.1s, opacity 0.3s;
        box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
        -webkit-tap-highlight-color: transparent;
        touch-action: none;
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      }

      .btn-key:active,
      .btn-key.active-key {
        transform: translateY(4px);
        box-shadow: none;
      }

      .key-hint {
        font-size: 1rem;
        opacity: 0.8;
        margin-bottom: 5px;
        font-weight: bold;
      }

      /* === RWD æ‰‹æ©Ÿç‰ˆå„ªåŒ– === */
      @media (max-width: 600px) {
        body {
          padding: 5px;
        }
        .game-area {
          min-height: 80vh;
          padding: 15px;
        }
        .stimulus-container {
          width: 250px;
          height: 350px;
        } /* æ‰‹æ©Ÿç‰ˆé«˜åº¦ */
        .stimulus {
          width: 100px;
          height: 100px;
          bottom: 40px;
        }
        #personIndicator {
          width: 160px;
          height: 160px;
          top: 30px;
        }
        .btn-key {
          width: 150px;
          height: 100px;
          font-size: 2em;
        }
        .key-hint {
          font-size: 0.8rem;
        }
        .landing-info {
          padding: 15px;
        }
        .landing-info h3 {
          font-size: 1.2em;
        }
        .landing-info p {
          font-size: 0.9em;
        }
        .rule-icon-large {
          font-size: 2.5em;
        }
        .btn {
          font-size: 1.1em;
        }
      }

      /* é¦–é èªªæ˜å€å¡Š */
      .landing-info {
        background: rgba(255, 255, 255, 0.1);
        padding: 30px;
        border-radius: 15px;
        max-width: 600px;
        margin-bottom: 20px;
        text-align: left;
        border-left: 5px solid var(--primary-color);
      }
      .landing-info h3 {
        margin-top: 0;
        color: var(--primary-color);
      }
      .landing-info p {
        line-height: 1.6;
        opacity: 0.9;
      }

      /* è¦å‰‡èªªæ˜å®¹å™¨ */
      .tutorial-container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
        width: 100%;
        max-width: 400px;
      }

      /* è¦å‰‡å°æ¡†æ¡† */
      .rule-box {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 15px;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        width: 100%;
        border: 2px solid rgba(255, 255, 255, 0.1);
        gap: 15px;
      }

      .rule-box.cheese-box {
        background: rgba(254, 181, 2, 0.2);
      }
      .rule-box.cat-box {
        background: rgba(231, 76, 60, 0.2);
      }

      /* [æ–°å¢] DCCS è¦å‰‡æ¡† */
      .rule-box.person-box {
        background: rgba(255, 107, 107, 0.2);
        border: 2px solid var(--person-border);
        flex-direction: column;
        gap: 5px;
      }

      .rule-icon-large {
        font-size: 3em;
      }
      .rule-arrow {
        font-size: 2em;
        color: #bdc3c7;
      }
      .rule-text {
        font-size: 1.3em;
        font-weight: bold;
      }

      /* å›åˆæ¨™ç±¤ */
      .round-label {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: bold;
        z-index: 10;
        white-space: nowrap;
      }
      .round-practice {
        background-color: var(--practice-color);
      }
      .round1-badge {
        background-color: var(--round1-color);
      }
      .round2-badge {
        background-color: var(--round2-color);
      }
      .round3-badge {
        background-color: var(--round3-color);
      }

      /* é€²åº¦æ¢ */
      .progress-container {
        width: 100%;
        height: 8px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        overflow: hidden;
        margin-top: 10px;
      }
      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #3498db, #2ecc71);
        border-radius: 10px;
        transition: width 0.3s ease;
        width: 0%;
      }

      /* å›é¥‹å‹•ç•« */
      .feedback-success {
        animation: pulse-green 0.3s ease-out;
        border-color: var(--success-color) !important;
      }
      .feedback-error {
        animation: shake-red 0.2s ease-in-out;
        border-color: var(--error-color) !important;
      }

      @keyframes pulse-green {
        0% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7);
        }
        50% {
          transform: scale(1.02);
          box-shadow: 0 0 0 15px rgba(46, 204, 113, 0);
        }
        100% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(46, 204, 113, 0);
        }
      }
      @keyframes shake-red {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-15px);
        }
        75% {
          transform: translateX(15px);
        }
      }

      /* [ä¿®æ­£] ç­”å°å‹•ç•«ï¼šå¿…é ˆä¿ç•™ translateX(-50%) æ‰èƒ½ç¶­æŒç½®ä¸­ */
      @keyframes pulse-correct {
        0% {
          transform: translateX(-50%) scale(1);
        }
        50% {
          transform: translateX(-50%) scale(1.3);
          filter: brightness(1.5);
        }
        100% {
          transform: translateX(-50%) scale(1);
        }
      }

      /* [ä¿®æ­£] ç­”éŒ¯å‹•ç•«ï¼šå¿…é ˆä¿ç•™ translateX(-50%) æ‰èƒ½ç¶­æŒç½®ä¸­ */
      @keyframes shake-error {
        0%,
        100% {
          transform: translateX(-50%) rotate(0deg);
        }
        25% {
          transform: translateX(calc(-50% - 10px)) rotate(-5deg);
        }
        75% {
          transform: translateX(calc(-50% + 10px)) rotate(5deg);
        }
      }

      .correct-flash {
        animation: pulse-correct 0.5s ease-out;
        filter: drop-shadow(0 0 20px #2ecc71);
      }
      .error-flash {
        animation: shake-error 0.4s ease-in-out;
        filter: drop-shadow(0 0 20px #e74c3c);
      }

      .hidden {
        display: none !important;
      }
      .screen-layer {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .btn {
        background-color: var(--primary-color);
        color: white;
        border: none;
        width: 90%;
        max-width: 400px;
        padding: 12px 0;
        font-size: 1.2em;
        white-space: nowrap;
        border-radius: 50px;
        cursor: pointer;
        margin-top: 15px;
        box-sizing: border-box;
      }

      .blink-text {
        animation: blink 1.5s infinite;
      }
      @keyframes blink {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.6;
        }
        100% {
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>ğŸ§  åŸ·è¡ŒåŠŸèƒ½èªçŸ¥è¨“ç·´</h1>
      <p style="opacity: 0.7; font-size: 0.8em">
        ä¸­åŸå¤§å­¸ç‰¹æ•™ç³» | DCCSæ•´åˆç‰ˆ v3.0
      </p>
    </header>

    <main class="game-area" id="gameContainer">
      <!-- é¦–é  -->
      <div id="landingPage" class="screen-layer">
        <div class="landing-info">
          <h3>ğŸ« é—œæ–¼æœ¬ç ”ç©¶å·¥å…·</h3>
          <p>
            æœ¬å·¥å…·ç”±
            <a
              href="https://special.cycu.edu.tw/"
              target="_blank"
              style="color: var(--primary-color); text-decoration: underline"
            >
              ä¸­åŸå¤§å­¸ç‰¹æ®Šæ•™è‚²å­¸ç³»
            </a>
            é–‹ç™¼ã€‚
          </p>
          <p>
            <strong>ğŸ® éŠæˆ²ä¸»é¡Œï¼š</strong><br />
            ç¬¬ä¸€å›åˆï¼šè€é¼ èˆ‡èµ·å¸ (åŸºç¤è¦å‰‡)<br />
            ç¬¬äºŒå›åˆï¼šè€é¼ èˆ‡èµ·å¸ (é€²éšè¦å‰‡)<br />
            ç¬¬ä¸‰å›åˆï¼šæ•é­šéŠæˆ²
          </p>
          <hr
            style="
              border: 0;
              border-top: 1px solid rgba(255, 255, 255, 0.2);
              margin: 15px 0;
            "
          />
          <p><strong>ğŸ”’ éš±ç§æ¬Šè²æ˜ï¼š</strong></p>
          <p>æœ¬æ¸¬é©—ç‚ºç´”å‰ç«¯é‹ä½œï¼Œæ•¸æ“šåƒ…æš«å­˜æ–¼ç€è¦½å™¨ä¸­ã€‚</p>
        </div>
        <div style="margin-bottom: 15px; width: 90%; max-width: 400px">
          <label
            for="playerId"
            style="display: block; margin-bottom: 5px; opacity: 0.8"
          >
            è«‹è¼¸å…¥åº§è™Ÿ+å§“åï¼š
          </label>
          <input
            type="text"
            id="playerId"
            placeholder="ä¾‹å¦‚ï¼š01ç‹å°æ˜"
            style="
              padding: 10px;
              width: 100%;
              border-radius: 10px;
              border: 2px solid var(--primary-color);
              background: rgba(255, 255, 255, 0.9);
              font-size: 1.1em;
              box-sizing: border-box;
              text-align: center;
            "
          />
        </div>
        <button class="btn" onclick="game.showTutorial()">
          ğŸ‘‰ é€²å…¥æ¸¬é©—èªªæ˜
        </button>
        <br />
        <small
          ><a href="privacy.html" style="color: #bdc3c7"
            >è©³ç´°éš±ç§æ¬Šæ”¿ç­–</a
          ></small
        >
      </div>

      <!-- ç¬¬ä¸€å›åˆèªªæ˜é  (åŸºç¤è¦å‰‡) -->
      <div id="introScreen" class="screen-layer hidden">
        <h2>ğŸ® ç¬¬ä¸€å›åˆèªªæ˜</h2>
        <p style="margin-bottom: 20px; color: #bdc3c7; font-size: 1.1em">
          å¹«åŠ©è€é¼ æ”¶é›†èµ·å¸ï¼
        </p>

        <div class="tutorial-container">
          <div class="rule-box cheese-box">
            <span class="rule-icon-large">ğŸ§€</span>
            <span class="rule-arrow">â†’</span>
            <span class="rule-text">æŒ‰ç©ºç™½éµ</span>
          </div>

          <div class="rule-box cat-box">
            <span class="rule-icon-large">ğŸ±</span>
            <span class="rule-arrow">â†’</span>
            <span class="rule-text" style="color: var(--error-color)"
              >ä¸è¦æŒ‰ï¼</span
            >
          </div>
        </div>

        <button class="btn blink-text" onclick="game.startPractice()">
          âŒ¨ï¸ æŒ‰ç©ºç™½éµé–‹å§‹ç·´ç¿’
        </button>
        <h4>ç·´ç¿’æ¨¡å¼ä¸è¨ˆåˆ†</h4>
      </div>

      <!-- ç·´ç¿’çµæŸé  -->
      <div id="practiceEndScreen" class="screen-layer hidden">
        <h2>ğŸ‘ ç·´ç¿’å®Œæˆï¼</h2>
        <p>æ¥ä¸‹ä¾†è¦<b>æ­£å¼é–‹å§‹ç¬¬ä¸€å›åˆ</b>å›‰ï¼</p>
        <div style="margin-top: 20px; width: 100%; text-align: center">
          <button class="btn blink-text" onclick="game.startRound1()">
            âŒ¨ï¸ æŒ‰ç©ºç™½éµé–‹å§‹æ­£å¼æ¸¬é©—
          </button>
        </div>
      </div>

      <!-- [æ–°å¢] ç¬¬äºŒå›åˆèªªæ˜é  (DCCS) -->
      <div id="round2IntroScreen" class="screen-layer hidden">
        <h2 style="color: var(--round2-color)">ğŸ® ç¬¬äºŒå›åˆï¼šé›£åº¦å‡ç´š</h2>
        <p style="margin-bottom: 20px; color: #bdc3c7; font-size: 1.1em">
          è¦å‰‡è·Ÿå‰›æ‰ä¸€æ¨£ï¼Œä½†æ˜¯...<br />
          <b>æœ‰äººå‡ºç¾æ™‚ï¼Œçµ•å°ä¸èƒ½å‹•ï¼</b>
        </p>

        <div class="tutorial-container">
          <div class="rule-box person-box">
            <div
              style="
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
              "
            >
              <span class="rule-icon-large">ğŸ‘¤</span>
              <span class="rule-arrow">â†’</span>
              <span class="rule-text" style="color: var(--person-border)"
                >éƒ½ä¸è¦æŒ‰ï¼</span
              >
            </div>
            <div style="font-size: 0.9em; color: #ddd">
              (äººå‡ºç¾æ™‚ï¼Œä¸ç®¡æ˜¯ä»€éº¼éƒ½ä¸èƒ½æŒ‰)
            </div>
          </div>
        </div>

        <button class="btn blink-text" onclick="game.startRound2Practice()">
          âŒ¨ï¸ æŒ‰ç©ºç™½éµé–‹å§‹ç·´ç¿’
        </button>
      </div>

      <!-- [æ–°å¢] ç¬¬äºŒå›åˆç·´ç¿’çµæŸé  -->
      <div id="round2PracticeEndScreen" class="screen-layer hidden">
        <h2>ğŸ‘ ç·´ç¿’å®Œæˆï¼</h2>
        <p>è¨˜å¾—å–”ï¼š<br />çœ‹åˆ°äºº ğŸ‘¤ å‡ºç¾ï¼Œçµ•å°ä¸èƒ½æŒ‰ï¼</p>
        <p>æº–å‚™å¥½æ­£å¼æŒ‘æˆ°ç¬¬äºŒå›åˆäº†å—ï¼Ÿ</p>
        <div style="margin-top: 20px; width: 100%; text-align: center">
          <button class="btn blink-text" onclick="game.startRound2()">
            âŒ¨ï¸ æŒ‰ç©ºç™½éµé–‹å§‹æ­£å¼æ¸¬é©—
          </button>
        </div>
      </div>

      <!-- ç¬¬ä¸‰å›åˆç·´ç¿’èªªæ˜é  -->
      <div id="round3PracticeScreen" class="screen-layer hidden">
        <h2 style="color: var(--round3-color)">ğŸ® ç¬¬ä¸‰å›åˆï¼šæ•é­šéŠæˆ²ï¼</h2>
        <p style="margin-bottom: 20px; color: #bdc3c7; font-size: 1.1em">
          å ´æ™¯æ›åˆ°æµ·è£¡å›‰ï¼<br />
          é€™æ¬¡æ²’æœ‰ã€Œäººã€äº†ï¼Œå°ˆå¿ƒé‡£é­šå§ï¼
        </p>

        <div class="tutorial-container">
          <div class="rule-box" style="background: rgba(255, 165, 0, 0.2)">
            <span style="font-size: 3em">ğŸŸ</span>
            <span class="rule-arrow">â†’</span>
            <span class="rule-text">å¿«æŒ‰ç©ºç™½éµï¼</span>
          </div>

          <div class="rule-box" style="background: rgba(231, 76, 60, 0.2)">
            <span style="font-size: 3em">ğŸ¦ˆ</span>
            <span class="rule-arrow">â†’</span>
            <span class="rule-text" style="color: var(--error-color)"
              >ä¸è¦æŒ‰ï¼</span
            >
          </div>
        </div>

        <button class="btn blink-text" onclick="game.startRound3Practice()">
          âŒ¨ï¸ æŒ‰ç©ºç™½éµé–‹å§‹ç·´ç¿’
        </button>
      </div>

      <!-- ç¬¬ä¸‰å›åˆç·´ç¿’çµæŸé  -->
      <div id="round3PracticeEndScreen" class="screen-layer hidden">
        <h2>ğŸ‘ ç·´ç¿’å®Œæˆï¼</h2>
        <p>æº–å‚™å¥½æ­£å¼æŒ‘æˆ°äº†å—ï¼Ÿ</p>
        <div style="margin-top: 20px; width: 100%; text-align: center">
          <button class="btn blink-text" onclick="game.startRound3()">
            âŒ¨ï¸ æŒ‰ç©ºç™½éµé–‹å§‹æ­£å¼æ¸¬é©—
          </button>
        </div>
      </div>

      <!-- éŠæˆ²é€²è¡Œç•«é¢ -->
      <div
        id="playScreen"
        class="hidden"
        style="
          width: 100%;
          height: 100%;
          display: flex;
          flex-direction: column;
          justify-content: space-between;
        "
      >
        <div style="width: 100%">
          <div id="roundLabel" class="round-label round1-badge">ç¬¬ä¸€å›</div>
          <div
            style="
              margin-top: 25px;
              display: flex;
              justify-content: space-between;
              padding: 0 10px;
            "
          >
            <span
              >é€²åº¦: <span id="currentTrialDisplay">0</span>/<span
                id="totalTrialDisplay"
                >10</span
              ></span
            >
          </div>
          <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
          </div>
        </div>

        <!-- åˆºæ¿€ç‰©é¡¯ç¤ºå€ -->
        <div class="stimulus-container">
          <!-- [æ–°å¢] äººç‰©æŒ‡ç¤ºå™¨ (é è¨­éš±è—) -->
          <div id="personIndicator" style="display: none"></div>

          <!-- èƒŒæ™¯å®¹å™¨ -->
          <div class="background-layer" id="backgroundLayer"></div>

          <!-- åˆºæ¿€ç‰©å®¹å™¨ -->
          <div class="stimulus" id="stimulusBox"></div>
        </div>

        <!-- æŒ‰éˆ•æ§åˆ¶å€ -->
        <div class="controls-area">
          <button
            id="btnSpace"
            class="btn-key"
            onpointerdown="game.handleInput('Space')"
          >
            <span class="key-hint">æŒ‰ç©ºç™½éµ</span>
            <span>åæ‡‰éµ</span>
          </button>
        </div>
      </div>

      <!-- çµæœé é¢ -->
      <div id="resultScreen" class="screen-layer hidden">
        <h2>ğŸ‰ å…¨éƒ¨å®Œæˆï¼</h2>
        <div
          style="
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            width: 100%;
            box-sizing: border-box;
          "
        >
          <p>
            ç­”å°é¡Œæ•¸ï¼š<span
              id="scoreDisplay"
              style="color: var(--success-color); font-size: 1.5em"
              >0</span
            >
          </p>
          <p>å¹³å‡é€Ÿåº¦ï¼š<span id="avgTimeDisplay">0ms</span></p>
        </div>
        <button class="btn" onclick="location.reload()">ğŸ”„ å›åˆ°é¦–é </button>
        <button
          class="btn"
          onclick="game.exportData()"
          style="background-color: #7f8c8d"
        >
          ğŸ“¥ åŒ¯å‡ºè³‡æ–™
        </button>
      </div>
    </main>

    <script>
      const CONFIG = {
        practiceTrials: 3, // ç·´ç¿’é¡Œæ•¸
        round1Trials: 3, // ç¬¬ä¸€å›é¡Œæ•¸
        round2PracticeTrials: 3, // [æ–°å¢] ç¬¬äºŒå›ç·´ç¿’é¡Œæ•¸
        round2Trials: 3, // [æ–°å¢] ç¬¬äºŒå›é¡Œæ•¸
        round3PracticeTrials: 3, // [ä¿®æ”¹] ç¬¬ä¸‰å›ç·´ç¿’é¡Œæ•¸
        round3Trials: 3, // [ä¿®æ”¹] ç¬¬ä¸‰å›é¡Œæ•¸
        stimulusDuration: 2000,
        isiMin: 800,
        isiMax: 1200,
        goRatio: 0.75,
        personRatio: 0.25, // [æ–°å¢] ç¬¬ä¸€å›åˆäººå‡ºç¾çš„æ©Ÿç‡
        debugMode: true,
      };

      const SVG_ASSETS = {
        cheese: `<?xml version="1.0" encoding="utf-8"?><svg width="200px" height="200px" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg"><path d="M48.18 68.45L6.7 69.95s-2.63-2.63-2.25-3.57S39.18 38.6 40.49 38.79s4.32 3.38 6.76 2.25c2.44-1.13 0-7.7.75-8.63c.75-.94 27.59-15.39 29.28-16.14c1.69-.75 3.19-2.44 6.57-1.69s11.83 2.25 21.02 8.45s18.77 13.33 18.02 17.27c-.75 3.94-74.71 28.15-74.71 28.15z" fill="#ffe265"></path><path d="M19.46 115.57c9.2-1.13 94.98-19.52 98.55-20.08c3.57-.56 5.82-3.94 5.82-7.7s-.94-47.49-.94-47.49s-4.13 1.31-9.01 2.44C109 43.86 69.01 53.62 53.25 57.19S12.33 67.33 9.51 67.33s-5.07-.94-5.07-.94s.75 39.04.94 41.86c.19 2.82 1.5 6.19 4.69 7.13s5.27.69 9.39.19z" fill="#feb502"></path><path d="M74.97 25.56c0 2.4 2.44 3.99 6.48 3.87c4.41-.13 5.63-2.75 5.49-4.43c-.14-1.69-2.17-3.17-6.19-3.1c-3.73.07-5.78 1.55-5.78 3.66z" fill="#ff8b0d"></path><path d="M29.92 55.48c-6.5 2.19-5.77 7.88-3.87 9.15c1.9 1.27 4.43 1.2 7.39.14s4.84-2.27 5.14-4.25c.28-1.88-2.18-7.23-8.66-5.04z" fill="#ed6b31"></path><path d="M88.98 39.22c-4.36.2-9.18 3.33-10.98 6.34c-1.9 3.17-2.04 6.9 2.32 9.22c4.36 2.32 19.78-3.59 19.01-9.01c-.77-5.43-5.77-6.76-10.35-6.55z" fill="#ed6b31"></path><path d="M73.85 83.07s6.19-4.58 6.19-7.81c0-3.24-2.67-10.89-14.01-11.47c-10.63-.55-17.18 13.94-10.21 21.4c6.97 7.46 11.19 4.08 13.8 3.38c2.61-.71 4.23-5.5 4.23-5.5z" fill="#ed6b31"></path><path d="M43.23 96.09s6.15-3.85 1.43-8.07c-3.32-2.97-7.76-1.63-10.02.68c-2.89 2.96-2.11 7.67.56 9.78c2.68 2.12 8.03-2.39 8.03-2.39z" fill="#ed6b31"></path><path d="M22.39 78.78s-.7-2.21-3.21-3.1c-2.82-1-7.03 2.51-5.23 6.26c1.62 3.38 5.21 2.39 5.21 2.39l3.23-5.55z" fill="#ed6b31"></path><path d="M112.42 82.01c.61-.66 4.6-3.54 4.6-5.73c0-2.18-6.01-8.92-13.68-3.85s-3.66 12.74-1.55 14.01c2.11 1.27 7.96-1.54 10.63-4.43z" fill="#ed6b31"></path></svg>`,
        cat: `<?xml version="1.0" encoding="utf-8"?><svg width="200px" height="200px" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg"><path fill="#292F33" d="M10.478 22.439s.702 2.281-.337 7.993c-.186 1.025-.46 2.072-.599 2.93c-1.757 0-1.851 2.002-1.478 2.002h2.094c1.337 0 2.971-3.334 3.854-7.961s-3.534-4.964-3.534-4.964zm13.042 3.702s2.272 1.22 2.188 4.081c-.033 1.131-.249 2.091-.355 3.024c-1.832 0-1.839 1.985-1.305 1.985h1.856c.923 0 3.001-3.158 3.379-7.281c.379-4.122-5.763-1.809-5.763-1.809z"></path><path fill="#292F33" d="M36 8.447C36 3.525 31.859 1 27 1a1 1 0 1 0 0 2c1.804 0 6.717.934 6.717 5.447c0 2.881-1.567 5.462-3.77 5.982c-.164-.073-.345-.104-.509-.192c-7.239-3.917-13.457.902-15.226-.29c-1.752-1.182-.539-3.255-2.824-5.243c-.33-1.841-1.073-4.477-1.794-4.477c-.549 0-1.265 1.825-1.74 3.656c-.591-1.381-1.363-2.756-1.86-2.756c-.64 0-1.278 2.273-1.594 4.235c-1.68 1.147-2.906 2.809-2.906 4.765c0 2.7 4.05 3.357 5.4 3.411c1.35.054 3.023 3.562 3.585 5.072c1.242 4.367 2.051 8.699 2.698 11.183c-1.649 0-1.804 2.111-1.348 2.111c.713 0 1.953-.003 2.225 0c1.381.014 2.026-4.706 2.026-8.849c0-.212-.011-.627-.011-.627s1.93.505 6.038-.208c2.444-.424 5.03.849 5.746 3.163c.527 1.704 1.399 3.305 1.868 4.484c-1.589 0-1.545 2.037-1.084 2.037c.787 0 1.801.014 2.183 0c1.468-.055.643-7.574 1.03-10.097s1.267-5.578-.229-8.797C34.857 15.236 36 11.505 36 8.447z"></path><circle fill="#C3C914" cx="5.994" cy="11.768" r=".9"></circle><path fill="#66757F" d="M2.984 12.86c-.677.423-.677 1.777-1.015 1.777S.954 13.841.954 12.86c-.001-.981 2.862-.52 2.03 0zm3.594 1.483c-.041.026-.09.036-.142.026c-.018-.004-1.548-.241-2.545.146c-.129.05-.341-.023-.413-.191s.023-.365.152-.415c1.44-.569 2.857-.234 2.934-.218c.139.029.195.19.188.372c-.004.114-.104.235-.174.28z"></path><path fill="#292F33" d="M5.976 10.982s.333.347.319.778c-.014.43-.25.833-.25.833s-.292-.347-.319-.826c-.027-.48.25-.785.25-.785z"></path></svg>`,
        // [ä¿®æ”¹] è€é¼ æ´ SVGï¼šé«˜åº¦å¢åŠ åˆ° 400pxï¼Œç‰†å£èˆ‡åœ°æ¿ä¸‹ç§»
        mouseHole: `<svg viewBox="0 0 300 400" xmlns="http://www.w3.org/2000/svg"><style>:root { --wall-color: #E0CCB8; --floor-color: #95a5a6; --baseboard-color: #bdc3c7; } .wall { fill: var(--wall-color); } .floor { fill: var(--floor-color); } .baseboard { fill: var(--baseboard-color); } .hole { fill: #1a252f; transform-box: fill-box; transform-origin: bottom center; animation: openHole 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards; } @keyframes openHole { 0% { transform: scaleY(0); opacity: 0; } 100% { transform: scaleY(1); opacity: 1; } }</style><rect x="0" y="0" width="300" height="350" class="wall" /><rect x="0" y="350" width="300" height="50" class="floor" /><rect x="0" y="335" width="300" height="15" class="baseboard" /><path class="hole" d="M 110 350 L 110 300 A 40 40 0 0 1 190 300 L 190 350 Z" /></svg>`,
        // [æ–°å¢] äºº SVG
        person: `<?xml version="1.0" encoding="utf-8"?><svg width="200px" height="200px" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--noto" preserveAspectRatio="xMidYMid meet"><defs><linearGradient id="IconifyId17ecdb2904d178eab19193" gradientUnits="userSpaceOnUse" x1="51.872" y1="77.64" x2="69.122" y2="65.64" gradientTransform="matrix(1 0 0 -1 0 128)"><stop offset="0" stop-color="#f78c1f"/><stop offset=".482" stop-color="#f47f12"/><stop offset="1" stop-color="#ef6c00"/></linearGradient><linearGradient id="IconifyId17ecdb2904d178eab19194" gradientUnits="userSpaceOnUse" x1="59.199" y1="57.617" x2="56.005" y2="76.342" gradientTransform="matrix(1 0 0 -1 0 128)"><stop offset=".461" stop-color="#f9ddbd"/><stop offset="1" stop-color="#ffd29c"/></linearGradient><linearGradient id="IconifyId17ecdb2904d178eab19195" gradientUnits="userSpaceOnUse" x1="53.334" y1="44.839" x2="55.581" y2="50.692" gradientTransform="matrix(1 0 0 -1 0 128)"><stop offset=".456" stop-color="#f9ddbd"/><stop offset="1" stop-color="#ffd29c"/></linearGradient><radialGradient id="IconifyId17ecdb2904d178eab19196" cx="63.435" cy="103.503" r="7.122" gradientTransform="matrix(.9381 .3463 .4988 -1.351 -47.703 142.36)" gradientUnits="userSpaceOnUse"><stop offset=".45" stop-color="#454140" stop-opacity="0"/><stop offset="1" stop-color="#454140"/></radialGradient><radialGradient id="IconifyId17ecdb2904d178eab19197" cx="64.277" cy="110.685" r="7.219" gradientTransform="matrix(.9909 -.1344 -.1696 -1.2504 19.355 164.355)" gradientUnits="userSpaceOnUse"><stop offset=".45" stop-color="#454140" stop-opacity="0"/><stop offset="1" stop-color="#454140"/></radialGradient><radialGradient id="IconifyId17ecdb2904d178eab19198" cx="56.224" cy="113.176" r="14.858" gradientTransform="matrix(.9882 -.1534 -.1153 -.7428 13.715 107.517)" gradientUnits="userSpaceOnUse"><stop offset=".45" stop-color="#454140" stop-opacity="0"/><stop offset="1" stop-color="#454140"/></radialGradient><radialGradient id="IconifyId17ecdb2904d178eab19199" cx="65.076" cy="102.635" r="7.999" gradientTransform="matrix(.9692 .2463 .1583 -.6231 -14.242 73.291)" gradientUnits="userSpaceOnUse"><stop offset=".45" stop-color="#454140" stop-opacity="0"/><stop offset="1" stop-color="#454140"/></radialGradient></defs><g><animateTransform attributeName="transform" type="rotate" values="-25 70 70; 25 70 70; -25 70 70" dur="1s" repeatCount="indefinite" /><path d="M85.26 108.68L71.19 92.63c-.88-1-1.4-2.26-1.48-3.59l-1.38-22.46l-15.5 1.71l4.88 23.17c.79 3.75 2.9 7.09 5.94 9.42l16.49 12.6l5.12-4.8z" fill="#616161"/><path d="M89.65 111.84c.45-.45.45-1.17 0-1.62l-1.98-1.98c-1.35-1.35-4.24-1.52-4.24-1.52l-4.93 4.93l-2.97 5.91c-.65 1.5-.33 3.24.82 4.41l.89.9c.39.39 1.03.39 1.42 0l10.99-11.03z" fill="#325599"/></g><g><animateTransform attributeName="transform" type="rotate" values="25 68 63; -25 68 63; 25 68 63" dur="1s" repeatCount="indefinite" /><path d="M68.15 62.88l-17.58 1.61l-4.53 20.39c-.83 3.76-1.12 7.63-.85 11.47l1.63 23.24h6.67l2.95-25.03s5.01-13.32 5.17-13.4c4.07-1.93 7.59-4.92 7.41-9.83c-.09-2.82-.55-5.66-.87-8.45z" fill="#7c7c7c"/><path d="M54.6 123.98c.63 0 1.15-.51 1.15-1.15v-2.8c0-1.9-1.93-4.07-1.93-4.07h-6.98l-6.28 2.07c-1.52.6-2.53 2.06-2.54 3.69l-.01 1.26c0 .55.45 1 1 1H54.6z" fill="#4568ad"/></g><g><animateTransform attributeName="transform" type="translate" values="0 0; 0 -3; 0 0" dur="0.5s" repeatCount="indefinite" /><path d="M67.17 13.34c-2.51-4.06-8.2-7.22-12.91-6.44c-5.28.87-8.11 4.67-8.86 9.49c-.27 1.75-.22 3.49.08 4.72c.04.15.33 1.22.35 1.56c.2 1.3-2.32 2.59-2.61 4.02c-.22 1.08 2.03 1.77 2.21 1.96c.88.97-.51 5.58 5.66 6.04c2.37.18 1.91.03 2.61.3c1.09.42.99 3.32.99 3.32s.61 4.78 4.69 3.51c4.66-1.44 4.84-4.74 4.84-4.74s-1.73-4.6 1.05-9.38c2.21-3.82 3.52-11.75 1.9-14.36z" fill="#f9ddbd"/><path d="M46.05 31.23c.86.05 1.7-.15 2.43-.69c.79-.59.25-1.24-.66-.86c-.55.23-1.32.35-2.02.22l.25 1.33z" fill="#444"/><ellipse transform="rotate(-1.812 49.645 23.394)" cx="49.65" cy="23.39" rx="1.13" ry="1.74" fill="#312d2d"/><path d="M48.77 20.82c-1.12.26-1.34-.48-.94-1.04c.29-.42.98-.74 2.25-.42c1.2.3 1.66 1.03 1.97 1.47s.24.86-.04.89c-.38.02-1.86-1.22-3.24-.9z" fill="#454140"/><path d="M64.89 73.51h-11.9c-2.27 0-4.12-2.18-4.12-4.86l2.15-22.5c.44-4.11 2.53-8.09 4.63-9.59c1.97-1.41 4.82-1.64 4.82-1.64c1.53-.12 3.8.25 5.25 2.37c.87 1.27 1.52 3.75 1.66 5.88L69 68.65c0 2.69-1.84 4.86-4.11 4.86z" fill="url(#IconifyId17ecdb2904d178eab19193)"/><path d="M66.8 60.29l-2.25-13.83l-6.97 1.13l2.15 13.19l-3.57 9.84c-.23.45-3.46 1.91-3.66 2.01c-.62.3-1.05.89-1.37 2.06c-.19.72-.67 2.78.34 3.14c-.34.95-.12 2.14.14 2.42c.6.65 1.33.36 1.33.36s.1.83.76 1.06c.82.29 1.39-.16 1.39-.16c.29.22.64.34 1.01.34c.44 0 .83-.17 1.13-.39c.19.08.71.39 1.37-.08c.42-.3 1.74-2.03 2.15-3.14c.28-.76.24-4.58.59-5.25c.35-.67 5.14-10.2 5.14-10.2h-.01c.43-.79.53-1.68.33-2.5z" fill="url(#IconifyId17ecdb2904d178eab19194)"/><path d="M58.88 78.7c-.23-.6-.38-.64-.8-.53c-.57.15-1.19.13-1.54-.57c-.08-.17-.2-.23-.38-.17c-.61.2-1.37.21-1.63-.71c-.1-.34-.24-.38-.61-.38c-.12 0-.47.15-.83-.23c-.4-.43.14-1.29-.37-1.37c-.15-.02-.87.06-1.09-.71c-.14-.5.44-1.1.45-1.11c-.4.35-.71.9-.94 1.78c-.19.72-.67 2.78.34 3.14c-.34.95-.12 2.14.14 2.42c.6.65 1.33.36 1.33.36s.1.83.76 1.06c.82.29 1.39-.16 1.39-.16c.29.22.64.34 1.01.34c.44 0 .83-.17 1.13-.39c.19.08.71.39 1.37-.08c.35-.25 1.34-1.52 1.89-2.58c-.49.39-1.45.34-1.62-.11z" fill="url(#IconifyId17ecdb2904d178eab19195)"/><path d="M58.37 79.39c.07.49-.06.86-.24 1.22c-.2.34-.44.65-.89.86c-.07-.49.06-.86.24-1.22c.19-.34.44-.65.89-.86z" fill="#edbd82"/><path d="M56.35 78.48c.07.63-.07 1.19-.27 1.72c-.22.52-.48 1.03-.97 1.44c-.07-.64.07-1.19.27-1.72c.22-.51.49-1.02.97-1.44z" fill="#edbd82"/><path d="M53.95 77.48c.12.62.02 1.18-.13 1.72c-.17.53-.4 1.05-.85 1.5c-.12-.62-.02-1.18.13-1.72c.18-.53.41-1.05.85-1.5z" fill="#edbd82"/><path d="M53.8 73.88c-.31.27-.61.55-.86.85c-.27.3-.4.57-.49.96c-.23.74-.46 1.51-1 2.22c-.16-.87 0-1.69.33-2.47c.17-.38.5-.82.86-1.04c.37-.25.76-.42 1.16-.52z" fill="#edbd82"/><g><path d="M56.4 53l10.9-1.98l-1.76-9.69a5.538 5.538 0 0 0-6.44-4.46a5.538 5.538 0 0 0-4.46 6.44L56.4 53z" fill="#ed6d23"/></g><g><path d="M70.66 13.53c-1.32-3.31-4-4.31-4.88-4.55c-.41-1.2-2.49-5.75-10-4.51c-1.83.3-3.17 1.17-4.35 1.94c-.5.33-.98.65-1.43.86c-.37.17-1.01.33-1.54.16c-1.21-.4-.83-2.24-.83-2.24s-4.44.88-2.53 5.17c-1.49.66-2.18 2.24-2.44 3.73c-.36 2.03.63 3.96 2.58 4.83c0 0-.39-3.26 4.32-3.07c1.46.06 2.99.29 4.34-.26c.52-.21 1-.54 1.5-.78h.18c1.78.95-.56 5.16 1.42 7.62c.39.49.72.31.72.31l.79-1.17c.6-.8 1.15-1.5 1.9-1.33c2.22.49 1.82 4.45-.81 5.32c-.26.09.35 4.5 5.8 4.5c2.82 0 3.81-2.34 3.81-2.34s-1.2.3-1.46-.72c-.14-.53.35-1.25 1.23-2.03c2.54-2.26 1.62-4.86 1.25-5.67c.4-.76 1.46-3.18.43-5.77z" fill="#312d2d"/></g><path d="M70.24 19.29c.05-.09-.79 2.01-4.39 1.66c-1.48 0-3.54 3.57-1.38 5.93c1.92 2.08 4.75.83 4.75.83s-.39.11-.96-.08c-.37-.13-.5-.61-.5-.64c-.14-.53.35-1.25 1.23-2.03c2.54-2.27 1.62-4.86 1.25-5.67z" fill="url(#IconifyId17ecdb2904d178eab19196)"/><path d="M70.66 13.53c-.69-1.74-1.96-3.21-3.64-4.06c-.24-.12-.84-.41-1.25-.49c.2.77.18 1.6-.15 2.45c-.01.03-.39 1.3-1.48 2.31c.79 1.1 1.19 2.43 1.57 3.74c.33 1.14.65 2.4.14 3.47c.69-.04 1.79.15 3-.39c1.16-.52 1.77-1.86 2.05-3.06c.31-1.31.26-2.7-.24-3.97z" fill="url(#IconifyId17ecdb2904d178eab19197)"/><path d="M65.61 11.44c.87-2.23-.36-4.29-2.21-5.66c-2.18-1.61-5.04-1.73-7.62-1.31c-1.83.3-3.17 1.17-4.35 1.94c-.51.33-.99.64-1.44.86c-.37.17-1.01.33-1.54.16c-1.21-.4-.83-2.24-.83-2.24s-4.44.88-2.53 5.17c-1.49.66-2.18 2.24-2.44 3.73c-.36 2.03.63 3.96 2.58 4.83c0 0-.39-3.26 4.32-3.07c1.46.06 2.99.29 4.34-.26c1.2-.48 1.6-1.13 2.95-1.06c1.45.08 3.38.63 4.87.4c3.01-.46 3.89-3.45 3.9-3.49z" fill="url(#IconifyId17ecdb2904d178eab19198)"/><path d="M64.47 26.88c-.97-1.03-1.23-2.73-2.75-3.63c-.28.99-.99 1.92-2.12 2.3c-.26.09.35 4.5 5.8 4.5c2.82 0 3.81-2.34 3.81-2.34s-2.79 1.24-4.74-.83z" fill="url(#IconifyId17ecdb2904d178eab19199)"/></g></svg>`,
      };

      const SVG_ASSETS_FISHING = {
        fish: `<?xml version="1.0" encoding="utf-8"?><svg width="200px" height="200px" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path fill="#FFA500" d="M315.441 375.133c29.222 39.684 23.023 38.75 42.477 49.205c40.166 21.585-35.655 36.476-69.779 20.388c-34.134-16.08-49.581-55.064-34.495-87.066c15.078-32.002 39.42-12.909 61.797 17.473m185.879 6.456l-2.598-3.253s-.542-.678-1.545-1.838c-.994-1.198-2.545-2.711-4.255-4.896c-.444-.528-.889-1.1-1.385-1.649c-.474-.573-1.01-1.107-1.477-1.785c-.956-1.333-2.041-2.651-3.155-4.066a128.536 128.536 0 0 0-3.291-4.678c-1.055-1.702-2.192-3.427-3.322-5.204c-2.109-3.721-4.384-7.562-6.229-11.847c-.451-1.078-1.046-2.064-1.423-3.194a75.261 75.261 0 0 0-1.333-3.299c-.248-.534-.422-1.114-.602-1.687c-.196-.565-.392-1.137-.587-1.709c-.392-1.13-.837-2.253-1.123-3.442c-.339-1.168-.656-2.343-1.04-3.502c-.293-1.183-.534-2.395-.836-3.586c-.143-.602-.331-1.182-.444-1.792l-.302-1.838l-.354-1.823c-.12-.61-.279-1.204-.309-1.838c-.12-1.242-.316-2.47-.489-3.712c-.038-.287-.12-.648-.12-.889l-.023-.701c-.022-.467-.06-.934-.106-1.4c-.045-.467-.105-.927-.165-1.394l-.03-.173l-.007-.084l-.007-.173l-.015-.715l-.045-1.423l-.139-4.564l.003-.046l.007-.234l.023-.474l.03-.949l.052-1.898c.03-.633-.023-1.272.045-1.898l.174-1.883l.15-1.876c.03-.633.053-1.258.174-1.876c.173-1.235.369-2.462.489-3.712c.03-.625.188-1.228.309-1.831l.354-1.831l.302-1.83c.113-.61.302-1.191.444-1.793c.302-1.19.542-2.402.836-3.593c.384-1.152.701-2.327 1.04-3.502c.286-1.19.731-2.305 1.123-3.442c.196-.572.392-1.137.587-1.702c.18-.573.354-1.152.602-1.687a78.403 78.403 0 0 0 1.333-3.299c.377-1.13.972-2.116 1.423-3.193c1.845-4.286 4.12-8.135 6.229-11.847c1.13-1.785 2.267-3.503 3.322-5.212a120.672 120.672 0 0 0 3.291-4.67c1.114-1.416 2.199-2.734 3.155-4.067c.512-.708.881-1.137 1.288-1.664c.399-.497.76-1.025 1.122-1.507l1.032-1.416c.075-.113.158-.226.234-.339c.135-.128.271-.256.399-.383c.264-.249.519-.49.76-.724c.987-.918 1.8-1.732 2.47-2.395a88.219 88.219 0 0 0 2.012-2.064c4.285-4.661 6.62-11.192 5.739-17.962c-1.59-12.149-12.721-20.705-24.869-19.116c0 0-1.002.136-2.847.445a98.54 98.54 0 0 0-3.382.625c-.331.06-.678.128-1.032.196c-.174.037-.354.074-.542.105c-.226.075-.46.151-.693.234c-.949.324-1.95.67-3.013 1.04c-1.062.383-2.199.768-3.374 1.227c-1.152.451-2.485.941-3.577 1.439c-2.32.994-4.783 2.184-7.464 3.45c-2.583 1.385-5.295 2.967-8.164 4.677c-2.756 1.838-5.656 3.834-8.594 6.048c-5.717 4.594-11.764 9.979-17.217 16.585c-1.192 1.339-2.321 2.76-3.43 4.217c-18.948-61.637-55.38-97.798-97.567-125.726C243.856 48.11 193.567 53.683 157.694 81.67c-35.88 27.988-32.234 96.849-32.234 96.849l283.366 57.231l-.12.2c-1.182 1.996-2.425 3.999-3.427 6.145c-1.047 2.125-2.124 4.263-3.141 6.455c-.941 2.214-1.831 4.481-2.727 6.763c-.429 1.153-.896 2.298-1.281 3.465c-.369 1.175-.737 2.357-1.107 3.54c-.347 1.198-.701 2.388-1.055 3.585c-.346 1.198-.723 2.395-.964 3.623c-.565 2.447-1.055 4.918-1.567 7.396c-.542 2.47-.746 4.994-1.092 7.51l-.452 3.781c-.158 1.265-.166 2.531-.241 3.803l-.158 3.804l-.067 1.906l-.038.949l-.016.482l-.007.234v.12c.007.64-.03-1.258.023 1.461l.241 5.709l.06 1.423l.038.708l.007.188l.03.264l.053.534l.459 4.271l.512 4.256l.287 2.116c.105.701.241 1.258.361 1.898c.512 2.478 1.001 4.948 1.567 7.388c.241 1.228.618 2.425.964 3.631c.354 1.197.708 2.388 1.055 3.577c.37 1.19.738 2.365 1.107 3.548c.384 1.167.851 2.312 1.281 3.457c.896 2.289 1.785 4.549 2.727 6.77c1.017 2.184 2.093 4.331 3.141 6.455c1.001 2.147 2.244 4.142 3.427 6.146c1.205 1.98 2.32 3.984 3.645 5.829c2.606 3.713 5.144 7.321 7.999 10.53c5.453 6.605 11.501 11.99 17.217 16.584c2.937 2.215 5.837 4.211 8.594 6.048c2.869 1.71 5.581 3.291 8.164 4.678c2.681 1.258 5.144 2.455 7.464 3.441c2.312 1.002 4.534 1.733 6.5 2.411c.987.331 1.913.64 2.794.934c.866.309 1.74.467 2.515.678c1.567.406 2.907.708 3.992.941c2.161.474 3.314.678 3.314.678c5.807.979 12.072-.406 17.036-4.368c9.247-7.382 10.761-20.857 3.38-30.106z"></path><path fill="#FFD700" d="M440.024 284.917c0 45.996-97.158 153.524-217.016 153.524c-85.566 0-159.564-35.037-194.902-85.935c-2.493-3.586.271-8.458 4.625-8.082c4.722.415 10.469.867 15.982 1.168c6.997.392 10.153-8.601 4.459-12.683c-10.876-7.803-25.05-17.684-34.344-23.085c-7.584-4.42-12.465-12.381-12.766-21.156A119.552 119.552 0 0 1 6 284.917c0-84.79 97.157-153.523 217.007-153.523c119.859-.001 217.017 107.528 217.017 153.523"></path><path fill="#2B3B47" d="M85.367 231.356c9.151 0 16.577 7.411 16.577 16.592v20.374c0 9.165-7.426 16.592-16.577 16.592c-9.166 0-16.592-7.427-16.592-16.592v-20.374c0-9.181 7.426-16.592 16.592-16.592"></path><path fill="#FF8C00" d="M225.435 374.209c-4.791 6.726-10.673 1.431-8.27-6.477c5.566-18.301 10.122-47.637 10.122-80.693c0-33.064-4.556-62.391-10.122-80.693c-2.403-7.908 3.479-13.202 8.27-6.477c12.351 17.33 21.253 49.882 21.253 87.171c0 37.295-8.902 69.84-21.253 87.169m58.089-24.374c8.894-12.487 15.311-35.933 15.311-62.798c0-26.865-6.417-50.312-15.311-62.799c-3.458-4.843-7.691-1.024-5.958 4.67c4.014 13.188 7.29 34.313 7.29 58.129c0 23.815-3.276 44.948-7.29 58.136c-1.733 5.695 2.5 9.513 5.958 4.662"></path></svg>`,
        shark: `<?xml version="1.0" encoding="utf-8"?><svg width="200px" height="200px" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg"><path d="M30.77 22.75c-15.51 7.17-26.7 18.4-26.61 21.12c.05 1.41.77 3.94 2.82 6.1c1.21 1.28 4.43 3.61 6.69 3.75c2.25.14 18.51-10.7 18.51-10.7l16.19-2.25l9.85 23.51s3.24 4.65 7.74 8.45s8.87 5.07 9.85 4.22s-1.9-6.55-2.11-8.02c-.28-1.96-1.13-6.76 3.66-6.05s13.66 4.22 13.66 9.43s-3.52 10.98-13.51 10.98s-24.07-3.24-30.55-2.96c-6.48.28-12.25.84-18.16 3.24c-4.38 1.77-9.29 5.07-9.15 5.49c.14.42 5.63 2.25 12.11 3.1s19.01.7 21.12 3.8c2.11 3.1 2.67 7.56 1.97 14.17s-.42 12.01-.28 12.01c.14 0 5.67-3.16 8.45-8.02c4.5-7.88 4.5-17.46 6.19-19.43c1.69-1.97 8.69-2.51 14.36-3.24c5.82-.75 38.86-2.11 38.86-35.05c0-26.47-25.2-32.38-25.76-32.94c-.56-.56-1.48-4.7.42-8.45c1.5-2.96 4.04-7.46 3.24-8.59c-.99-1.4-10.14.14-16.89 3.66s-11 8.02-11 8.02s-25.97-2.61-41.67 4.65z" fill="#6B7F8C"></path><path d="M34.71 36.82c5.13-2.27 13.53-4.11 19.85-4.5c11.33-.7 20.98.63 20.98.63s4.12 8.59 7.46 12.88c5.84 7.5 14.25 13.3 15.38 11.68c.94-1.35.18-8.45-1.3-12.81c-.73-2.15-3.1-7.88-3.1-7.88s10.28.84 16.19 9.29c5.91 8.45 8.3 26.33-4.65 33.93c-11.26 6.62-17.6 5.63-17.6 5.63s6.75-7.46 5.68-12.72c-1.13-5.54-3.57-7.04-7.79-7.84c-2.67-.5-25.58 0-31.63-.14s-15.16-.56-21.45-2.49c-3.01-.92-5.16-2.35-5.16-2.35l.14-5.07s-5.16 1.03-8.12.75s-7.13-1.97-7.41-2.39c-.28-.42 3.33-3.58 6.34-5.91c3.76-2.9 10.14-8.01 16.19-10.69z" fill="#A8B8C4"></path><path d="M47.52 43.91c0 1.43-1.69 1.36-3.14 1.36c-1.44 0-2.39.09-3.05.56c-.66.47-.18 3.74-6.19 9.2c-3.57 3.24-6.95 5.4-7.51 5.21c-.56-.19-1.64-2.96-1.88-3.99c-2.39.7-7.77-.37-6.95-.56c2.77-.66 6.91-2.56 9.67-4.65c1.92-1.45 5.61-4.35 6.76-5.12c.99-.66 3.85-2.77 5.12-2.91c2.05-.22 7.17-.65 7.17.9z" fill="#ff2b25"></path><path d="M39.64 36.07c0 2.33-2.16 4.32-4.83 4.04c-2.29-.24-4.18-1.89-4.18-4.22s1.82-4.43 4.13-4.5c3.72-.13 4.88 2.35 4.88 4.68z" fill="#2f2f2f"></path><path d="M29.5 53.76c.89-.75-.89-2.82-.89-2.82l-2.16 1.43c0 .01 1.84 2.42 3.05 1.39z" fill="#fffefd"></path><path d="M34.66 49.96c.89-.75-.94-3-.94-3l-2.3 1.78c.01 0 2.03 2.25 3.24 1.22z" fill="#fffefd"></path><path d="M37.01 48.7c-.76.89 1.41 2.91 1.41 2.91s1.8-2.38 1.6-2.53c-.19-.15-1.98-1.59-3.01-.38z" fill="#fffefd"></path><path d="M33.12 52.59c-.76.89.99 3.19 1.29 3.1s1.99-1.88 1.99-1.88s-2.26-2.43-3.28-1.22z" fill="#fffefd"></path><path d="M65.17 25.42c-1.13.75-.38 2.35.28 3.66s1.08 2.51 1.15 4.29c.06 1.6-.35 4.48-.54 5.47c-.17.91-.78 2.9.56 3.24c1.69.42 2.16-.89 2.53-2.16c.49-1.65.74-5.01.66-6.71c-.19-3.64-1.41-5.82-1.97-6.66s-1.57-1.87-2.67-1.13z" fill="#4A5F6D"></path><path d="M73.38 27.67c-.75.6 0 2.39.33 3.19c.33.8.49 1.92.49 3.07c0 .8-.16 2.65-.26 3.68c-.14 1.54-.06 2.46 1.08 2.67c1.78.33 1.85-2.06 2.02-3.05c.13-.79.25-3.39.15-4.61c-.09-1.22-.67-2.99-1.37-4.07c-.57-.85-1.5-1.63-2.44-.88z" fill="#4A5F6D"></path><path d="M57.66 24.72c-1.54.79.14 3.43.56 4.32s1.03 2.86.99 4.93c-.05 2.06-.21 4.18-.56 5.33c-.31 1-1.22 2.7-.52 3.4c1.03 1.03 2.69-.04 3.26-1.71c.84-2.46 1.06-4.48.96-7.67c-.12-4.29-2.39-9.78-4.69-8.6z" fill="#4A5F6D"></path><path d="M28.89 56.3c-.76.89.89 2.96.89 2.96l2.3-1.6s-2.16-2.57-3.19-1.36z" fill="#fffefd"></path><path d="M38.84 46.3c.87-.78-.61-2.44-.61-2.44s-2.11 1.27-2.02 1.41c.21.3 1.69 1.88 2.63 1.03z" fill="#fffefd"></path></svg>`,
        oceanBg: `<svg height="100%" width="100%" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 -70 512 582" xml:space="preserve">
          <rect x="43" y="-170" width="434" height="682" fill="#ffffff" />
          <g transform="translate(10, 0)">
	<circle style="fill:#FFC552;" cx="128.516" cy="93.459" r="43.036"/>
	<path style="fill:#FFC552;" d="M128.511,36.057c-4.546,0-8.232-3.686-8.232-8.232V8.232c0-4.546,3.686-8.232,8.232-8.232c4.546,0,8.232,3.686,8.232,8.232v19.593C136.743,32.371,133.057,36.057,128.511,36.057z"/>
	<path style="fill:#FFC552;" d="M174.923,55.281c-2.106,0-4.214-0.803-5.82-2.411c-3.215-3.215-3.215-8.427,0-11.641l13.854-13.854c3.215-3.215,8.427-3.215,11.641,0c3.215,3.215,3.215,8.427,0,11.641l-13.854,13.854C179.137,54.477,177.031,55.281,174.923,55.281z"/>
	<path style="fill:#FFC552;" d="M213.74,101.694h-19.592c-4.546,0-8.232-3.686-8.232-8.232s3.686-8.232,8.232-8.232h19.592c4.546,0,8.232,3.686,8.232,8.232S218.287,101.694,213.74,101.694z"/>
	<path style="fill:#FFC552;" d="M188.777,161.961c-2.106,0-4.214-0.803-5.82-2.411l-13.854-13.854c-3.215-3.215-3.215-8.427,0-11.641c3.215-3.215,8.427-3.215,11.641,0l13.854,13.854c3.215,3.215,3.215,8.427,0,11.641C192.991,161.157,190.884,161.961,188.777,161.961z"/>
	<path style="fill:#FFC552;" d="M128.511,186.924c-4.546,0-8.232-3.686-8.232-8.232V159.1c0-4.546,3.686-8.232,8.232-8.232c4.546,0,8.232,3.686,8.232,8.232v19.593C136.743,183.239,133.057,186.924,128.511,186.924z"/>
	<path style="fill:#FFC552;" d="M68.244,161.961c-2.107,0-4.214-0.803-5.82-2.411c-3.215-3.215-3.215-8.427,0-11.641l13.854-13.854c3.215-3.215,8.426-3.215,11.642,0c3.215,3.215,3.215,8.427,0,11.641L74.065,159.55C72.458,161.157,70.35,161.961,68.244,161.961z"/>
	<path style="fill:#FFC552;" d="M62.874,101.694H43.281c-4.546,0-8.232-3.686-8.232-8.232s3.686-8.232,8.232-8.232h19.593c4.546,0,8.232,3.686,8.232,8.232S67.42,101.694,62.874,101.694z"/>
	<path style="fill:#FFC552;" d="M82.098,55.281c-2.106,0-4.214-0.803-5.82-2.411L62.424,39.016c-3.215-3.215-3.215-8.427,0-11.641c3.215-3.215,8.427-3.215,11.642,0l13.854,13.854c3.215,3.215,3.215,8.427,0,11.641C86.311,54.477,84.205,55.281,82.098,55.281z"/>
	
</g>
<path style="fill:#FFC552;" d="M43.281,512H476.95V398.961l-28.93-36.03l-114.148,18.582l-96.587-18.582l-76.098,18.582l-54.879-18.582l-63.026,36.03L43.281,512z"/>
<path style="fill:#70B1CC;" d="M476.951,398.961c-27.412-13.165-59.322-13.165-86.734,0l0,0c-27.412,13.165-59.322,13.165-86.734,0l0,0c-27.412-13.165-59.322-13.165-86.734,0l0,0c-27.412,13.165-59.322,13.165-86.734,0l0,0c-27.412-13.165-59.322-13.165-86.734,0V342.98l42.198-37.123l68.39,19.346l50.075-1.276l56.171-18.069l49.611,6.174l38.781,21.075l67.318-32.971l46.83,11.896l14.295,30.95v55.982H476.951z"/>
<path style="fill:#7EC8E6;" d="M476.951,342.98c-27.412-13.165-59.322-13.165-86.734,0l0,0c-27.412,13.165-59.322,13.165-86.734,0l0,0c-27.412-13.165-59.322-13.165-86.734,0l0,0c-27.412,13.165-59.322,13.165-86.734,0l0,0c-27.412-13.165-59.322-13.165-86.734,0V287l42.198-38.217l91.806,18.293l82.831-21.22l94.245,25.052l87.074-25.052l35.516,41.144L476.951,342.98z"/>
<g>
	<path style="fill:#8CDEFF;" d="M444.368,88.209c-5.579,0-10.83,1.405-15.421,3.876c0.509-3.059,0.778-6.199,0.778-9.403c0-31.412-25.464-56.875-56.875-56.875c-24.502,0-45.386,15.495-53.387,37.22c-3.318-1.427-6.973-2.22-10.813-2.22c-15.133,0-27.402,12.269-27.402,27.402c0,0.045,0.003,0.089,0.003,0.134c-0.951-0.083-1.91-0.134-2.882-0.134c-17.995,0-32.583,14.588-32.583,32.583s14.588,32.583,32.583,32.583h165.999c17.995,0,32.583-14.588,32.583-32.583S462.363,88.209,444.368,88.209z"/>
	<path style="fill:#8CDEFF;" d="M390.217,231.02L390.217,231.02c-27.412,13.165-59.321,13.165-86.733,0l0,0c-27.413-13.167-59.322-13.167-86.734,0l0,0c-27.413,13.165-59.322,13.165-86.734,0l0,0c-27.413-13.167-59.322-13.167-86.734,0v55.981c27.412-13.167,59.321-13.167,86.734,0l0,0c27.412,13.165,59.321,13.165,86.734,0l0,0c27.412-13.167,59.321-13.167,86.734,0l0,0c27.412,13.165,59.321,13.165,86.733,0l0,0c27.413-13.167,59.322-13.167,86.734,0V231.02C449.538,217.853,417.629,217.853,390.217,231.02z"/>	
</g>
</svg>`,
      };

      const audio = {
        ctx: new (window.AudioContext || window.webkitAudioContext)(),
        playTone: function (freq, type, duration) {
          if (this.ctx.state === "suspended") {
            this.ctx.resume();
          }
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          osc.type = type;
          osc.frequency.value = freq;
          osc.connect(gain);
          gain.connect(this.ctx.destination);
          osc.start();
          gain.gain.setValueAtTime(0.3, this.ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(
            0.001,
            this.ctx.currentTime + duration
          );
          osc.stop(this.ctx.currentTime + duration);
        },
        playCorrect: function () {
          this.playTone(880, "sine", 0.1);
        },
        playError: function () {
          this.playTone(150, "sawtooth", 0.3);
        },
      };

      const game = {
        state: {
          participantId: "",
          currentRound: 1,
          currentTrial: 0,
          totalTrials: 0,
          score: 0,
          results: [],
          isPlaying: false,
          isPractice: false,
          isRound2Practice: false,
          isRound3Practice: false,
          currentStimulus: null,
          hasPerson: false,
          startTime: 0,
          responded: false,
          timer: null,
        },

        elements: {
          container: document.getElementById("gameContainer"),
          screens: {
            landing: document.getElementById("landingPage"),
            intro: document.getElementById("introScreen"),
            practiceEnd: document.getElementById("practiceEndScreen"),
            round2Intro: document.getElementById("round2IntroScreen"),
            round2PracticeEnd: document.getElementById(
              "round2PracticeEndScreen"
            ),
            round3Practice: document.getElementById("round3PracticeScreen"),
            round3PracticeEnd: document.getElementById(
              "round3PracticeEndScreen"
            ),
            play: document.getElementById("playScreen"),
            result: document.getElementById("resultScreen"),
          },
          backgroundLayer: document.getElementById("backgroundLayer"),
          stimulus: document.getElementById("stimulusBox"),
          personIndicator: document.getElementById("personIndicator"),
          btnSpace: document.getElementById("btnSpace"),
          roundLabel: document.getElementById("roundLabel"),
          trialDisplay: document.getElementById("currentTrialDisplay"),
          totalDisplay: document.getElementById("totalTrialDisplay"),
          scoreDisplay: document.getElementById("scoreDisplay"),
          avgTimeDisplay: document.getElementById("avgTimeDisplay"),
        },

        showTutorial: function () {
          const inputEl = document.getElementById("playerId");
          this.state.participantId = inputEl.value.trim() || "NoName";
          this.showScreen("intro");
        },

        startPractice: function () {
          if (audio.ctx.state === "suspended") audio.ctx.resume();
          this.state.isPractice = true;
          this.state.currentRound = 1;
          this.state.totalTrials = CONFIG.practiceTrials;
          this.elements.roundLabel.innerText = "ç·´ç¿’æ¨¡å¼";
          this.elements.roundLabel.className = "round-label round-practice";
          this.initGameSession();
        },

        startRound1: function () {
          this.state.isPractice = false;
          this.state.currentRound = 1;
          this.state.totalTrials = CONFIG.round1Trials;
          this.state.results = [];
          this.elements.roundLabel.innerText = "ç¬¬ä¸€å›ï¼šæŠ‘åˆ¶æ§åˆ¶è¨“ç·´";
          this.elements.roundLabel.className = "round-label round1-badge";
          this.initGameSession();
        },

        startRound2Practice: function () {
          if (audio.ctx.state === "suspended") audio.ctx.resume();
          this.state.isPractice = true;
          this.state.isRound2Practice = true;
          this.state.currentRound = 2;
          this.state.totalTrials = CONFIG.round2PracticeTrials;
          this.elements.roundLabel.innerText = "ç¬¬äºŒå›ç·´ç¿’ï¼šé›£åº¦å‡ç´š";
          this.elements.roundLabel.className = "round-label round-practice";
          this.initGameSession();
        },

        startRound2: function () {
          this.state.isPractice = false;
          this.state.isRound2Practice = false;
          this.state.currentRound = 2;
          this.state.totalTrials = CONFIG.round2Trials;
          this.elements.roundLabel.innerText = "ç¬¬äºŒå›ï¼šé›£åº¦å‡ç´š";
          this.elements.roundLabel.className = "round-label round2-badge";
          this.initGameSession();
        },

        startRound3Practice: function () {
          if (audio.ctx.state === "suspended") audio.ctx.resume();
          this.state.isPractice = true;
          this.state.isRound3Practice = true;
          this.state.currentRound = 3;
          this.state.totalTrials = CONFIG.round3PracticeTrials;
          this.elements.roundLabel.innerText = "ç¬¬ä¸‰å›åˆç·´ç¿’";
          this.elements.roundLabel.className = "round-label round-practice";
          this.initGameSession();
        },

        startRound3: function () {
          this.state.isPractice = false;
          this.state.isRound3Practice = false;
          this.state.currentRound = 3;
          this.state.totalTrials = CONFIG.round3Trials;
          this.elements.roundLabel.innerText = "ç¬¬ä¸‰å›ï¼šæ•é­šéŠæˆ²";
          this.elements.roundLabel.className = "round-label round3-badge";
          this.initGameSession();
        },

        initGameSession: function () {
          this.state.currentTrial = 0;
          this.state.score = 0;
          this.state.isPlaying = true;
          this.elements.totalDisplay.innerText = this.state.totalTrials;
          this.showScreen("play");

          if (this.state.currentRound === 1 || this.state.currentRound === 2) {
            this.elements.backgroundLayer.innerHTML = SVG_ASSETS.mouseHole;
            this.elements.btnSpace.innerHTML =
              '<span class="key-hint">æŒ‰ç©ºç™½éµ</span><span>è’é›†èµ·å¸</span>';
          } else if (this.state.currentRound === 3) {
            this.elements.backgroundLayer.innerHTML =
              SVG_ASSETS_FISHING.oceanBg;
            this.elements.btnSpace.innerHTML =
              '<span class="key-hint">æŒ‰ç©ºç™½éµ</span><span>é‡£é­š</span>';
          }

          this.nextTrial();
        },

        nextTrial: function () {
          if (this.state.currentTrial >= this.state.totalTrials) {
            this.endSession();
            return;
          }
          this.state.currentTrial++;
          this.updateUI();

          this.elements.stimulus.innerHTML = "";
          this.elements.container.className = "game-area";
          this.elements.stimulus.classList.remove(
            "pop",
            "correct-flash",
            "error-flash"
          );

          // é‡ç½®äººç‰©ç‹€æ…‹
          this.state.hasPerson = false;
          this.elements.personIndicator.style.display = "none";
          this.elements.personIndicator.innerHTML = "";
          this.state.responded = false;

          if (this.state.currentRound === 1 || this.state.currentRound === 2) {
            this.elements.backgroundLayer.innerHTML = SVG_ASSETS.mouseHole;
          } else {
            this.elements.backgroundLayer.innerHTML =
              SVG_ASSETS_FISHING.oceanBg;
          }

          const delay =
            Math.floor(Math.random() * (CONFIG.isiMax - CONFIG.isiMin + 1)) +
            CONFIG.isiMin;
          setTimeout(() => this.showStimulus(), delay);
        },

        showStimulus: function () {
          let isGo, goStimulus, noGoStimulus;

          if (this.state.currentRound === 1) {
            // ç¬¬ä¸€å›åˆï¼šç´” Go/No-Go (ç„¡äºº)
            this.state.hasPerson = false;
            isGo = Math.random() < CONFIG.goRatio;
            this.state.currentStimulus = isGo ? "cheese" : "cat";
            goStimulus = SVG_ASSETS.cheese;
            noGoStimulus = SVG_ASSETS.cat;
          } else if (this.state.currentRound === 2) {
            // ç¬¬äºŒå›åˆï¼šDCCS (æœ‰äºº)
            this.state.hasPerson = Math.random() < CONFIG.personRatio;
            isGo = Math.random() < CONFIG.goRatio;
            this.state.currentStimulus = isGo ? "cheese" : "cat";
            goStimulus = SVG_ASSETS.cheese;
            noGoStimulus = SVG_ASSETS.cat;

            // é¡¯ç¤ºäººç‰©
            if (this.state.hasPerson) {
              this.elements.personIndicator.innerHTML = SVG_ASSETS.person;
              this.elements.personIndicator.style.display = "block";
            }
          } else if (this.state.currentRound === 3) {
            // ç¬¬ä¸‰å›åˆï¼šé­š vs. é¯Šé­š
            this.state.hasPerson = false;
            isGo = Math.random() < CONFIG.goRatio;
            this.state.currentStimulus = isGo ? "fish" : "shark";
            goStimulus = SVG_ASSETS_FISHING.fish;
            noGoStimulus = SVG_ASSETS_FISHING.shark;
          }

          if (CONFIG.debugMode) {
            const round = this.state.currentRound;
            const emoji =
              round === 1 ? (isGo ? "ğŸ§€" : "ğŸ±") : isGo ? "ğŸŸ" : "ğŸ¦ˆ";
            const personMsg = this.state.hasPerson ? " + ğŸ‘¤äººå‡ºç¾" : "";
            console.log(
              `[ç¬¬${round}å› è©¦é©—${this.state.currentTrial}] åˆºæ¿€: ${this.state.currentStimulus} ${emoji}${personMsg}`
            );
          }

          this.elements.stimulus.innerHTML = isGo ? goStimulus : noGoStimulus;
          this.elements.stimulus.classList.add("pop");
          this.state.startTime = Date.now();

          this.state.timer = setTimeout(() => {
            if (!this.state.responded) {
              this.handleTimeout();
            }
          }, CONFIG.stimulusDuration);
        },

        checkAnswer: function (stimulus, inputKey) {
          if (this.state.currentRound === 1 || this.state.currentRound === 2) {
            // å¦‚æœæ˜¯ç¬¬äºŒå›åˆä¸”æœ‰äººå‡ºç¾ï¼Œå¿…é ˆä¸æŒ‰
            if (this.state.hasPerson) {
              return inputKey === null;
            }
            // æ­£å¸¸è¦å‰‡ (ç¬¬ä¸€å›åˆ & ç¬¬äºŒå›åˆç„¡äººæ™‚)
            if (stimulus === "cheese" && inputKey === "Space") return true;
            if (stimulus === "cat" && inputKey === null) return true;
            return false;
          } else if (this.state.currentRound === 3) {
            // ç¬¬ä¸‰å›åˆè¦å‰‡
            if (stimulus === "fish" && inputKey === "Space") return true;
            if (stimulus === "shark" && inputKey === null) return true;
            return false;
          }
        },

        handleInput: function (keyInput) {
          if (
            !this.state.isPlaying ||
            this.state.responded ||
            !this.elements.stimulus.innerHTML
          )
            return;
          this.state.responded = true;
          clearTimeout(this.state.timer);

          const btn = this.elements.btnSpace;
          btn.classList.add("active-key");
          setTimeout(() => btn.classList.remove("active-key"), 100);

          const reactionTime = Date.now() - this.state.startTime;
          const stimulus = this.state.currentStimulus;
          const isCorrect = this.checkAnswer(stimulus, keyInput);

          if (CONFIG.debugMode) {
            console.log(
              `  â†’ æŒ‰äº†ç©ºç™½éµ | åˆ¤æ–·: ${
                isCorrect ? "âœ“ æ­£ç¢º" : "âœ— éŒ¯èª¤"
              } | RT: ${reactionTime}ms`
            );
          }

          this.triggerFeedback(isCorrect);
          this.recordResult(isCorrect, reactionTime, keyInput);
          setTimeout(() => this.nextTrial(), 800);
        },

        handleTimeout: function () {
          this.state.responded = true;
          const stimulus = this.state.currentStimulus;
          const isCorrect = this.checkAnswer(stimulus, null);

          if (CONFIG.debugMode) {
            console.log(
              `  â†’ é€¾æ™‚æ²’æŒ‰ | åˆ¤æ–·: ${isCorrect ? "âœ“ æ­£ç¢º" : "âœ— éŒ¯èª¤"}`
            );
          }

          this.triggerFeedback(isCorrect);
          this.recordResult(isCorrect, 0, "none");
          setTimeout(() => this.nextTrial(), 800);
        },

        triggerFeedback: function (isSuccess) {
          this.elements.container.classList.remove(
            "feedback-success",
            "feedback-error"
          );
          this.elements.stimulus.classList.remove(
            "correct-flash",
            "error-flash"
          );
          void this.elements.container.offsetWidth;

          if (isSuccess) {
            this.elements.container.classList.add("feedback-success");
            this.elements.stimulus.classList.add("correct-flash");
            audio.playCorrect();
          } else {
            this.elements.container.classList.add("feedback-error");
            this.elements.stimulus.classList.add("error-flash");
            audio.playError();
          }
        },

        recordResult: function (isCorrect, rt, inputKey) {
          if (isCorrect) {
            this.state.score++;
            const scoreEl = document.getElementById("scoreDisplay");
            if (scoreEl) {
              scoreEl.style.transform = "scale(1.3)";
              scoreEl.style.color = "#2ecc71";
              setTimeout(() => {
                scoreEl.style.transform = "scale(1)";
              }, 300);
            }
          }
          if (!this.state.isPractice) {
            this.state.results.push({
              participantId: this.state.participantId,
              round: this.state.currentRound,
              trial: this.state.currentTrial,
              stimulus: this.state.currentStimulus,
              hasPerson: this.state.hasPerson,
              input: inputKey,
              correct: isCorrect ? "yes" : "no",
              rt: rt,
              timestamp: new Date().toISOString(),
            });
          }
        },

        endSession: function () {
          this.state.isPlaying = false;
          if (this.state.isPractice) {
            if (this.state.currentRound === 1) {
              this.showScreen("practiceEnd");
            } else if (this.state.currentRound === 2) {
              this.showScreen("round2PracticeEnd");
            } else if (this.state.currentRound === 3) {
              this.showScreen("round3PracticeEnd");
            }
          } else {
            if (this.state.currentRound === 1) {
              this.showScreen("round2Intro");
            } else if (this.state.currentRound === 2) {
              this.showScreen("round3Practice");
            } else if (this.state.currentRound === 3) {
              this.showFinalResult();
            }
          }
        },

        showFinalResult: function () {
          this.showScreen("result");
          const totalCorrect = this.state.results.filter(
            (r) => r.correct === "yes"
          ).length;
          const validTrials = this.state.results.filter(
            (r) => r.input === "Space" && r.correct === "yes"
          );
          const avgRT =
            validTrials.length > 0
              ? Math.round(
                  validTrials.reduce((sum, r) => sum + r.rt, 0) /
                    validTrials.length
                )
              : 0;
          this.elements.scoreDisplay.innerText = totalCorrect;
          this.elements.avgTimeDisplay.innerText = avgRT + "ms";
        },

        updateUI: function () {
          this.elements.trialDisplay.innerText = this.state.currentTrial;
          const progressBar = document.getElementById("progressBar");
          if (progressBar) {
            const progress =
              ((this.state.currentTrial - 1) / this.state.totalTrials) * 100;
            progressBar.style.width = progress + "%";
            if (progress < 30) progressBar.style.background = "#3498db";
            else if (progress < 70) progressBar.style.background = "#f39c12";
            else progressBar.style.background = "#2ecc71";
          }
        },

        showScreen: function (name) {
          Object.values(this.elements.screens).forEach((el) =>
            el.classList.add("hidden")
          );
          this.elements.screens[name].classList.remove("hidden");
        },

        exportData: function () {
          const now = new Date();
          const dateStr = now.toISOString().slice(0, 10).replace(/-/g, "");
          const timeStr = now.toTimeString().slice(0, 8).replace(/:/g, "");
          const id = this.state.participantId;
          const fileName = `EFè¨“ç·´éŠæˆ²æ•¸æ“š_${id}_${dateStr}_${timeStr}.csv`;

          let csvContent =
            "Participant,Round,Trial,Stimulus,HasPerson,InputKey,Correct,RT(ms),Timestamp\n";
          this.state.results.forEach((r) => {
            csvContent += `${r.participantId},${r.round},${r.trial},${r.stimulus},${r.hasPerson},${r.input},${r.correct},${r.rt},${r.timestamp}\n`;
          });

          const blob = new Blob(["\uFEFF" + csvContent], {
            type: "text/csv;charset=utf-8;",
          });
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.setAttribute("href", url);
          link.setAttribute("download", fileName);
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        },
      };

      document.addEventListener("keydown", function (event) {
        if (event.code === "Space" || event.key === " ") {
          const screens = game.elements.screens;
          if (!screens.intro.classList.contains("hidden")) {
            event.preventDefault();
            game.startPractice();
            return;
          }
          if (!screens.practiceEnd.classList.contains("hidden")) {
            event.preventDefault();
            game.startRound1();
            return;
          }
          if (!screens.round2Intro.classList.contains("hidden")) {
            event.preventDefault();
            game.startRound2Practice();
            return;
          }
          if (!screens.round2PracticeEnd.classList.contains("hidden")) {
            event.preventDefault();
            game.startRound2();
            return;
          }
          if (!screens.round3Practice.classList.contains("hidden")) {
            event.preventDefault();
            game.startRound3Practice();
            return;
          }
          if (!screens.round3PracticeEnd.classList.contains("hidden")) {
            event.preventDefault();
            game.startRound3();
            return;
          }
          if (game.state.isPlaying) {
            event.preventDefault();
            game.handleInput("Space");
            return;
          }
        }
      });

      document
        .getElementById("playerId")
        .addEventListener("keydown", function (event) {
          if (event.isComposing) return;
          if (event.key === "Enter") game.showTutorial();
        });
    </script>
  </body>
</html>
