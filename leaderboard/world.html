<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://www.googleapis.com" crossorigin />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.gstatic.com; style-src 'self' 'unsafe-inline'; img-src 'self' data:; media-src 'self'; connect-src 'self' https://*.firebaseio.com https://*.googleapis.com wss://*.firebaseio.com https://*.firebasedatabase.app wss://*.firebasedatabase.app"
    />
    <title>世界排行榜 - 執行功能訓練遊戲</title>
    <link rel="icon" href="../favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="../favicon.svg" />
    <link rel="manifest" href="../manifest.json" />
    <meta name="theme-color" content="#302b63" />
    <link rel="stylesheet" href="../css/themes/base.css" />
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="../css/components/ranking.css" />
    <link rel="stylesheet" href="../css/components/landscape-hint.css" />
    <link rel="stylesheet" href="../css/pages/world-leaderboard.css" />
    <link rel="stylesheet" href="../css/components/navbar.css" />
    <!-- === 依賴 === -->
    <script
      defer
      src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"
    ></script>
    <script
      defer
      src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"
    ></script>
    <script
      defer
      src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"
    ></script>
    <script
      defer
      src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"
    ></script>
    <script defer src="../js/firebase-config.js"></script>
    <script defer src="../js/utils/constants.js"></script>
    <script defer src="../js/shared/ranking-renderer.js"></script>
    <script defer src="../js/shared/firestore-leaderboard.js"></script>
    <script defer src="../js/shared/navbar.js"></script>
    <script defer src="../js/shared/landscape-hint.js"></script>
  </head>
  <body>
    <main class="world-page" id="main-content">
      <div class="world-header">
        <h1>🌐 世界排行榜</h1>
        <p class="subtitle">
          與全世界的玩家比較成績！<br />不需要登入帳號，完成遊戲後即可上傳
        </p>
      </div>

      <!-- Upload Section -->
      <div class="upload-section" id="uploadSection">
        <div class="upload-card">
          <h3>📤 上傳我的成績</h3>
          <p>你的最新遊戲成績：</p>
          <div class="local-score">
            <div class="local-score__nickname" id="localNickname"></div>
            <div class="local-score__label">最高分</div>
            <div class="local-score__value" id="localScoreValue">---</div>
            <div class="local-score__detail" id="localScoreDetail"></div>
          </div>
          <div id="noDataNotice" class="no-data-notice" style="display: none">
            ⚠️ 本地沒有遊戲紀錄，請先玩一場遊戲再來上傳！
          </div>
          <button class="btn btn-primary" id="btnUpload" disabled>
            🚀 上傳到世界排行榜
          </button>
          <div
            class="upload-status"
            id="uploadStatus"
            role="status"
            aria-live="polite"
          ></div>
        </div>
      </div>

      <!-- Stats -->
      <div id="worldStatsContainer" style="display: none"></div>

      <!-- Ranking -->
      <div id="worldRankingContainer">
        <div class="ranking-empty">
          <span class="ranking-empty__icon">🌐</span>
          <p>載入世界排行榜中…</p>
        </div>
      </div>

      <!-- Explain -->
      <div class="explain-card">
        <strong>ℹ️ 世界排行榜說明</strong>
        <ul>
          <li><strong>不需要登入帳號</strong>，完成遊戲後即可上傳</li>
          <li>
            以「暱稱 + 裝置」辨識身份，<strong>同一裝置上傳會覆蓋前一筆</strong>
          </li>
          <li>上傳後<strong>無法自行刪除</strong>，只能被新上傳覆蓋</li>
          <li>
            訪客模式（00NoName）使用
            sessionStorage，<strong>關閉分頁後資料即清除</strong>，但仍可上傳至世界排行榜
          </li>
          <li>未輸入暱稱/座號 = 訪客，資料不儲存也不上傳</li>
        </ul>
      </div>

      <div class="world-footer">
        <button
          class="btn btn-secondary"
          onclick="location.href = 'index.html'"
        >
          ← 返回排行榜
        </button>
        <button
          class="btn btn-secondary"
          onclick="location.href = '../index.html'"
        >
          🏠 回首頁
        </button>
      </div>
    </main>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>

    <script defer src="../js/shared/world-leaderboard-controller.js"></script>
  </body>
</html>
