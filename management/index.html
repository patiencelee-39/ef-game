<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <link rel="preconnect" href="https://www.googleapis.com" crossorigin />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; media-src 'self'; connect-src 'self' https://*.firebaseio.com https://*.googleapis.com wss://*.firebaseio.com https://*.firebasedatabase.app wss://*.firebasedatabase.app"
    />
    <title>教師管理後台 - 執行功能訓練遊戲</title>
    <link rel="icon" href="../favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="../favicon.svg" />
    <link rel="manifest" href="../manifest.json" />
    <meta name="theme-color" content="#302b63" />
    <link rel="stylesheet" href="../css/themes/base.css" />
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="preload" href="../css/components/navbar.css" as="style" onload="this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="../css/components/navbar.css" /></noscript>
    <link rel="preload" href="../css/components/landscape-hint.css" as="style" onload="this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="../css/components/landscape-hint.css" /></noscript>
    <link rel="stylesheet" href="../css/pages/management.css" />
    <!-- === Scripts === -->
    <script defer src="../js/firebase-bundle.js"></script>
    <script defer src="../js/shared/firestore-leaderboard.js"></script>
    <script defer src="../js/shared/navbar.js"></script>
    <script defer src="../js/shared/landscape-hint.js"></script>
    <script defer src="../js/shared/management-controller.js"></script>
  </head>
  <body>
    <main class="admin-page" id="main-content">
      <h1>🏫 教師管理後台</h1>
      <p class="admin-subtitle">
        班級管理 · 學生進度 · 資料匯出
        <span id="authStatus" style="font-size: 0.75rem">⏳ 連線中…</span>
      </p>

      <!-- === 快捷導航 === -->
      <div class="quick-nav">
        <a class="quick-nav__btn" href="../leaderboard/class.html">
          🏆 班級排行榜
        </a>
        <a class="quick-nav__btn" href="../multiplayer/room-create.html">
          🎮 建立房間
        </a>
        <a class="quick-nav__btn" href="../settings/index.html"> ⚙️ 設定 </a>
      </div>

      <!-- === 統計摘要 === -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-card__icon">👩‍🎓</div>
          <div class="stat-card__value" id="statStudents">0</div>
          <div class="stat-card__label">學生人數</div>
        </div>
        <div class="stat-card">
          <div class="stat-card__icon">🏅</div>
          <div class="stat-card__value" id="statClasses">0</div>
          <div class="stat-card__label">班級數</div>
        </div>
        <div class="stat-card">
          <div class="stat-card__icon">🎮</div>
          <div class="stat-card__value" id="statGames">0</div>
          <div class="stat-card__label">總遊戲場次</div>
        </div>
        <div class="stat-card">
          <div class="stat-card__icon">💯</div>
          <div class="stat-card__value" id="statAvgAcc">-</div>
          <div class="stat-card__label">平均準確率</div>
        </div>
      </div>

      <!-- === 班級管理 === -->
      <div class="admin-section">
        <h2>📚 班級管理</h2>
        <div class="class-form">
          <input
            type="text"
            id="newClassName"
            class="class-form__input"
            placeholder="輸入班級名稱（如：向日葵班）"
            maxlength="20"
            aria-label="新班級名稱"
          />
          <button class="class-form__btn" id="btnAddClass">➕ 新增</button>
        </div>
        <div class="class-list" id="classList">
          <!-- 動態產生 -->
        </div>
      </div>

      <!-- === 學生學習進度 === -->
      <div class="admin-section">
        <h2>🧑‍🎓 學生學習進度</h2>
        <div class="filter-row" id="filterRow">
          <!-- 動態產生篩選按鈕 -->
        </div>
        <div id="studentArea">
          <div class="empty-state">
            <div class="empty-state__icon">📭</div>
            <p class="empty-state__text">
              尚無學生資料<br />學生完成遊戲後，資料將自動出現於此
            </p>
          </div>
        </div>
      </div>

      <!-- === 資料管理 === -->
      <div class="admin-section">
        <h2>💾 資料管理</h2>
        <button class="admin-btn admin-btn--export" id="btnExport">
          📥 匯出所有資料 (JSON)
        </button>
        <button class="admin-btn admin-btn--import" id="btnImport">
          📤 匯入資料 (JSON)
        </button>
        <button
          class="admin-btn admin-btn--danger"
          id="btnClearAll"
          style="
            background: rgba(100, 100, 200, 0.2);
            border: 1px solid rgba(150, 150, 220, 0.3);
          "
        >
          🔄 重新整理
        </button>
        <input type="file" id="importFileInput" accept=".json" />
      </div>
    </div>

    <!-- Toast -->
    <div class="admin-toast" id="toast" role="status" aria-live="polite"></div>

    <!-- 確認彈窗 -->
    <div class="confirm-overlay" id="confirmOverlay" role="dialog" aria-modal="true" aria-label="確認操作">
      <div class="confirm-dialog">
        <div class="confirm-dialog__icon" id="confirmIcon">⚠️</div>
        <div class="confirm-dialog__title" id="confirmTitle">確認操作</div>
        <div class="confirm-dialog__msg" id="confirmMsg">確定嗎？</div>
        <div class="confirm-dialog__actions">
          <button
            class="confirm-dialog__btn confirm-dialog__btn--cancel"
            id="confirmCancel"
          >
            取消
          </button>
          <button
            class="confirm-dialog__btn confirm-dialog__btn--danger"
            id="confirmOk"
          >
            確定
          </button>
        </div>
      </div>
    </main>
  </body>
</html>
