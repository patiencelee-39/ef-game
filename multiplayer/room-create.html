<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://www.googleapis.com" crossorigin />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.gstatic.com; style-src 'self' 'unsafe-inline'; img-src 'self' data:; media-src 'self'; connect-src 'self' https://*.firebaseio.com https://*.googleapis.com wss://*.firebaseio.com https://*.firebasedatabase.app wss://*.firebasedatabase.app"
    />
    <title>建立房間 - 執行功能訓練遊戲</title>
    <link rel="icon" href="../favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="../favicon.svg" />
    <link rel="manifest" href="../manifest.json" />
    <meta name="theme-color" content="#302b63" />
    <link rel="stylesheet" href="../css/themes/base.css" />
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="preload" href="../css/components/landscape-hint.css" as="style" onload="this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="../css/components/landscape-hint.css" /></noscript>
    <link rel="stylesheet" href="../css/pages/room-create.css" />
    <link rel="preload" href="../css/components/navbar.css" as="style" onload="this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="../css/components/navbar.css" /></noscript>
    <!-- Firebase SDK -->
    <script
      defer
      src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"
    ></script>
    <script
      defer
      src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"
    ></script>
    <script
      defer
      src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"
    ></script>
    <!-- 工具函式（注意順序：constants 必須最先載入）-->
    <script defer src="../js/utils/constants.js"></script>
    <script defer src="../js/firebase-config.js"></script>
    <script defer src="../js/utils/question-generator.js"></script>
    <script defer src="../js/utils/room-code.js"></script>
    <!-- 頁面邏輯 -->
    <script defer src="../js/multiplayer/room-manager.js"></script>
    <script defer src="../js/shared/navbar.js"></script>
    <script defer src="../js/shared/landscape-hint.js"></script>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>🏠 建立遊戲房間</h1>
        <p class="subtitle">設定房間並邀請朋友一起遊玩</p>
      </header>

      <main id="main-content">
        <form id="createRoomForm">
          <!-- 基本設定 -->
          <section class="form-section">
            <h2>📋 基本設定</h2>

            <div class="form-group">
              <label for="roomName">房間名稱</label>
              <input
                type="text"
                id="roomName"
                value="我的練習房"
                required
                aria-required="true"
              />
            </div>

            <div class="form-group">
              <label for="roomCode">房間代碼（自動生成）</label>
              <input type="text" id="roomCode" readonly />
              <button
                type="button"
                id="regenerateCode"
                class="btn-secondary mt-sm"
              >
                🔄 重新生成
              </button>
            </div>

            <div class="form-group checkbox-group">
              <input type="checkbox" id="hasPassword" />
              <label for="hasPassword">設定房間密碼</label>
            </div>

            <div class="form-group" id="passwordGroup" style="display: none">
              <label for="password">密碼（4位數字）</label>
              <input
                type="password"
                id="password"
                pattern="[0-9]{4}"
                maxlength="4"
                placeholder="1234"
                inputmode="numeric"
                aria-describedby="passwordHint"
              />
              <span id="passwordHint" class="sr-only">請輸入4位數字密碼</span>
            </div>

            <div class="checkbox-group">
              <input type="checkbox" id="hostJoinsGame" checked />
              <label for="hostJoinsGame">房主參與遊戲</label>
              <small
                style="
                  display: block;
                  margin-left: 1.5rem;
                  color: rgba(255, 255, 255, 0.7);
                "
              >
                取消勾選後，房主將只能觀戰和管理遊戲
              </small>
            </div>
          </section>

          <!-- 遊戲場選擇 -->
          <section class="form-section stage-selector">
            <h2>🎮 遊戲場選擇（拖曳排序）</h2>

            <div
              class="selected-stages"
              id="selectedStages"
              role="status"
              aria-live="polite"
            >
              <div class="selected-stages-empty">
                👆 請從下方選擇遊戲場（最多4個）
              </div>
            </div>

            <h3>可選擇的遊戲場：</h3>
            <div class="available-stages" id="availableStages">
              <div class="stage-card" data-stage="A">
                <span class="emoji">🧀</span>
                <div>場地A</div>
                <div>起司森林</div>
                <small>簡單</small>
              </div>
              <div class="stage-card" data-stage="B">
                <span class="emoji">🧑</span>
                <div>場地B</div>
                <div>人類村莊</div>
                <small>中等</small>
              </div>
              <div class="stage-card" data-stage="C">
                <span class="emoji">🐟</span>
                <div>場地C</div>
                <div>海洋世界</div>
                <small>中等</small>
              </div>
              <div class="stage-card" data-stage="D">
                <span class="emoji">🌙</span>
                <div>場地D</div>
                <div>晝夜迷宮</div>
                <small>困難</small>
              </div>
            </div>
          </section>

          <!-- 遊戲設定 -->
          <section class="form-section">
            <h2>⚙️ 遊戲設定</h2>

            <div class="form-group">
              <label for="questionsCount">每場地題數</label>
              <select id="questionsCount">
                <option value="5">5題</option>
                <option value="10" selected>10題</option>
                <option value="15">15題</option>
                <option value="20">20題</option>
              </select>
            </div>

            <div class="form-group">
              <label for="countdownSeconds">倒數秒數</label>
              <select id="countdownSeconds">
                <option value="2">2秒</option>
                <option value="3" selected>3秒</option>
                <option value="4">4秒</option>
                <option value="5">5秒</option>
              </select>
            </div>
          </section>

          <!-- 進階設定 -->
          <section class="form-section">
            <h2>🔧 進階設定</h2>

            <div class="checkbox-group">
              <input type="checkbox" id="showLeaderboard" checked />
              <label for="showLeaderboard">顯示即時計分板</label>
            </div>

            <div class="checkbox-group">
              <input type="checkbox" id="showAnswerStatus" checked />
              <label for="showAnswerStatus">顯示答題狀態</label>
            </div>

            <div class="checkbox-group">
              <input type="checkbox" id="showCompletionNotification" checked />
              <label for="showCompletionNotification">顯示場地完成通知</label>
            </div>

            <div class="checkbox-group">
              <input type="checkbox" id="allowLateJoin" />
              <label for="allowLateJoin">允許中途加入</label>
            </div>

            <div class="checkbox-group">
              <input type="checkbox" id="showFinalRanking" checked />
              <label for="showFinalRanking">顯示最終排名</label>
            </div>
          </section>

          <!-- 按鈕 -->
          <div
            class="button-group"
            style="display: flex; gap: 1rem; margin-top: 2rem"
          >
            <button
              type="button"
              onclick="location.href = '../index.html'"
              class="btn-secondary"
            >
              返回
            </button>
            <button type="submit" class="btn-primary" style="flex: 1">
              建立房間
            </button>
          </div>
        </form>
      </main>
    </div>

    <script defer src="../js/multiplayer/room-create-controller.js"></script>
  </body>
</html>
