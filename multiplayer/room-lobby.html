<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <link rel="preconnect" href="https://www.googleapis.com" crossorigin />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline' https://*.firebasedatabase.app https://*.firebaseio.com; style-src 'self' 'unsafe-inline'; img-src 'self' data:; media-src 'self'; connect-src 'self' https://*.firebaseio.com https://*.googleapis.com wss://*.firebaseio.com https://*.firebasedatabase.app wss://*.firebasedatabase.app"
    />
    <title>等待室 - 執行功能遊戲</title>
    <link rel="icon" href="../favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="../favicon.svg" />
    <link rel="manifest" href="../manifest.json" />
    <meta name="theme-color" content="#302b63" />
    <link rel="stylesheet" href="../css/themes/base.css" />
    <link rel="stylesheet" href="../css/themes/theme-field-primary.css" />
    <link rel="stylesheet" href="../css/themes/theme-rule-independent.css" />
    <link rel="stylesheet" href="../css/main.css" />
    <link
      rel="preload"
      href="../css/components/landscape-hint.css"
      as="style"
      onload="this.rel = 'stylesheet'"
    />
    <noscript
      ><link rel="stylesheet" href="../css/components/landscape-hint.css"
    /></noscript>
    <link rel="stylesheet" href="../css/pages/room-lobby.css" />
    <link rel="stylesheet" href="../css/components/relay.css" />
    <link
      rel="preload"
      href="../css/components/navbar.css"
      as="style"
      onload="this.rel = 'stylesheet'"
    />
    <noscript
      ><link rel="stylesheet" href="../css/components/navbar.css"
    /></noscript>
    <!-- Firebase Bundle -->
    <script defer src="../js/firebase-bundle.js"></script>
    <script defer src="../js/utils/logger.js"></script>
    <script defer src="../js/utils/constants.js"></script>
    <script defer src="../js/utils/question-generator.js"></script>
    <script defer src="../js/shared/game-modal.js"></script>
    <script defer src="../js/shared/navbar.js"></script>
    <script defer src="../js/shared/landscape-hint.js"></script>
  </head>
  <body>
    <a href="#main-content" class="skip-link">跳到主要內容</a>
    <main class="container" id="main-content">
      <div class="header">
        <h1>🎮 遊戲等待室</h1>
      </div>

      <!-- 房間代碼 -->
      <div class="room-code-display">
        <div class="label">房間代碼</div>
        <div class="code" id="roomCode">------</div>
        <button class="copy-btn" onclick="copyRoomCode()">📋 複製代碼</button>
      </div>

      <!-- 玩家列表 -->
      <div class="section">
        <div class="section-title">
          👥 玩家 (<span id="playerCount">0</span>/<span id="maxPlayers">8</span
          >)
        </div>
        <div class="players-grid" id="playersGrid">
          <!-- 玩家卡片將動態生成 -->
        </div>
      </div>

      <!-- 遊戲場地 -->
      <div class="section">
        <div class="section-title">🎯 遊戲場地</div>
        <div class="stages-info" id="stagesInfo">
          <!-- 場地資訊將動態生成 -->
        </div>
      </div>

      <!-- 接力賽隊伍面板（僅接力模式顯示）-->
      <div class="relay-team-panel" id="relayTeamPanel" style="display: none">
        <div class="section-title">🏁 接力隊伍分配</div>
        <div class="relay-team-actions">
          <button class="btn btn-sm" id="autoAssignBtn">🔀 自動分隊</button>
          <button class="btn btn-sm" id="shuffleBatonBtn">🎲 隨機棒次</button>
        </div>
        <div class="relay-teams-grid" id="relayTeamsGrid">
          <!-- 隊伍卡片由 JS 動態生成 -->
        </div>
      </div>

      <!-- 隊伍對抗面板（僅 team 模式顯示）-->
      <div class="team-battle-panel" id="teamBattlePanel" style="display: none">
        <div class="section-title">⚔️ 隊伍分配</div>
        <div id="myTeamBadge" style="display: none; margin-bottom: 12px"></div>
        <div class="team-battle-actions">
          <button class="btn btn-sm" id="teamBattleAutoBtn">🔀 自動分隊</button>
        </div>
        <div class="team-battle-grid" id="teamBattleGrid">
          <!-- 隊伍卡片由 JS 動態生成 -->
        </div>
      </div>

      <!-- (第二個重複的 teamBattlePanel 已移除) -->

      <!-- 等待訊息 -->
      <div class="waiting-message" id="waitingMessage">
        等待房主開始遊戲<span class="loading-dots"
          ><span>.</span><span>.</span><span>.</span></span
        >
      </div>

      <!-- 操作按鈕 -->
      <div class="action-buttons">
        <button class="btn btn-secondary" onclick="leaveRoom()">
          離開房間
        </button>
        <button
          class="btn ready-toggle"
          id="readyBtn"
          onclick="toggleReady()"
          style="display: none"
        >
          準備好了！
        </button>
        <button
          class="btn btn-primary"
          id="startBtn"
          onclick="startGame()"
          style="display: none"
          disabled
        >
          開始遊戲
        </button>
      </div>
    </main>

    <!-- Toast 通知 -->
    <div class="toast" id="toast"></div>

    <script defer src="../js/multiplayer/relay-manager.js"></script>
    <script defer src="../js/multiplayer/room-lobby-controller.js"></script>
  </body>
</html>
