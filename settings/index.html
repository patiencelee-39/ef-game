<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; media-src 'self'; connect-src 'self' https://lin.ee"
    />
    <title>設定 - 執行功能訓練遊戲</title>
    <link rel="icon" href="../favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="../favicon.svg" />
    <link rel="manifest" href="../manifest.json" />
    <meta name="theme-color" content="#302b63" />
    <link rel="stylesheet" href="../css/themes/base.css" />
    <link rel="stylesheet" href="../css/themes/theme-field-primary.css" />
    <link rel="stylesheet" href="../css/themes/theme-rule-independent.css" />
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="preload" href="../css/components/navbar.css" as="style" onload="this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="../css/components/navbar.css" /></noscript>
    <link rel="preload" href="../css/components/landscape-hint.css" as="style" onload="this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="../css/components/landscape-hint.css" /></noscript>
    <link rel="stylesheet" href="../css/pages/settings.css" />
    <!-- === Scripts === -->
    <script defer src="../js/utils/logger.js"></script>
    <script defer src="../js/utils/storage.js"></script>
    <script defer src="../js/shared/audio-player.js"></script>
    <script defer src="../js/shared/navbar.js"></script>
    <script defer src="../js/shared/landscape-hint.js"></script>
    <script defer src="../js/singleplayer/settings-controller.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        var btn = document.getElementById('btnDevTools');
        if (!btn) return;
        btn.addEventListener('click', function () {
          var pw = prompt('請輸入密碼：');
          if (pw === null) return;
          if (pw === '00000') {
            window.location.href = '../tools/admin.html';
          } else {
            alert('密碼錯誤');
          }
        });
      });
    </script>
  </head>
  <body>
    <main class="settings-page" id="main-content">
      <h1>⚙️ 設定</h1>

      <!-- ==================== -->
      <!-- � 音效設定           -->
      <!-- ==================== -->
      <div class="settings-section">
        <h2>🔊 音效設定</h2>
        <!-- 主音量 -->
        <div class="volume-row">
          <span class="volume-row__label">🔊 音量</span>
          <input
            type="range"
            id="volumeSlider"
            class="volume-row__slider"
            min="0"
            max="100"
            value="80"
            aria-label="主音量"
          />
          <span class="volume-row__percent" id="volumePercent">80%</span>
        </div>
        <!-- 音效開關 -->
        <div class="settings-item">
          <span class="settings-item__label">🎵 音效</span>
          <label class="toggle-switch">
            <input type="checkbox" id="sfxToggle" checked aria-label="音效開關" />
            <span class="toggle-switch__track"></span>
          </label>
        </div>
        <!-- 語音開關 -->
        <div class="settings-item">
          <span class="settings-item__label">🗣️ 語音</span>
          <label class="toggle-switch">
            <input type="checkbox" id="voiceToggle" checked aria-label="語音開關" />
            <span class="toggle-switch__track"></span>
          </label>
        </div>
        <!-- 語速 -->
        <div class="settings-item">
          <span class="settings-item__label">🗣️ 語速</span>
          <div class="rate-selector" id="rateSelector">
            <button class="rate-btn" data-rate="0.7">🐢 慢</button>
            <button class="rate-btn active" data-rate="1.0">🐇 正常</button>
            <button class="rate-btn" data-rate="1.2">🐆 快</button>
          </div>
        </div>
      </div>

      <!-- ==================== -->
      <!-- 🎯 遊戲設定           -->
      <!-- ==================== -->
      <div class="settings-section">
        <h2>🎯 遊戲設定</h2>
        <!-- 題數設定 -->
        <div class="settings-item">
          <span class="settings-item__label">📝 每回合題數</span>
          <div class="count-selector" id="countSelector">
            <button class="count-btn" data-count="4">4</button>
            <button class="count-btn active" data-count="6">6</button>
            <button class="count-btn" data-count="8">8</button>
            <button class="count-btn" data-count="10">10</button>
          </div>
        </div>
        <!-- 難度調整模式 -->
        <div class="settings-item">
          <span class="settings-item__label">🧠 難度調整模式</span>
          <div class="engine-selector" id="engineSelector">
            <button class="engine-btn" data-engine="static" title="固定難度，不隨表現調整">📊 固定</button>
            <button class="engine-btn active" data-engine="simple" title="連對升級、連錯降級（預設）">🎯 簡易</button>
            <button class="engine-btn" data-engine="irt" title="IRT 智慧分析，依能力精準選題">🧠 IRT</button>
          </div>
          <p class="settings-item__hint" id="engineHint">
            📊 固定：難度不變，適合標準化測驗<br>
            🎯 簡易：連續答對自動升級、連錯降級（推薦）<br>
            🧠 IRT：根據試題反應理論(Item Response Theory)即時估計能力值，智慧選題
          </p>
        </div>
      </div>

      <!-- ==================== -->
      <!-- 🎨 配色主題           -->
      <!-- ==================== -->
      <div class="settings-section">
        <h2>🎨 配色主題</h2>
        <div class="theme-selector" id="themeSelector">
          <button class="theme-option active" data-theme="field-primary" aria-pressed="true">
            <span class="theme-option__preview theme-option__preview--field"></span>
            <span class="theme-option__name">遊戲場配色</span>
            <span class="theme-option__desc">顏色隨遊戲場改變</span>
          </button>
          <button class="theme-option" data-theme="rule-independent" aria-pressed="false">
            <span class="theme-option__preview theme-option__preview--rule"></span>
            <span class="theme-option__name">規則配色</span>
            <span class="theme-option__desc">統一色系，不隨遊戲場變</span>
          </button>
        </div>
      </div>

      <!-- ==================== -->
      <!--  玩家資訊           -->
      <!-- ==================== -->
      <div class="settings-section">
        <h2>👤 玩家資訊</h2>
        <a
          href="../singleplayer/stats.html"
          class="settings-btn"
          style="
            background: rgba(79, 195, 247, 0.2);
            color: #4fc3f7;
            border: 1px solid rgba(79, 195, 247, 0.3);
            text-decoration: none;
          "
        >
          📊 玩家資訊與統計
        </a>
        <p
          style="
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.65);
            text-align: center;
            margin-top: 6px;
            line-height: 1.4;
          "
        >
          玩家身份、遊戲紀錄、探險進度、徽章收集、資料管理
        </p>
      </div>

      <!-- ==================== -->
      <!-- 💾 資料管理           -->
      <!-- ==================== -->
      <div class="settings-section">
        <h2>💾 資料管理</h2>
        <button class="settings-btn" id="btnExport" style="background:rgba(76,175,80,0.2);color:#66bb6a;border:1px solid rgba(76,175,80,0.3)">
          📥 匯出遊戲紀錄 (JSON)
        </button>
        <button class="settings-btn" id="btnImport" style="background:rgba(33,150,243,0.2);color:#42a5f5;border:1px solid rgba(33,150,243,0.3);margin-top:8px">
          📤 匯入遊戲紀錄 (JSON)
        </button>
        <input type="file" id="importFileInput" accept=".json" style="display:none" />
        <button class="settings-btn" id="btnClearAll" style="background:rgba(244,67,54,0.15);color:#ef5350;border:1px solid rgba(244,67,54,0.3);margin-top:8px">
          🗑️ 清除所有資料
        </button>
        <p style="font-size:0.75rem;color:rgba(255,255,255,0.5);text-align:center;margin-top:8px;line-height:1.4">
          清除前建議先匯出備份，清除後所有遊戲紀錄、進度、星星和徽章將永久刪除
        </p>
        <button class="settings-btn" id="btnClearCache" style="background:rgba(255,152,0,0.15);color:#ffa726;border:1px solid rgba(255,152,0,0.3);margin-top:12px">
          🧹 僅清除快取儲存空間
        </button>
        <p style="font-size:0.75rem;color:rgba(255,255,255,0.5);text-align:center;margin-top:8px;line-height:1.4">
          僅清除離線快取（不影響遊戲紀錄），可釋放儲存空間。下次載入頁面會重新快取。
        </p>
      </div>

      <!-- ==================== -->
      <!-- ℹ️ 關於               -->
      <!-- ==================== -->
      <div class="settings-section">
        <h2>ℹ️ 關於</h2>
        <div class="settings-item">
          <span class="settings-item__label">版本</span>
          <span class="settings-item__value">v5.0</span>
        </div>
        <div class="settings-item">
          <span class="settings-item__label">開發者</span>
          <span class="settings-item__value">Patience Lee</span>
        </div>
        <div class="settings-item">
          <span class="settings-item__label">專案</span>
          <span class="settings-item__value">執行功能訓練遊戲</span>
        </div>
        <a
          href="../privacy.html"
          class="settings-item"
          style="text-decoration: none; cursor: pointer"
        >
          <span class="settings-item__label">隱私權政策</span>
          <span
            class="settings-item__value"
            style="color: rgba(168, 237, 234, 0.8)"
            >查看 →</span
          >
        </a>
      </div>

      <!-- ==================== -->
      <!-- 📞 研究者聯絡資訊       -->
      <!-- ==================== -->
      <div class="settings-section">
        <h2>📞 研究者聯絡資訊</h2>
        <div style="text-align:center;padding:8px 0">
          <a href="https://lin.ee/KB0tzxv" target="_blank" rel="noopener" style="display:inline-block">
            <img
              src="../images/%5BQRcode%5D%20%40ynx0042l.jpg"
              alt="Line QR Code"
              style="width:160px;height:160px;border-radius:12px;border:2px solid rgba(255,255,255,0.1)"
            />
          </a>
          <p style="margin-top:10px;font-size:0.88rem;color:#a8edea">
            研究者：<strong>李珮瑄</strong>
          </p>
          <p style="margin-top:6px;font-size:0.88rem;color:#a8edea">
            Line ID：<strong>@ynx0042l</strong>
          </p>
          <p style="font-size:0.75rem;color:rgba(255,255,255,0.45);margin-top:4px">
            （ynx零 零 4 2 小寫L）
          </p>
          <p style="font-size:0.75rem;color:rgba(255,255,255,0.5);margin-top:6px">
            有任何問題歡迎透過 Line 聯繫研究者
          </p>
        </div>
      </div>

      <!-- ==================== -->
      <!-- 🔧 開發者與研究者工具 -->
      <!-- ==================== -->
      <div style="text-align:center;margin-top:24px;padding-bottom:20px">
        <button
          id="btnDevTools"
          style="
            background: none;
            border: none;
            color: rgba(255,255,255,0.25);
            font-size: 0.72rem;
            cursor: pointer;
            padding: 8px 16px;
            letter-spacing: 0.5px;
          "
        >
          🔒 開發者與研究者工具
        </button>
      </div>
    </div>

    <!-- Toast 提示 -->
    <div class="settings-toast" id="toast" role="status" aria-live="polite"></div>

    <!-- 確認彈窗 -->
    <div class="confirm-overlay" id="confirmOverlay" role="dialog" aria-modal="true" aria-label="確認操作">
      <div class="confirm-dialog">
        <div class="confirm-dialog__icon" id="confirmIcon">⚠️</div>
        <div class="confirm-dialog__title" id="confirmTitle">確認操作</div>
        <div class="confirm-dialog__msg" id="confirmMsg">確定要執行嗎？</div>
        <div class="confirm-dialog__actions">
          <button
            class="confirm-dialog__btn confirm-dialog__btn--cancel"
            id="confirmCancel"
          >
            取消
          </button>
          <button
            class="confirm-dialog__btn confirm-dialog__btn--danger"
            id="confirmOk"
          >
            確定
          </button>
        </div>
      </div>
    </main>
  </body>
</html>
