<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;"
    />
    <title>探險地圖 — 執行功能訓練遊戲</title>
    <link rel="icon" href="../favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="../favicon.svg" />
    <link rel="manifest" href="../manifest.json" />
    <meta name="theme-color" content="#302b63" />
    <link rel="stylesheet" href="../css/themes/base.css" />
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="../css/components/landscape-hint.css" />
    <link rel="stylesheet" href="../css/pages/adventure-map.css" />
    <!-- style block extracted → css/pages/adventure-map.css -->
    <link rel="stylesheet" href="../css/components/navbar.css" />
    <link rel="stylesheet" href="../css/components/navbar.css" />
    <!-- === JS 依賴（載入順序重要）=== -->
    <script defer src="../js/game-config.js"></script>
    <script defer src="../js/adventure-maps-config.js"></script>
    <script defer src="../js/utils/storage.js"></script>
    <script defer src="../js/utils/score-calculator.js"></script>
    <script defer src="../js/utils/level-calculator.js"></script>
    <script defer src="../js/utils/badge-checker.js"></script>
    <script defer src="../js/singleplayer/progress-tracker.js"></script>
    <script defer src="../js/singleplayer/mode-controller.js"></script>
    <script defer src="../js/sound-config.js"></script>
    <script defer src="../js/shared/audio-player.js"></script>
    <script defer src="../js/shared/focus-trap.js"></script>
    <script defer src="../js/shared/navbar.js"></script>
    <script defer src="../js/shared/landscape-hint.js"></script>
    <script defer src="../js/singleplayer/adventure-map-controller.js"></script>
  </head>
  <body>
    <!-- === 頂部狀態列 === -->
    <header class="adventure-header">
      <div class="header-left">
        <button
          class="btn-back"
          onclick="ModeController.goToHome()"
          aria-label="返回首頁"
        >
          ←
        </button>
        <span class="header-title" id="header-title">🐭 小老鼠冒險</span>
      </div>
      <div class="header-right">
        <button
          class="btn-pet"
          onclick="window.location.href = 'pet.html'"
          aria-label="我的小雞"
          title="🐔 我的小雞"
        >
          🐔
        </button>
        <button
          class="btn-shop"
          onclick="window.location.href = 'avatar-shop.html'"
          aria-label="換裝商店"
          title="🛍️ 換裝商店"
        >
          🛍️
        </button>
        <button
          class="btn-sticker-book"
          onclick="window.location.href = 'sticker-book.html'"
          aria-label="貼紙圖鑑"
          title="📖 貼紙圖鑑"
        >
          📖
        </button>
        <div class="level-display" id="level-display">
          <span class="level-icon">🥚</span>
          <span class="level-name">蛋寶寶</span>
          <span
            class="level-label"
            style="
              font-size: 0.65rem;
              color: rgba(255, 255, 255, 0.7);
              margin-left: 4px;
            "
            >小雞等級</span
          >
        </div>
        <div class="stars-display">⭐ <span id="total-stars">0</span></div>
      </div>
    </header>

    <main id="main-content">
      <h1 class="sr-only">探險地圖</h1>

      <!-- === 地圖視窗 === -->
      <div class="map-viewport" id="map-viewport">
        <div class="map-container" id="map-container">
          <img
            class="map-bg"
            id="map-bg"
            src="../images/adventure-map.svg"
            alt="探險地圖"
            draggable="false"
          />
          <!-- 探險點疊加層（由 JS 動態生成） -->
          <div class="points-overlay" id="points-overlay"></div>
        </div>
      </div>

      <!-- === 底部 Tab 列 === -->
      <nav class="map-tabs" id="map-tabs">
        <button class="map-tab active" data-map="0" id="tab-map-0">
          <span class="map-tab-icon">🐭</span>
          <span class="map-tab-label">小老鼠冒險</span>
        </button>
        <button class="map-tab" data-map="1" id="tab-map-1">
          <span class="map-tab-icon">🐟</span>
          <span class="map-tab-label">釣魚冒險</span>
        </button>
        <button
          class="map-tab tab-free-select"
          data-map="free"
          id="tab-free-select"
        >
          <span class="map-tab-icon">🆓</span>
          <span class="map-tab-label">自由選擇</span>
        </button>
      </nav>

      <!-- === 探險點 Info Popup === -->
      <div
        class="point-info-popup"
        id="point-info-popup"
        role="dialog"
        aria-modal="true"
        aria-label="探險點資訊"
      >
        <div class="point-info-card">
          <h3 class="point-info-title" id="popup-title">① 規則一</h3>
          <p class="point-info-details" id="popup-details">
            🐭 小老鼠 × 規則一
          </p>
          <p class="point-info-wm" id="popup-wm" style="display: none">
            🧠 含工作記憶測驗
          </p>
          <div class="point-info-best" id="popup-best" style="display: none">
            <p>🏆 最佳紀錄：<span id="popup-best-score">0</span> 分</p>
            <p>⭐ 已獲星星：<span id="popup-best-stars">0</span></p>
          </div>
          <div class="point-info-actions">
            <button class="btn-cancel" onclick="closePointInfo()">取消</button>
            <button
              class="btn-play"
              id="popup-play-btn"
              onclick="playCurrentPoint()"
            >
              ▶️ 開始
            </button>
          </div>
        </div>
      </div>

      <!-- === 首次進入身份輸入對話框 === -->
      <div
        id="identityModal"
        role="dialog"
        aria-modal="true"
        aria-label="輸入身份資訊"
        style="
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.7);
          z-index: 9999;
          display: none;
          align-items: center;
          justify-content: center;
          padding: 16px;
        "
      >
        <div
          style="
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 20px;
            padding: 28px 24px;
            max-width: 360px;
            width: 100%;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
          "
        >
          <div style="text-align: center; margin-bottom: 20px">
            <div style="font-size: 2.5rem; margin-bottom: 8px">👋</div>
            <h2 style="color: #fff; font-size: 1.2rem; margin: 0 0 6px">
              歡迎來到探險地圖！
            </h2>
            <p
              style="
                color: rgba(255, 255, 255, 0.55);
                font-size: 0.85rem;
                margin: 0;
                line-height: 1.4;
              "
            >
              請輸入你的資料，排行榜會用到喔
            </p>
          </div>
          <div style="display: flex; flex-direction: column; gap: 14px">
            <div>
              <label
                for="idNickname"
                style="
                  display: block;
                  color: rgba(255, 255, 255, 0.7);
                  font-size: 0.8rem;
                  font-weight: 600;
                  margin-bottom: 4px;
                "
                >📝 暱稱 / 座號</label
              >
              <input
                id="idNickname"
                type="text"
                placeholder="例如：小明 或 5號"
                maxlength="20"
                style="
                  width: 100%;
                  padding: 10px 14px;
                  border-radius: 10px;
                  border: 1px solid rgba(255, 255, 255, 0.15);
                  background: rgba(255, 255, 255, 0.06);
                  color: #fff;
                  font-size: 1rem;
                  outline: none;
                  box-sizing: border-box;
                "
              />
            </div>
            <div>
              <label
                for="idClass"
                style="
                  display: block;
                  color: rgba(255, 255, 255, 0.7);
                  font-size: 0.8rem;
                  font-weight: 600;
                  margin-bottom: 4px;
                "
                >🏫 班級</label
              >
              <input
                id="idClass"
                type="text"
                placeholder="例如：大班 或 中A班"
                maxlength="20"
                style="
                  width: 100%;
                  padding: 10px 14px;
                  border-radius: 10px;
                  border: 1px solid rgba(255, 255, 255, 0.15);
                  background: rgba(255, 255, 255, 0.06);
                  color: #fff;
                  font-size: 1rem;
                  outline: none;
                  box-sizing: border-box;
                "
              />
            </div>
            <button
              id="idSubmit"
              style="
                margin-top: 4px;
                padding: 12px;
                border-radius: 12px;
                border: none;
                background: linear-gradient(135deg, #4caf50, #27ae60);
                color: #fff;
                font-size: 1rem;
                font-weight: 700;
                cursor: pointer;
                transition: transform 0.15s;
              "
            >
              ✅ 開始探險！
            </button>
          </div>
        </div>
      </div>
    </main>

    <!-- script block extracted → js/singleplayer/adventure-map-controller.js -->
  </body>
</html>
