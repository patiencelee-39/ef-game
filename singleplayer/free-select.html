<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;"
    />
    <title>自由選擇 — 執行功能訓練遊戲</title>
    <link rel="icon" href="../favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="../favicon.svg" />
    <link rel="manifest" href="../manifest.json" />
    <meta name="theme-color" content="#302b63" />
    <link rel="stylesheet" href="../css/themes/base.css" />
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="../css/components/landscape-hint.css" />
    <link rel="stylesheet" href="../css/pages/free-select.css" />
    <link rel="stylesheet" href="../css/components/navbar.css" />
    <!-- JS 依賴 -->
    <script defer src="../js/game-config.js"></script>
    <script defer src="../js/adventure-maps-config.js"></script>
    <script defer src="../js/utils/storage.js"></script>
    <script defer src="../js/utils/score-calculator.js"></script>
    <script defer src="../js/utils/level-calculator.js"></script>
    <script defer src="../js/utils/badge-checker.js"></script>
    <script defer src="../js/shared/game-session-builder.js"></script>
    <script defer src="../js/singleplayer/progress-tracker.js"></script>
    <script defer src="../js/singleplayer/mode-controller.js"></script>
    <script defer src="../js/shared/navbar.js"></script>
    <script defer src="../js/shared/landscape-hint.js"></script>
    <script defer src="../js/singleplayer/free-select-controller.js"></script>
  </head>
  <body>
    <main class="free-select-container" id="main-content">
      <!-- Header -->
      <div class="fs-header">
        <button
          class="btn-back"
          onclick="ModeController.goToAdventureMap()"
          aria-label="返回探險地圖"
        >
          ←
        </button>
        <h1 class="fs-title">🆓 自由選擇</h1>
      </div>

      <!-- 遊戲場選擇 -->
      <p class="section-label">選擇遊戲場</p>
      <div class="field-selector" id="field-selector">
        <button
          class="field-btn"
          data-field="mouse"
          onclick="toggleField('mouse')"
        >
          🐭 小老鼠
        </button>
        <button
          class="field-btn"
          data-field="fishing"
          onclick="toggleField('fishing')"
        >
          🐟 釣魚
        </button>
      </div>

      <!-- 規則選擇 -->
      <p class="section-label">選擇規則</p>
      <div class="rule-selector" id="rule-selector">
        <button
          class="rule-option"
          type="button"
          data-rule="rule1"
          onclick="toggleRule('rule1')"
          role="checkbox"
          aria-checked="false"
        >
          <div class="rule-checkbox" aria-hidden="true"></div>
          <div class="rule-info">
            <div class="rule-name">規則一（建立規則）</div>
            <div class="rule-desc">訓練抑制控制</div>
          </div>
        </button>
        <button
          class="rule-option"
          type="button"
          data-rule="rule2"
          onclick="toggleRule('rule2')"
          role="checkbox"
          aria-checked="false"
        >
          <div class="rule-checkbox" aria-hidden="true"></div>
          <div class="rule-info">
            <div class="rule-name">規則二（規則轉換）</div>
            <div class="rule-desc">訓練認知彈性</div>
          </div>
        </button>
        <button
          class="rule-option"
          type="button"
          data-rule="mixed"
          onclick="toggleRule('mixed')"
          role="checkbox"
          aria-checked="false"
        >
          <div class="rule-checkbox" aria-hidden="true"></div>
          <div class="rule-info">
            <div class="rule-name">混合規則</div>
            <div class="rule-desc">訓練工作記憶 + 認知彈性</div>
          </div>
        </button>
      </div>

      <!-- WM 開關 -->
      <div class="wm-toggle-section">
        <button
          type="button"
          class="wm-toggle"
          onclick="toggleWM()"
          role="switch"
          aria-checked="false"
          aria-label="工作記憶測驗"
        >
          <span class="wm-label">🧠 工作記憶測驗</span>
          <div class="toggle-switch" id="wm-toggle" aria-hidden="true"></div>
        </button>
      </div>

      <!-- 題數 -->
      <div class="question-count-section">
        <p class="section-label">每規則題數</p>
        <div class="count-slider-row">
          <input
            type="range"
            class="count-slider"
            id="count-slider"
            min="6"
            max="30"
            step="2"
            value="6"
            aria-label="每規則題數"
            oninput="updateQuestionCount(this.value)"
          />
          <span class="count-value" id="count-value">6</span>
        </div>
      </div>

      <!-- 組合預覽 -->
      <div class="combo-preview">
        <p class="section-label">組合預覽</p>
        <ul class="combo-list" id="combo-list">
          <li class="no-combo-msg">請選擇遊戲場和規則</li>
        </ul>
      </div>

      <!-- 開始按鈕 -->
      <button
        class="btn-start-game"
        id="btn-start"
        disabled
        onclick="startGame()"
      >
        ▶️ 開始遊戲
      </button>
    </main>

  </body>
</html>
