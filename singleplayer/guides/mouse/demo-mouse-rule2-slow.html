<!--
  ============================================================
  ğŸ“„ demo-mouse-rule2-slow.htmlï¼ˆv2ï¼‰
  ğŸ“ å°è€é¼ éŠæˆ²å ´ Rule2 Go/NoGo ç¤ºç¯„å‹•ç•«ï¼ˆæ…¢ç‰ˆ Bï¼‰
  ğŸ¯ 4-6 æ­²å­¸å‰å¹¼å…’ï¼ˆå«è½æå…’ï¼‰
  ğŸ“ å°æ‡‰ï¼šindex-0204v14.html ç¬¬äºŒå›åˆ
  ğŸ« ä¸­åŸå¤§å­¸ç‰¹æ®Šæ•™è‚²å­¸ç³»
  ============================================================

  ã€è¦å‰‡ï¼šèˆ‡ Rule1 ç›¸åã€‘
  çœ‹åˆ°ğŸ˜ºè²“å’ª â†’ æŒ‰æŒ‰éˆ•ï¼ˆGoï¼‰
  çœ‹åˆ°ğŸ§€èµ·å¸ â†’ ä¸è¦æŒ‰ï¼ˆNoGoï¼‰

  ã€Go å‹•ä½œæµç¨‹ã€‘
  å‹•ä½œä¸€ï¼šFingerTap å¾å³å´ç§»å…¥ â†’ è“‹åˆ°æŒ‰éˆ•æ­£ä¸­å¤®
  å‹•ä½œäºŒï¼šæ‰‹ç•™åœ¨æŒ‰éˆ•ä¸Šï¼Œé»æ“Šï¼ˆä¸‹å£“20px + Hand2åˆ‡æ› + ç¶ å…‰ï¼‰
  å‹•ä½œä¸‰ï¼šæ‰‹é€€å‡º â†’ âœ… å‹¾å‹¾
  é‡è¤‡ Ã—3

  ã€NoGo å‹•ä½œæµç¨‹ã€‘
  FingerTap ç§»å…¥ â†’ HandStop å¾å·¦å´è¡å…¥æ¨é–‹ + Â±45Â°æ–æ‰‹ Ã—3
  â†’ âœ… å‹¾å‹¾ Ã—3 â†’ æ¸…å ´
-->
<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>ç¤ºç¯„å‹•ç•« - å°è€é¼ å ´ Rule2ï¼ˆæ…¢ç‰ˆï¼‰</title>
    <style>
      :root {
        --bg-color: #2c3e50;
        --game-bg: #34495e;
        --text-color: #ecf0f1;
        --primary-color: #3498db;
        --primary-dark: #2980b9;
        --success-color: #2ecc71;
      }
      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family:
          "å¾®è»Ÿæ­£é»‘é«”", "Microsoft JhengHei", "PingFang TC", sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        overflow: hidden;
      }

      /* éŠæˆ²å®¹å™¨ â€” position:relative è®“æ‰‹åœ–å±¤å¯ absolute è¦†è“‹å…¨å€ */
      .demo-container {
        background-color: var(--game-bg);
        border-radius: 15px;
        width: 100%;
        max-width: 420px;
        min-height: 580px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      /* åˆºæ¿€ç‰©å®¹å™¨ï¼ˆèˆ‡éŠæˆ²ä¸€è‡´ 300Ã—400ï¼‰ */
      .stimulus-container {
        position: relative;
        width: 300px;
        height: 400px;
        margin: 10px auto 0;
      }
      .background-layer {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 1;
        top: 0;
        left: 0;
      }
      .stimulus {
        position: absolute;
        z-index: 10;
        width: 120px;
        height: 120px;
        bottom: 50px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
      }
      .stimulus svg {
        width: 100%;
        height: 100%;
        filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
      }

      /* æŒ‰éˆ•ï¼ˆèˆ‡éŠæˆ²ä¸€è‡´ï¼‰ */
      .controls-area {
        width: 100%;
        display: flex;
        justify-content: center;
        padding: 10px 0 15px;
      }
      .btn-key {
        width: 200px;
        height: 120px;
        border: none;
        border-radius: 15px;
        font-size: 2.5em;
        color: white;
        cursor: default;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        transition:
          transform 0.1s,
          box-shadow 0.1s;
        position: relative;
      }
      .btn-key.pressed {
        transform: translateY(4px);
        box-shadow: none;
      }
      .btn-key.glow {
        box-shadow:
          0 0 20px rgba(52, 152, 219, 0.8),
          0 0 40px rgba(46, 204, 113, 0.4);
      }
      .key-hint {
        font-size: 1rem;
        opacity: 0.8;
        margin-bottom: 5px;
        font-weight: bold;
      }
      .btn-label {
        font-size: 1.5rem;
        font-weight: bold;
      }

      /* æ‰‹åœ–å±¤ â€” æ”¾åœ¨ demo-container å±¤ç´šï¼Œæ‰èƒ½è¦†è“‹åˆ°æŒ‰éˆ• */
      .hand-layer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 50;
        pointer-events: none;
        overflow: visible;
      }
      .hand {
        position: absolute;
        width: 80px;
        height: 100px;
        opacity: 0;
        will-change: transform, opacity, top, left;
      }
      .hand-finger {
        left: 440px;
        top: 420px;
      }
      .hand-stop {
        left: -100px;
        top: 400px;
      }
      .hand svg {
        width: 100%;
        height: 100%;
        filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.3));
      }

      /* âœ… å‹¾å‹¾ */
      .checkmark {
        position: absolute;
        z-index: 20;
        font-size: 60px;
        bottom: 175px;
        left: 50%;
        transform: translateX(-50%) scale(0);
        opacity: 0;
        will-change: transform, opacity;
      }
      @keyframes popIn {
        0% {
          transform: translateX(-50%) scale(0);
          opacity: 0;
        }
        50% {
          transform: translateX(-50%) scale(1.3);
          opacity: 1;
        }
        100% {
          transform: translateX(-50%) scale(1);
          opacity: 1;
        }
      }
      @keyframes fadeOut {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      .checkmark.show {
        animation: popIn 0.3s ease-out forwards;
      }
      .checkmark.hide {
        animation: fadeOut 0.2s ease-out forwards;
      }

      /* æ–æ‰‹ï¼ˆÂ±45Â°ï¼‰ */
      @keyframes shakeHand {
        0% {
          transform: rotate(0deg);
        }
        12.5% {
          transform: rotate(-45deg);
        }
        25% {
          transform: rotate(45deg);
        }
        37.5% {
          transform: rotate(-45deg);
        }
        50% {
          transform: rotate(45deg);
        }
        62.5% {
          transform: rotate(-45deg);
        }
        75% {
          transform: rotate(45deg);
        }
        87.5% {
          transform: rotate(-45deg);
        }
        100% {
          transform: rotate(0deg);
        }
      }

      /* é€²åº¦æ¢ */
      .progress-bar {
        width: 90%;
        height: 4px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
        margin: 5px auto 10px;
        overflow: hidden;
      }
      .progress-fill {
        height: 100%;
        width: 0%;
        border-radius: 2px;
        transition: width 0.3s linear;
      }
      .progress-fill.go {
        background: var(--success-color);
      }
      .progress-fill.nogo {
        background: #e74c3c;
      }
      .phase-label {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.4);
        margin-bottom: 8px;
        min-height: 1.2em;
      }

      /* === å£è¨£æ©«å¹… === */
      .mnemonic-banner {
        width: 100%;
        padding: 8px 12px;
        text-align: center;
        background: linear-gradient(
          135deg,
          rgba(52, 152, 219, 0.25),
          rgba(46, 204, 113, 0.18)
        );
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 1.05rem;
        font-weight: 700;
        letter-spacing: 0.5px;
        white-space: pre-line;
        line-height: 1.5;
        display: none;
      }

      /* === å®Œæˆæ§åˆ¶è¦†è“‹ === */
      .guide-done-overlay {
        position: absolute;
        inset: 0;
        z-index: 100;
        background: rgba(44, 62, 80, 0.92);
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 16px;
        border-radius: 15px;
      }
      .guide-done-overlay.show {
        display: flex;
      }
      .guide-done-title {
        font-size: 1.3rem;
        font-weight: 700;
      }
      .guide-done-mnemonic {
        font-size: 1.1rem;
        font-weight: 600;
        text-align: center;
        padding: 10px 18px;
        border-radius: 10px;
        white-space: pre-line;
        line-height: 1.6;
        background: rgba(52, 152, 219, 0.15);
        border: 1px solid rgba(52, 152, 219, 0.3);
      }
      .guide-btn {
        padding: 12px 28px;
        border: none;
        border-radius: 12px;
        font-size: 1.05rem;
        font-weight: 700;
        cursor: pointer;
        color: #fff;
        transition:
          transform 0.15s,
          box-shadow 0.15s;
      }
      .guide-btn:active {
        transform: scale(0.96);
      }
      .guide-btn-ready {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        box-shadow: 0 4px 12px rgba(46, 204, 113, 0.4);
      }
      .guide-btn-replay {
        background: rgba(255, 255, 255, 0.12);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .guide-btn-skip {
        position: absolute;
        top: 12px;
        right: 12px;
        z-index: 110;
        background: rgba(255, 255, 255, 0.25);
        border: 2px solid rgba(255, 255, 255, 0.5);
        color: #fff;
        padding: 10px 22px;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        display: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
        transition:
          background 0.15s,
          transform 0.1s;
      }
      .guide-btn-skip:hover {
        background: rgba(255, 255, 255, 0.4);
        transform: scale(1.05);
      }
      .guide-btn-skip:active {
        transform: scale(0.97);
      }
    </style>
  </head>
  <body>
    <div class="demo-container" id="demoContainer">
      <div class="stimulus-container">
        <div class="background-layer" id="bgLayer"></div>
        <div class="stimulus" id="cheeseStimulus"></div>
        <div class="stimulus" id="catStimulus"></div>
        <div class="checkmark" id="checkmark">âœ…</div>
      </div>
      <div class="controls-area">
        <div class="btn-key" id="actionBtn">
          <span class="key-hint">æŒ‰ç©ºç™½éµ(æˆ–é»æ­¤)</span>
          <span class="btn-label">è’é›†</span>
        </div>
      </div>
      <div class="phase-label" id="phaseLabel"></div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="hand-layer" id="handLayer">
        <div class="hand hand-finger" id="handFinger"></div>
        <div class="hand hand-stop" id="handStop"></div>
      </div>
      <div class="mnemonic-banner" id="mnemonicBanner"></div>
      <div class="guide-done-overlay" id="guideDoneOverlay">
        <div class="guide-done-title">ğŸ‘€ çœ‹å®Œäº†ï¼è¨˜ä½å£è¨£ï¼š</div>
        <div class="guide-done-mnemonic" id="guideDoneMnemonic"></div>
        <button class="guide-btn guide-btn-ready" id="btnGuideReady">
          æº–å‚™å¥½äº†ï¼âœ…
        </button>
        <button class="guide-btn guide-btn-replay" id="btnGuideReplay">
          å†çœ‹ä¸€æ¬¡ ğŸ”„
        </button>
      </div>
      <button class="guide-btn-skip" id="btnGuideSkip">è·³é â©</button>
    </div>

    <script>
      // ===== SVG ç´ æ =====
      const SVG_MOUSE_HOLE = `<svg viewBox="0 0 300 400" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="300" height="350" fill="#E0CCB8"/><rect x="0" y="335" width="300" height="15" fill="#bdc3c7"/><rect x="0" y="350" width="300" height="50" fill="#95a5a6"/><path d="M 110 350 L 110 300 A 40 40 0 0 1 190 300 L 190 350 Z" fill="#1a252f"/></svg>`;
      const SVG_CHEESE = `<svg viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg"><path d="M48.18 68.45L6.7 69.95s-2.63-2.63-2.25-3.57S39.18 38.6 40.49 38.79s4.32 3.38 6.76 2.25c2.44-1.13 0-7.7.75-8.63c.75-.94 27.59-15.39 29.28-16.14c1.69-.75 3.19-2.44 6.57-1.69s11.83 2.25 21.02 8.45s18.77 13.33 18.02 17.27c-.75 3.94-74.71 28.15-74.71 28.15z" fill="#ffe265"/><path d="M19.46 115.57c9.2-1.13 94.98-19.52 98.55-20.08c3.57-.56 5.82-3.94 5.82-7.7s-.94-47.49-.94-47.49s-4.13 1.31-9.01 2.44C109 43.86 69.01 53.62 53.25 57.19S12.33 67.33 9.51 67.33s-5.07-.94-5.07-.94s.75 39.04.94 41.86c.19 2.82 1.5 6.19 4.69 7.13s5.27.69 9.39.19z" fill="#feb502"/><path d="M74.97 25.56c0 2.4 2.44 3.99 6.48 3.87c4.41-.13 5.63-2.75 5.49-4.43c-.14-1.69-2.17-3.17-6.19-3.1c-3.73.07-5.78 1.55-5.78 3.66z" fill="#ff8b0d"/><path d="M29.92 55.48c-6.5 2.19-5.77 7.88-3.87 9.15c1.9 1.27 4.43 1.2 7.39.14s4.84-2.27 5.14-4.25c.28-1.88-2.18-7.23-8.66-5.04z" fill="#ed6b31"/><path d="M88.98 39.22c-4.36.2-9.18 3.33-10.98 6.34c-1.9 3.17-2.04 6.9 2.32 9.22c4.36 2.32 19.78-3.59 19.01-9.01c-.77-5.43-5.77-6.76-10.35-6.55z" fill="#ed6b31"/><path d="M73.85 83.07s6.19-4.58 6.19-7.81c0-3.24-2.67-10.89-14.01-11.47c-10.63-.55-17.18 13.94-10.21 21.4c6.97 7.46 11.19 4.08 13.8 3.38c2.61-.71 4.23-5.5 4.23-5.5z" fill="#ed6b31"/><path d="M43.23 96.09s6.15-3.85 1.43-8.07c-3.32-2.97-7.76-1.63-10.02.68c-2.89 2.96-2.11 7.67.56 9.78c2.68 2.12 8.03-2.39 8.03-2.39z" fill="#ed6b31"/><path d="M22.39 78.78s-.7-2.21-3.21-3.1c-2.82-1-7.03 2.51-5.23 6.26c1.62 3.38 5.21 2.39 5.21 2.39l3.23-5.55z" fill="#ed6b31"/><path d="M112.42 82.01c.61-.66 4.6-3.54 4.6-5.73c0-2.18-6.01-8.92-13.68-3.85s-3.66 12.74-1.55 14.01c2.11 1.27 7.96-1.54 10.63-4.43z" fill="#ed6b31"/><path d="M30.86 58.93c-4.27 1.48-5.88 4.5-4.81 5.7c1.13 1.27 3.59 2.11 7.88.56c3.32-1.2 5-3.21 4.72-5c-.2-1.3-3.92-2.6-7.79-1.26z" fill="#ff8b0d"/><path d="M16.62 78.63c-1.87 2.34-.35 5 1.41 5.63c1.76.63 4.86-1.27 4.65-4.43c-.22-3.17-4.37-3.31-6.06-1.2z" fill="#ff8b0d"/><path d="M38.37 91.38c-4.02 3.26-4.13 6.45-2.58 7.53c1.08.76 5.06 2.34 8.7-.35c2.7-1.99 2.75-6.17 1.9-8.17c-.71-1.7-4.64-1.76-8.02.99z" fill="#ff8b0d"/><path d="M62.77 73.61c-5.38 5.23-6.66 13.72-1.38 15.72c4.65 1.76 11.33.7 15.27-4.15c4.14-5.1 4.58-10.73 1.92-14.05c-3.18-3.99-11.65-1.55-15.81 2.48z" fill="#ff8b0d"/><path d="M87.22 44.43c-7.04 2.39-11.19 7.46-7.6 10c3.59 2.53 7.32 2.16 11.4.77c4.63-1.57 8.17-5.21 8.31-8.66c.11-2.83-5.91-4.22-12.11-2.11z" fill="#ff8b0d"/><path d="M106.02 76.8c-4.79 3.9-6.19 7.81-4.22 9.64s6.69 2.67 11.05-.35c4.53-3.14 4.86-6.7 4.36-9.57c-.56-3.23-6.27-3.73-11.19.28z" fill="#ff8b0d"/></svg>`;
      const SVG_CAT = `<svg viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg"><path fill="#292F33" d="M10.478 22.439s.702 2.281-.337 7.993c-.186 1.025-.46 2.072-.599 2.93c-1.757 0-1.851 2.002-1.478 2.002h2.094c1.337 0 2.971-3.334 3.854-7.961s-3.534-4.964-3.534-4.964zm13.042 3.702s2.272 1.22 2.188 4.081c-.033 1.131-.249 2.091-.355 3.024c-1.832 0-1.839 1.985-1.305 1.985h1.856c.923 0 3.001-3.158 3.379-7.281c.379-4.122-5.763-1.809-5.763-1.809z"/><path fill="#292F33" d="M36 8.447C36 3.525 31.859 1 27 1a1 1 0 1 0 0 2c1.804 0 6.717.934 6.717 5.447c0 2.881-1.567 5.462-3.77 5.982c-.164-.073-.345-.104-.509-.192c-7.239-3.917-13.457.902-15.226-.29c-1.752-1.182-.539-3.255-2.824-5.243c-.33-1.841-1.073-4.477-1.794-4.477c-.549 0-1.265 1.825-1.74 3.656c-.591-1.381-1.363-2.756-1.86-2.756c-.64 0-1.278 2.273-1.594 4.235c-1.68 1.147-2.906 2.809-2.906 4.765c0 2.7 4.05 3.357 5.4 3.411c1.35.054 3.023 3.562 3.585 5.072c1.242 4.367 2.051 8.699 2.698 11.183c-1.649 0-1.804 2.111-1.348 2.111c.713 0 1.953-.003 2.225 0c1.381.014 2.026-4.706 2.026-8.849c0-.212-.011-.627-.011-.627s1.93.505 6.038-.208c2.444-.424 5.03.849 5.746 3.163c.527 1.704 1.399 3.305 1.868 4.484c-1.589 0-1.545 2.037-1.084 2.037c.787 0 1.801.014 2.183 0c1.468-.055.643-7.574 1.03-10.097s1.267-5.578-.229-8.797C34.857 15.236 36 11.505 36 8.447z"/><circle fill="#C3C914" cx="5.994" cy="11.768" r=".9"/><path fill="#66757F" d="M2.984 12.86c-.677.423-.677 1.777-1.015 1.777S.954 13.841.954 12.86c-.001-.981 2.862-.52 2.03 0zm3.594 1.483c-.041.026-.09.036-.142.026c-.018-.004-1.548-.241-2.545.146c-.129.05-.341-.023-.413-.191s.023-.365.152-.415c1.44-.569 2.857-.234 2.934-.218c.139.029.195.19.188.372c-.004.114-.104.235-.174.28zm-.472 2.339a.186.186 0 0 1-.141-.031c-.015-.01-1.331-.83-2.402-.853c-.138-.003-.305-.154-.305-.341c0-.186.165-.335.304-.333c1.552.024 2.724.891 2.789.937c.117.082.104.255.027.424c-.049.107-.189.182-.272.197z"/><path d="M7.854 7.881s.372-.039.859.033c.217-.46.585-.887.585-.887s.281.668.386 1.179c.025.12.218.117.322.189c0 0 .038-3.463-.863-3.836c.001-.002-.755 1.124-1.289 3.322zM4.399 9.36s.384-.267.883-.574c.217-.624.568-1.333.568-1.333s.307.602.345.81c.21-.114.21-.106.403-.19c0 0-.114-2.286-1.099-2.527c0 0-.732 1.372-1.1 3.814z" fill="#7F676D"/><path fill="#66757F" d="M18.45 23.644c-2.649.57-2.38 2.782-2.38 2.782s1.93.505 6.038-.208a5.542 5.542 0 0 1 3.107.377c-1.607-3.047-4.315-3.479-6.765-2.951z"/><path fill="#292F33" d="M5.976 10.982s.333.347.319.778c-.014.43-.25.833-.25.833s-.292-.347-.319-.826c-.027-.48.25-.785.25-.785z"/></svg>`;
      const SVG_FINGER_TAP = `<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path style="fill:#FDC794;" d="M427.677,326.621V220.69c0-16.772-14.124-35.31-30.897-35.31s-30.897,17.655-30.897,35.31V52.966c0-16.772-14.124-35.31-30.897-35.31c-16.772,0-30.897,18.538-30.897,35.31v185.379V35.31c0-16.772-14.124-35.31-30.897-35.31c-16.772,0-30.897,17.655-30.897,35.31v35.31c0-16.772-14.124-35.31-30.897-35.31s-30.897,17.655-30.897,35.31v211.862c0-24.717-21.186-74.152-44.138-97.103l0,0c-19.421-19.421-74.152-6.179-44.138,35.31c21.186,29.131,35.31,90.924,35.31,123.586c0,78.566,61.793,105.931,61.793,105.931v60.91h211.862v-60.91l0,0C429.442,411.366,427.677,414.014,427.677,326.621"/><g><path style="fill:#F9A671;" d="M304.091,440.497h-26.483c-5.297,0-8.828-3.531-8.828-8.828s3.531-8.828,8.828-8.828h26.483c5.297,0,8.828,3.531,8.828,8.828S309.387,440.497,304.091,440.497z"/><path style="fill:#F9A671;" d="M312.918,475.807H268.78c-5.297,0-8.828-3.531-8.828-8.828s3.531-8.828,8.828-8.828h44.138c5.297,0,8.828,3.531,8.828,8.828S318.215,475.807,312.918,475.807z"/><path style="fill:#F9A671;" d="M242.297,184.497c-5.297,0-8.828-3.531-8.828-8.828V60.91c0-5.297,3.531-8.828,8.828-8.828s8.828,3.531,8.828,8.828v114.759C251.125,180.966,247.594,184.497,242.297,184.497z"/><path style="fill:#F9A671;" d="M304.091,184.497c-5.297,0-8.828-3.531-8.828-8.828V43.255c0-5.297,3.531-8.828,8.828-8.828c5.297,0,8.828,3.531,8.828,8.828v132.414C312.918,180.966,309.387,184.497,304.091,184.497z"/><path style="fill:#F9A671;" d="M365.884,263.945c-5.297,0-8.828-3.531-8.828-8.828v-44.138c0-5.297,3.531-8.828,8.828-8.828c5.297,0,8.828,3.531,8.828,8.828v44.138C374.711,260.414,371.18,263.945,365.884,263.945z"/></g></svg>`;
      const SVG_HAND_STOP = `<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><g transform="translate(-1)"><path style="fill:#FDC794;" d="M402.635,450.207c28.248-37.959,26.483-36.193,26.483-123.586V145.655c0-16.772-14.124-30.897-30.897-30.897s-30.897,14.124-30.897,30.897V256V48.552c0-16.772-14.124-30.897-30.897-30.897c-16.772,0-30.897,14.124-30.897,30.897v189.793V30.897C305.532,14.124,291.408,0,274.635,0s-30.897,14.124-30.897,30.897v198.621V66.207c0-16.772-14.124-30.897-30.897-30.897s-30.897,14.124-30.897,30.897v216.276c0-24.717-21.186-74.152-44.138-97.103l0,0c-19.421-19.421-74.152-6.179-44.138,35.31c21.186,29.131,35.31,90.924,35.31,123.586c0,78.566,61.793,105.931,61.793,105.931v35.31c0,15.007,11.476,26.483,26.483,26.483h158.897c15.007,0,26.483-11.476,26.483-26.483V450.207z"/><g><path style="fill:#F9A671;" d="M216.373,459.034h-26.483c-5.297,0-8.828-3.531-8.828-8.828c0-5.297,3.531-8.828,8.828-8.828h26.483c5.297,0,8.828,3.531,8.828,8.828C225.201,455.503,221.67,459.034,216.373,459.034z"/><path style="fill:#F9A671;" d="M401.753,459.034H384.98c-5.297,0-8.828-3.531-8.828-8.828c0-5.297,3.531-8.828,8.828-8.828h16.772c5.297,0,8.828,3.531,8.828,8.828C410.58,455.503,407.049,459.034,401.753,459.034z"/><path style="fill:#F9A671;" d="M243.739,238.345c-5.297,0-8.828-3.531-8.828-8.828V61.793c0-5.297,3.531-8.828,8.828-8.828s8.828,3.531,8.828,8.828v167.724C252.566,234.814,249.035,238.345,243.739,238.345z"/><path style="fill:#F9A671;" d="M305.532,238.345c-5.297,0-8.828-3.531-8.828-8.828V44.138c0-5.297,3.531-8.828,8.828-8.828c5.297,0,8.828,3.531,8.828,8.828v185.379C314.36,234.814,310.828,238.345,305.532,238.345z"/><path style="fill:#F9A671;" d="M367.325,264.828c-5.297,0-8.828-3.531-8.828-8.828V123.586c0-5.297,3.531-8.828,8.828-8.828s8.828,3.531,8.828,8.828V256C376.153,261.297,372.622,264.828,367.325,264.828z"/></g></g></svg>`;

      /** Hand2ï¼šé»æ“ŠæŒ‰ä¸‹ç‹€æ…‹ï¼ˆæ‰‹æŒ‡æ”¶æ” + ç¶ è‰²å…‰ç’°è£é£¾ï¼Œå¼·åŒ–ã€Œå·²æŒ‰ä¸‹ã€çš„è¦–è¦ºå›é¥‹ï¼‰ */
      const SVG_HAND2_CLICK = `<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path style="fill:#FDC794;" d="M425.201,347.119V242.983c0-16.488-13.885-34.712-30.373-34.712s-30.373,17.356-30.373,34.712V95.458c0-16.488-13.885-34.712-30.373-34.712s-30.373,18.224-30.373,34.712V78.102c0-16.488-13.885-34.712-30.373-34.712s-30.373,18.224-30.373,34.712v173.559V112.814c0-16.488-13.885-34.712-30.373-34.712s-30.373,18.224-30.373,34.712v190.915c0-24.298-20.827-72.895-43.39-95.458l0,0c-19.092-19.092-72.895-6.075-43.39,34.712c20.827,28.637,29.505,90.251,34.712,121.492c13.017,76.366,60.746,86.78,60.746,86.78V512h208.271v-60.746l0,0C426.936,413.939,425.201,433.031,425.201,347.119"/><path style="fill:#71C386;" d="M152.713,121.492c-4.339,0-7.81-2.603-8.678-6.942c-0.868-3.471-0.868-6.942-0.868-10.414c0-38.183,30.373-68.556,68.556-69.424C224.74,13.885,253.377,0,273.336,0c18.224,0,38.183,6.942,51.2,17.356h9.546c38.183,0,69.424,31.241,69.424,69.424c0,7.81-0.868,13.885-1.736,19.092c-0.868,4.339-6.075,7.81-10.414,6.075c-4.339-0.868-7.81-6.075-6.075-10.414c0.868-4.339,1.736-8.678,1.736-15.62c0-28.637-23.431-52.068-52.068-52.068h-13.885c-2.603,0-4.339-0.868-6.075-2.603c-8.678-8.678-26.034-14.753-41.654-14.753S232.55,29.505,224.74,45.993c-0.868,0.868-0.868,1.736-1.736,2.603c-1.736,2.603-4.339,3.471-6.942,3.471c-0.868,0-2.603,0-3.471,0c-28.637,0-52.068,23.431-52.068,52.068c0,2.603,0,4.339,0.868,6.942c0.868,4.339-1.736,9.546-6.075,10.414C154.448,121.492,153.581,121.492,152.713,121.492"/><g><path style="fill:#F9A671;" d="M303.709,442.576h-26.034c-5.207,0-8.678-3.471-8.678-8.678c0-5.207,3.471-8.678,8.678-8.678h26.034c5.207,0,8.678,3.471,8.678,8.678C312.387,439.105,308.916,442.576,303.709,442.576"/><path style="fill:#F9A671;" d="M312.387,477.288h-43.39c-5.207,0-8.678-3.471-8.678-8.678s3.471-8.678,8.678-8.678h43.39c5.207,0,8.678,3.471,8.678,8.678S317.594,477.288,312.387,477.288"/><path style="fill:#F9A671;" d="M242.964,260.339c-5.207,0-8.678-3.471-8.678-8.678V95.458c0-5.207,3.471-8.678,8.678-8.678s8.678,3.471,8.678,8.678v156.203C251.642,256.868,248.17,260.339,242.964,260.339"/><path style="fill:#F9A671;" d="M303.709,269.017c-5.207,0-8.678-3.471-8.678-8.678V86.78c0-5.207,3.471-8.678,8.678-8.678s8.678,3.471,8.678,8.678v173.559C312.387,265.546,308.916,269.017,303.709,269.017"/><path style="fill:#F9A671;" d="M364.455,286.373c-5.207,0-8.678-3.471-8.678-8.678v-52.068c0-5.207,3.471-8.678,8.678-8.678s8.678,3.471,8.678,8.678v52.068C373.133,282.902,369.662,286.373,364.455,286.373"/></g></svg>`;

      // ===== DOM =====
      const DOM = {
        container: document.getElementById("demoContainer"),
        bgLayer: document.getElementById("bgLayer"),
        cheese: document.getElementById("cheeseStimulus"),
        cat: document.getElementById("catStimulus"),
        checkmark: document.getElementById("checkmark"),
        handFinger: document.getElementById("handFinger"),
        handStop: document.getElementById("handStop"),
        btn: document.getElementById("actionBtn"),
        phaseLabel: document.getElementById("phaseLabel"),
        progressFill: document.getElementById("progressFill"),
      };

      // ===== è¨ˆæ™‚å™¨ =====
      let timers = [];
      function schedule(fn, delay) {
        const id = setTimeout(fn, delay);
        timers.push(id);
        return id;
      }
      function clearAllTimers() {
        timers.forEach((id) => clearTimeout(id));
        timers = [];
      }

      // ===== æŒ‰éˆ•ä¸­å¿ƒåº§æ¨™ =====
      function getBtnCenter() {
        const cRect = DOM.container.getBoundingClientRect();
        const bRect = DOM.btn.getBoundingClientRect();
        return {
          left: bRect.left - cRect.left + bRect.width / 2 - 40,
          top: bRect.top - cRect.top + bRect.height / 2 - 50,
        };
      }

      // ===== å‹•ç•«å·¥å…· =====
      function moveHandTo(
        hand,
        left,
        top,
        dur,
        ease = "cubic-bezier(0.4,0,0.2,1)",
      ) {
        hand.style.transition = `left ${dur}ms ${ease}, top ${dur}ms ${ease}, opacity 0.15s`;
        hand.style.left = left + "px";
        hand.style.top = top + "px";
      }
      function resetFinger() {
        DOM.handFinger.style.transition = "none";
        DOM.handFinger.style.opacity = "0";
        DOM.handFinger.style.left = "440px";
        DOM.handFinger.style.top = "420px";
      }
      function resetStop() {
        DOM.handStop.style.transition = "none";
        DOM.handStop.style.opacity = "0";
        DOM.handStop.style.left = "-100px";
        DOM.handStop.style.top = "400px";
        DOM.handStop.style.animation = "none";
        DOM.handStop.style.transformOrigin = "center bottom";
      }
      function showCheck() {
        DOM.checkmark.className = "checkmark show";
      }
      function hideCheck() {
        DOM.checkmark.className = "checkmark hide";
      }
      function resetCheck() {
        DOM.checkmark.className = "checkmark";
        DOM.checkmark.style.opacity = "0";
        DOM.checkmark.style.transform = "translateX(-50%) scale(0)";
      }
      function pressBtn() {
        DOM.btn.classList.add("pressed", "glow");
      }
      function releaseBtn() {
        DOM.btn.classList.remove("pressed", "glow");
      }
      function updateProg(pct, type) {
        DOM.progressFill.className = `progress-fill ${type}`;
        DOM.progressFill.style.width = pct + "%";
      }
      function resetAll() {
        DOM.cheese.style.opacity = "0";
        DOM.cat.style.opacity = "0";
        resetFinger();
        resetStop();
        resetCheck();
        releaseBtn();
        updateProg(0, "go");
        DOM.phaseLabel.textContent = "";
      }

      const TOTAL = 21500;

      // ===== Go ç¤ºç¯„ï¼ˆè²“å’ª = Goï¼‰ =====
      function playGo() {
        DOM.phaseLabel.textContent = "â”€â”€ ç¤ºç¯„ 1/2ï¼šçœ‹åˆ°è²“å’ªè¦æŒ‰ï¼â”€â”€";
        updateProg(0, "go");
        const bp = getBtnCenter();

        // è²“å’ªç¬é–“å‡ºç¾
        DOM.cat.innerHTML = SVG_CAT;
        DOM.cat.style.opacity = "1";

        /*
        ============================================================
        Go æ–°ç‰ˆæµç¨‹ï¼šå®Œæ•´å¾ªç’° Ã—3
        
        æ¯æ¬¡å¾ªç’° = ç§»å…¥è“‹ä½æŒ‰éˆ• â†’ é»æ“Š â†’ æ‰‹é€€å‡º â†’ å‹¾å‹¾
        
        å–®æ¬¡å¾ªç’°æ™‚é–“åˆ†é…ï¼ˆç´„ 3300msï¼‰ï¼š
          0ms     æ‰‹å¾å³å´ç§»å…¥
          800ms   æŠµé”æŒ‰éˆ•æ­£ä¸­å¤®ï¼Œåœç•™ 300ms
          1100ms  é»æ“Šï¼ˆä¸‹å£“ 20px + æŒ‰éˆ• 4px + ç¶ å…‰ï¼‰
          1500ms  å›å½ˆ
          1700ms  æ‰‹é€€å‡ºå¾€å³
          2100ms  âœ… å‹¾å‹¾ popIn
          2900ms  å‹¾å‹¾æ·¡å‡º
          3100ms  é‡ç½®ï¼Œæº–å‚™ä¸‹ä¸€æ¬¡
        
        æ™‚é–“è»¸ï¼š
          ç¬¬ 1 æ¬¡ï¼š400ms  ~ 3500ms
          ç¬¬ 2 æ¬¡ï¼š3700ms ~ 6800ms
          ç¬¬ 3 æ¬¡ï¼š7000ms ~ 10100ms
          æ¸…å ´ï¼š   10300ms
        ============================================================
      */
        const CYCLE_DUR = 3300; // å–®æ¬¡å¾ªç’°é•·åº¦
        const CYCLE_GAP = 200; // å¾ªç’°ä¹‹é–“çš„é–“éš”

        for (let i = 0; i < 3; i++) {
          const t = 400 + i * (CYCLE_DUR + CYCLE_GAP);

          // â”€â”€ å‹•ä½œä¸€ï¼šæ‰‹å¾å³å´ç§»å…¥ â†’ è“‹ä½æŒ‰éˆ•æ­£ä¸­å¤® â”€â”€
          schedule(() => {
            resetFinger();
            DOM.handFinger.innerHTML = SVG_FINGER_TAP;
            requestAnimationFrame(() => {
              DOM.handFinger.style.opacity = "1";
              moveHandTo(DOM.handFinger, bp.left, bp.top, 800);
            });
          }, t);

          // â”€â”€ å‹•ä½œäºŒï¼šæ‰‹ç•™åœ¨æŒ‰éˆ•ä¸Šï¼ˆåœç•™ 300msï¼‰â”€â”€
          // ï¼ˆä¸æ·¡å»ï¼Œç­‰å¾…é»æ“Šï¼‰

          // â”€â”€ å‹•ä½œä¸‰ï¼šé»æ“Šï¼ˆä¸‹å£“ 20px + æŒ‰éˆ•å£“ 4px + ç¶ å…‰ + åˆ‡æ› Hand2ï¼‰â”€â”€
          schedule(() => {
            DOM.handFinger.innerHTML = SVG_HAND2_CLICK; // åˆ‡æ›æˆæŒ‰ä¸‹ç‹€æ…‹ï¼ˆç¶ è‰²å…‰ç’°ï¼‰
            DOM.handFinger.style.transition = "top 150ms ease-in";
            DOM.handFinger.style.top = bp.top + 20 + "px";
            pressBtn();
          }, t + 1100);

          // å›å½ˆ + åˆ‡å› FingerTap
          schedule(() => {
            DOM.handFinger.innerHTML = SVG_FINGER_TAP; // åˆ‡å›æ‰‹æŒ‡ä¼¸å‡ºç‹€æ…‹
            DOM.handFinger.style.transition = "top 150ms ease-out";
            DOM.handFinger.style.top = bp.top + "px";
            releaseBtn();
          }, t + 1500);

          // â”€â”€ å‹•ä½œå››ï¼šæ‰‹é€€å‡º â”€â”€
          schedule(() => {
            DOM.handFinger.style.transition = "left 0.4s ease-in, opacity 0.3s";
            DOM.handFinger.style.left = "440px";
            DOM.handFinger.style.opacity = "0";
          }, t + 1700);

          // â”€â”€ å‹•ä½œå››çºŒï¼šâœ… ç¶ è‰²å‹¾å‹¾ â”€â”€
          schedule(() => showCheck(), t + 2100);
          schedule(() => hideCheck(), t + 2900);
          schedule(() => {
            resetCheck();
            resetFinger();
          }, t + 3100);

          // æ›´æ–°é€²åº¦
          schedule(() => {
            updateProg(((i + 1) / 3) * 50, "go");
          }, t + 3200);
        }

        // â”€â”€â”€ æ¸…å ´ï¼ˆGo çµæŸï¼‰â”€â”€â”€
        const goEndTime = 400 + 3 * (CYCLE_DUR + CYCLE_GAP) + 200;
        schedule(() => {
          DOM.cat.style.transition = "opacity 0.3s";
          DOM.cat.style.opacity = "0";
          updateProg(50, "go");
        }, goEndTime);
        schedule(() => {
          DOM.cat.style.transition = "none";
          DOM.cat.innerHTML = "";
          resetFinger();
          resetCheck();
        }, goEndTime + 500);
      }

      // ===== NoGo ç¤ºç¯„ï¼ˆèµ·å¸ = NoGoï¼‰ =====
      function playNoGo() {
        DOM.phaseLabel.textContent = "â”€â”€ ç¤ºç¯„ 2/2ï¼šçœ‹åˆ°èµ·å¸ä¸è¦æŒ‰ï¼â”€â”€";
        const bp = getBtnCenter();

        /*
        NoGo æ™‚é–“è»¸ï¼ˆé…åˆæ–°ç‰ˆ Go çµæŸæ™‚é–“ï¼‰ï¼š
        Go çµæŸç´„ 11600msï¼ŒNoGo å¾ 12500ms é–‹å§‹
      */

        // èµ·å¸ç¬é–“å‡ºç¾
        schedule(() => {
          DOM.cheese.innerHTML = SVG_CHEESE;
          DOM.cheese.style.opacity = "1";
        }, 12500);

        // FingerTap ç§»å…¥ â†’ HandStop æ¨é–‹ Ã—3
        for (let i = 0; i < 3; i++) {
          const t = 13000 + i * 1500;

          // FingerTap å¾å³å´ç§»å…¥ï¼ˆå¾€æŒ‰éˆ•æ–¹å‘ï¼Œä½†åªåˆ°ä¸€åŠï¼‰
          schedule(() => {
            resetFinger();
            DOM.handFinger.innerHTML = SVG_FINGER_TAP;
            requestAnimationFrame(() => {
              DOM.handFinger.style.opacity = "1";
              moveHandTo(
                DOM.handFinger,
                bp.left + 80,
                bp.top,
                500,
                "cubic-bezier(0.6,0,0.4,1)",
              );
            });
          }, t);

          // HandStop è¡å…¥æ¨é–‹ + æ–æ‰‹
          schedule(() => {
            resetStop();
            DOM.handStop.innerHTML = SVG_HAND_STOP;
            requestAnimationFrame(() => {
              DOM.handStop.style.opacity = "1";
              moveHandTo(
                DOM.handStop,
                bp.left - 10,
                bp.top - 20,
                300,
                "cubic-bezier(0.2,0,0,1)",
              );
              DOM.handStop.style.animation = "shakeHand 0.8s ease-in-out 1";
            });
            // FingerTap è¢«æ¨èµ°
            DOM.handFinger.style.transition =
              "left 0.4s cubic-bezier(0,0,0.6,1), opacity 0.3s";
            DOM.handFinger.style.left = "440px";
            DOM.handFinger.style.opacity = "0";
          }, t + 450);

          // HandStop é€€å‡º
          schedule(() => {
            DOM.handStop.style.animation = "none";
            DOM.handStop.style.transition = "left 0.4s ease-in, opacity 0.3s";
            DOM.handStop.style.left = "-100px";
            DOM.handStop.style.opacity = "0";
          }, t + 1100);
          schedule(() => {
            resetStop();
          }, t + 1450);
        }

        // âœ… å‹¾å‹¾ Ã—3
        for (let i = 0; i < 3; i++) {
          const t = 17500 + i * 1000;
          schedule(() => showCheck(), t);
          schedule(() => hideCheck(), t + 800);
          schedule(() => resetCheck(), t + 1000);
        }

        // æ¸…å ´
        schedule(() => {
          DOM.cheese.style.transition = "opacity 0.3s";
          DOM.cheese.style.opacity = "0";
          updateProg(100, "nogo");
        }, 20500);
        schedule(() => {
          DOM.cheese.style.transition = "none";
          DOM.cheese.innerHTML = "";
          resetFinger();
          resetStop();
          resetCheck();
        }, 21000);
      }

      // ===== ä¸»å¾ªç’°ï¼ˆæ”¹ç‚ºå–®æ¬¡ + é¡¯ç¤ºæ§åˆ¶ï¼‰ =====
      let _mnemonic = "";
      let _isEmbedded = window.parent !== window;

      function startCycle() {
        clearAllTimers();
        resetAll();
        document.getElementById("guideDoneOverlay").classList.remove("show");
        playGo();
        playNoGo();
        schedule(() => showDoneOverlay(), TOTAL);
      }

      function showDoneOverlay() {
        clearAllTimers();
        resetAll();
        const ov = document.getElementById("guideDoneOverlay");
        const mn = document.getElementById("guideDoneMnemonic");
        mn.textContent = _mnemonic || "ï¼ˆå£è¨£è¼‰å…¥ä¸­â€¦ï¼‰";
        ov.classList.add("show");
      }

      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("btnGuideReady")
          .addEventListener("click", function () {
            clearAllTimers();
            if (_isEmbedded)
              window.parent.postMessage({ type: "guide-ready" }, "*");
          });
        document
          .getElementById("btnGuideReplay")
          .addEventListener("click", function () {
            startCycle();
          });
        document
          .getElementById("btnGuideSkip")
          .addEventListener("click", function () {
            clearAllTimers();
            if (_isEmbedded)
              window.parent.postMessage({ type: "guide-ready" }, "*");
          });
      });

      window.addEventListener("message", function (e) {
        if (e.data && e.data.type === "init") {
          _mnemonic = e.data.mnemonic || "";
          var banner = document.getElementById("mnemonicBanner");
          if (_mnemonic) {
            banner.textContent = _mnemonic;
            banner.style.display = "block";
          }
          document.getElementById("btnGuideSkip").style.display = "block";
        }
        if (e.data && e.data.type === "stop") {
          clearAllTimers();
        }
      });

      // ===== åˆå§‹åŒ– =====
      function init() {
        DOM.bgLayer.innerHTML = SVG_MOUSE_HOLE;
        DOM.handFinger.innerHTML = SVG_FINGER_TAP;
        DOM.handStop.innerHTML = SVG_HAND_STOP;
        startCycle();
      }
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
