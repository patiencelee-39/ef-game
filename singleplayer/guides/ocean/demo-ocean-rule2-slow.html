<!--
  ============================================================
  ğŸ“„ demo-ocean-rule1-slow.html
  ğŸ“ æµ·æ´‹å ´ Rule2 Go/NoGo ç¤ºç¯„å‹•ç•«ï¼ˆæ…¢ç‰ˆï¼‰
  ğŸ¯ 4-6 æ­²å­¸å‰å¹¼å…’ï¼ˆå«è½æå…’ï¼‰
  ğŸ“ å°æ‡‰ï¼šindex-0204v14.html ç¬¬ä¸‰å›åˆï¼ˆè¦å‰‡äºŒï¼‰
  ğŸ« ä¸­åŸå¤§å­¸ç‰¹æ®Šæ•™è‚²å­¸ç³»
  ============================================================

  ã€è¦å‰‡äºŒã€‘
  çœ‹åˆ°ğŸ¦ˆé¯Šé­š â†’ æŒ‰æŒ‰éˆ•ï¼ˆGoï¼‰
  çœ‹åˆ°ğŸŸé­š â†’ ä¸è¦æŒ‰ï¼ˆNoGoï¼‰

  ã€Go å‹•ä½œæµç¨‹ã€‘ï¼ˆå®Œæ•´å¾ªç’° Ã—3ï¼‰
  ç§»å…¥è“‹ä½æŒ‰éˆ• â†’ é»æ“Š(Hand2) â†’ æ‰‹é€€å‡º â†’ âœ… å‹¾å‹¾

  ã€NoGo å‹•ä½œæµç¨‹ã€‘ï¼ˆÃ—3ï¼‰
  FingerTap ç§»å…¥ â†’ HandStop æ¨é–‹ + Â±45Â°æ–æ‰‹ â†’ é€€å‡º
-->
<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>ç¤ºç¯„å‹•ç•« - æµ·æ´‹å ´ Rule2ï¼ˆæ…¢ç‰ˆï¼‰</title>
    <style>
      :root {
        --bg-color: #2c3e50;
        --game-bg: #34495e;
        --text-color: #ecf0f1;
        --success-color: #2ecc71;
      }
      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family:
          "å¾®è»Ÿæ­£é»‘é«”", "Microsoft JhengHei", "PingFang TC", sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        overflow: hidden;
      }

      /* éŠæˆ²å®¹å™¨ */
      .demo-container {
        background-color: var(--game-bg);
        border-radius: 15px;
        width: 100%;
        max-width: 420px;
        min-height: 580px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      /* åˆºæ¿€ç‰©å®¹å™¨ï¼šèˆ‡éŠæˆ²ä¸€è‡´ 300Ã—400 */
      .stimulus-container {
        position: relative;
        width: 300px;
        height: 400px;
        margin: 10px auto 0;
      }

      /* èƒŒæ™¯å±¤ï¼šå¡«æ»¿å®¹å™¨ */
      .background-layer {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 1;
        top: 0;
        left: 0;
      }
      .background-layer svg {
        width: 100%;
        height: 100%;
      }

      /* åˆºæ¿€ç‰©ï¼šèˆ‡éŠæˆ²ä¸€è‡´ 120Ã—120, bottom:50px */
      .stimulus {
        position: absolute;
        z-index: 10;
        width: 120px;
        height: 120px;
        bottom: 50px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
      }
      .stimulus svg {
        width: 100%;
        height: 100%;
        filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
      }

      /* æŒ‰éˆ•ï¼šèˆ‡éŠæˆ²ä¸€è‡´ */
      .controls-area {
        width: 100%;
        display: flex;
        justify-content: center;
        padding: 10px 0 15px;
      }
      .btn-key {
        width: 200px;
        height: 120px;
        border: none;
        border-radius: 15px;
        font-size: 2.5em;
        color: white;
        cursor: default;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        transition:
          transform 0.1s,
          box-shadow 0.1s;
        position: relative;
      }
      .btn-key.pressed {
        transform: translateY(4px);
        box-shadow: none;
      }
      .btn-key.glow {
        box-shadow:
          0 0 20px rgba(52, 152, 219, 0.8),
          0 0 40px rgba(46, 204, 113, 0.4);
      }
      .key-hint {
        font-size: 1rem;
        opacity: 0.8;
        margin-bottom: 5px;
        font-weight: bold;
      }
      .btn-label {
        font-size: 1.5rem;
        font-weight: bold;
      }

      /* æ‰‹åœ–å±¤ï¼šåœ¨ demo-container å±¤ç´š */
      .hand-layer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 50;
        pointer-events: none;
        overflow: visible;
      }
      .hand {
        position: absolute;
        width: 80px;
        height: 100px;
        opacity: 0;
        will-change: transform, opacity, top, left;
      }
      .hand-finger {
        left: 440px;
        top: 420px;
      }
      .hand-stop {
        left: -100px;
        top: 400px;
      }
      .hand svg {
        width: 100%;
        height: 100%;
        filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.3));
      }

      /* å‹¾å‹¾ */
      .checkmark {
        position: absolute;
        z-index: 20;
        font-size: 60px;
        bottom: 175px;
        left: 50%;
        transform: translateX(-50%) scale(0);
        opacity: 0;
      }
      @keyframes popIn {
        0% {
          transform: translateX(-50%) scale(0);
          opacity: 0;
        }
        50% {
          transform: translateX(-50%) scale(1.3);
          opacity: 1;
        }
        100% {
          transform: translateX(-50%) scale(1);
          opacity: 1;
        }
      }
      @keyframes fadeOut {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      .checkmark.show {
        animation: popIn 0.3s ease-out forwards;
      }
      .checkmark.hide {
        animation: fadeOut 0.2s ease-out forwards;
      }

      /* æ–æ‰‹ Â±45Â° */
      @keyframes shakeHand {
        0% {
          transform: rotate(0deg);
        }
        12.5% {
          transform: rotate(-45deg);
        }
        25% {
          transform: rotate(45deg);
        }
        37.5% {
          transform: rotate(-45deg);
        }
        50% {
          transform: rotate(45deg);
        }
        62.5% {
          transform: rotate(-45deg);
        }
        75% {
          transform: rotate(45deg);
        }
        87.5% {
          transform: rotate(-45deg);
        }
        100% {
          transform: rotate(0deg);
        }
      }

      /* é€²åº¦æ¢ */
      .progress-bar {
        width: 90%;
        height: 4px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
        margin: 5px auto 10px;
        overflow: hidden;
      }
      .progress-fill {
        height: 100%;
        width: 0%;
        border-radius: 2px;
        transition: width 0.3s linear;
      }
      .progress-fill.go {
        background: var(--success-color);
      }
      .progress-fill.nogo {
        background: #e74c3c;
      }
      .phase-label {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.4);
        margin-bottom: 8px;
        min-height: 1.2em;
      }

      /* === å£è¨£æ©«å¹… === */
      .mnemonic-banner {
        width: 100%;
        padding: 8px 12px;
        text-align: center;
        background: linear-gradient(
          135deg,
          rgba(52, 152, 219, 0.25),
          rgba(46, 204, 113, 0.18)
        );
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 1.05rem;
        font-weight: 700;
        letter-spacing: 0.5px;
        white-space: pre-line;
        line-height: 1.5;
        display: none;
      }

      /* === å®Œæˆæ§åˆ¶è¦†è“‹ === */
      .guide-done-overlay {
        position: absolute;
        inset: 0;
        z-index: 100;
        background: rgba(44, 62, 80, 0.92);
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 16px;
        border-radius: 15px;
      }
      .guide-done-overlay.show {
        display: flex;
      }
      .guide-done-title {
        font-size: 1.3rem;
        font-weight: 700;
      }
      .guide-done-mnemonic {
        font-size: 1.1rem;
        font-weight: 600;
        text-align: center;
        padding: 10px 18px;
        border-radius: 10px;
        white-space: pre-line;
        line-height: 1.6;
        background: rgba(52, 152, 219, 0.15);
        border: 1px solid rgba(52, 152, 219, 0.3);
      }
      .guide-btn {
        padding: 12px 28px;
        border: none;
        border-radius: 12px;
        font-size: 1.05rem;
        font-weight: 700;
        cursor: pointer;
        color: #fff;
        transition:
          transform 0.15s,
          box-shadow 0.15s;
      }
      .guide-btn:active {
        transform: scale(0.96);
      }
      .guide-btn-ready {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        box-shadow: 0 4px 12px rgba(46, 204, 113, 0.4);
      }
      .guide-btn-replay {
        background: rgba(255, 255, 255, 0.12);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .guide-btn-skip {
        position: absolute;
        top: 12px;
        right: 12px;
        z-index: 110;
        background: rgba(255, 255, 255, 0.25);
        border: 2px solid rgba(255, 255, 255, 0.5);
        color: #fff;
        padding: 10px 22px;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        display: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
        transition:
          background 0.15s,
          transform 0.1s;
      }
      .guide-btn-skip:hover {
        background: rgba(255, 255, 255, 0.4);
        transform: scale(1.05);
      }
      .guide-btn-skip:active {
        transform: scale(0.97);
      }
    </style>
  </head>
  <body>
    <div class="demo-container" id="demoContainer">
      <div class="stimulus-container">
        <div class="background-layer" id="bgLayer"></div>
        <div class="stimulus" id="fishStimulus"></div>
        <div class="stimulus" id="sharkStimulus"></div>
        <div class="checkmark" id="checkmark">âœ…</div>
      </div>
      <div class="controls-area">
        <div class="btn-key" id="actionBtn">
          <span class="key-hint">æŒ‰ç©ºç™½éµ(æˆ–é»æ­¤)</span>
          <span class="btn-label">é‡£é­š</span>
        </div>
      </div>
      <div class="phase-label" id="phaseLabel"></div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="hand-layer">
        <div class="hand hand-finger" id="handFinger"></div>
        <div class="hand hand-stop" id="handStop"></div>
      </div>
      <div class="mnemonic-banner" id="mnemonicBanner"></div>
      <div class="guide-done-overlay" id="guideDoneOverlay">
        <div class="guide-done-title">ğŸ‘€ çœ‹å®Œäº†ï¼è¨˜ä½å£è¨£ï¼š</div>
        <div class="guide-done-mnemonic" id="guideDoneMnemonic"></div>
        <button class="guide-btn guide-btn-ready" id="btnGuideReady">
          æº–å‚™å¥½äº†ï¼âœ…
        </button>
        <button class="guide-btn guide-btn-replay" id="btnGuideReplay">
          å†çœ‹ä¸€æ¬¡ ğŸ”„
        </button>
      </div>
      <button class="guide-btn-skip" id="btnGuideSkip">è·³é â©</button>
    </div>

    <script>
      // ===== SVG ç´ æï¼ˆå…¨éƒ¨å¾éŠæˆ²ç¢¼ index-0204v14.html æ“·å–ï¼‰ =====
      const SVG_OCEAN_BG = `<svg height="100%" width="100%" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 -70 512 582" xml:space="preserve">
          <rect x="43" y="-170" width="434" height="682" fill="#ffffff" />
          <g transform="translate(10, 0)">
	<circle style="fill:#FFC552;" cx="128.516" cy="93.459" r="43.036"/>
	<path style="fill:#FFC552;" d="M128.511,36.057c-4.546,0-8.232-3.686-8.232-8.232V8.232c0-4.546,3.686-8.232,8.232-8.232c4.546,0,8.232,3.686,8.232,8.232v19.593C136.743,32.371,133.057,36.057,128.511,36.057z"/>
	<path style="fill:#FFC552;" d="M174.923,55.281c-2.106,0-4.214-0.803-5.82-2.411c-3.215-3.215-3.215-8.427,0-11.641l13.854-13.854c3.215-3.215,8.427-3.215,11.641,0c3.215,3.215,3.215,8.427,0,11.641l-13.854,13.854C179.137,54.477,177.031,55.281,174.923,55.281z"/>
	<path style="fill:#FFC552;" d="M213.74,101.694h-19.592c-4.546,0-8.232-3.686-8.232-8.232s3.686-8.232,8.232-8.232h19.592c4.546,0,8.232,3.686,8.232,8.232S218.287,101.694,213.74,101.694z"/>
	<path style="fill:#FFC552;" d="M188.777,161.961c-2.106,0-4.214-0.803-5.82-2.411l-13.854-13.854c-3.215-3.215-3.215-8.427,0-11.641c3.215-3.215,8.427-3.215,11.641,0l13.854,13.854c3.215,3.215,3.215,8.427,0,11.641C192.991,161.157,190.884,161.961,188.777,161.961z"/>
	<path style="fill:#FFC552;" d="M128.511,186.924c-4.546,0-8.232-3.686-8.232-8.232V159.1c0-4.546,3.686-8.232,8.232-8.232c4.546,0,8.232,3.686,8.232,8.232v19.593C136.743,183.239,133.057,186.924,128.511,186.924z"/>
	<path style="fill:#FFC552;" d="M68.244,161.961c-2.107,0-4.214-0.803-5.82-2.411c-3.215-3.215-3.215-8.427,0-11.641l13.854-13.854c3.215-3.215,8.426-3.215,11.642,0c3.215,3.215,3.215,8.427,0,11.641L74.065,159.55C72.458,161.157,70.35,161.961,68.244,161.961z"/>
	<path style="fill:#FFC552;" d="M62.874,101.694H43.281c-4.546,0-8.232-3.686-8.232-8.232s3.686-8.232,8.232-8.232h19.593c4.546,0,8.232,3.686,8.232,8.232S67.42,101.694,62.874,101.694z"/>
	<path style="fill:#FFC552;" d="M82.098,55.281c-2.106,0-4.214-0.803-5.82-2.411L62.424,39.016c-3.215-3.215-3.215-8.427,0-11.641c3.215-3.215,8.427-3.215,11.642,0l13.854,13.854c3.215,3.215,3.215,8.427,0,11.641C86.311,54.477,84.205,55.281,82.098,55.281z"/>
	
</g>
<path style="fill:#FFC552;" d="M43.281,512H476.95V398.961l-28.93-36.03l-114.148,18.582l-96.587-18.582l-76.098,18.582l-54.879-18.582l-63.026,36.03L43.281,512z"/>
<path style="fill:#70B1CC;" d="M476.951,398.961c-27.412-13.165-59.322-13.165-86.734,0l0,0c-27.412,13.165-59.322,13.165-86.734,0l0,0c-27.412-13.165-59.322-13.165-86.734,0l0,0c-27.412,13.165-59.322,13.165-86.734,0l0,0c-27.412-13.165-59.322-13.165-86.734,0V342.98l42.198-37.123l68.39,19.346l50.075-1.276l56.171-18.069l49.611,6.174l38.781,21.075l67.318-32.971l46.83,11.896l14.295,30.95v55.982H476.951z"/>
<path style="fill:#7EC8E6;" d="M476.951,342.98c-27.412-13.165-59.322-13.165-86.734,0l0,0c-27.412,13.165-59.322,13.165-86.734,0l0,0c-27.412-13.165-59.322-13.165-86.734,0l0,0c-27.412,13.165-59.322,13.165-86.734,0l0,0c-27.412-13.165-59.322-13.165-86.734,0V287l42.198-38.217l91.806,18.293l82.831-21.22l94.245,25.052l87.074-25.052l35.516,41.144L476.951,342.98z"/>
<g>
	<path style="fill:#8CDEFF;" d="M444.368,88.209c-5.579,0-10.83,1.405-15.421,3.876c0.509-3.059,0.778-6.199,0.778-9.403c0-31.412-25.464-56.875-56.875-56.875c-24.502,0-45.386,15.495-53.387,37.22c-3.318-1.427-6.973-2.22-10.813-2.22c-15.133,0-27.402,12.269-27.402,27.402c0,0.045,0.003,0.089,0.003,0.134c-0.951-0.083-1.91-0.134-2.882-0.134c-17.995,0-32.583,14.588-32.583,32.583s14.588,32.583,32.583,32.583h165.999c17.995,0,32.583-14.588,32.583-32.583S462.363,88.209,444.368,88.209z"/>
	<path style="fill:#8CDEFF;" d="M390.217,231.02L390.217,231.02c-27.412,13.165-59.321,13.165-86.733,0l0,0c-27.413-13.167-59.322-13.167-86.734,0l0,0c-27.413,13.165-59.322,13.165-86.734,0l0,0c-27.413-13.167-59.322-13.167-86.734,0v55.981c27.412-13.167,59.321-13.167,86.734,0l0,0c27.412,13.165,59.321,13.165,86.734,0l0,0c27.412-13.167,59.321-13.167,86.734,0l0,0c27.412,13.165,59.321,13.165,86.733,0l0,0c27.413-13.167,59.322-13.167,86.734,0V231.02C449.538,217.853,417.629,217.853,390.217,231.02z"/>	
</g>
</svg>`;
      const SVG_FISH = `<svg width="800px" height="800px" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--fxemoji" preserveAspectRatio="xMidYMid meet"><path fill="#00B1FF" d="M315.441 375.133c29.222 39.684 23.023 38.75 42.477 49.205c40.166 21.585-35.655 36.476-69.779 20.388c-34.134-16.08-49.581-55.064-34.495-87.066c15.078-32.002 39.42-12.909 61.797 17.473m185.879 6.456l-2.598-3.253s-.542-.678-1.545-1.838c-.994-1.198-2.545-2.711-4.255-4.896c-.444-.528-.889-1.1-1.385-1.649c-.474-.573-1.01-1.107-1.477-1.785c-.956-1.333-2.041-2.651-3.155-4.066a128.536 128.536 0 0 0-3.291-4.678c-1.055-1.702-2.192-3.427-3.322-5.204c-2.109-3.721-4.384-7.562-6.229-11.847c-.451-1.078-1.046-2.064-1.423-3.194a75.261 75.261 0 0 0-1.333-3.299c-.248-.534-.422-1.114-.602-1.687c-.196-.565-.392-1.137-.587-1.709c-.392-1.13-.837-2.253-1.123-3.442c-.339-1.168-.656-2.343-1.04-3.502c-.293-1.183-.534-2.395-.836-3.586c-.143-.602-.331-1.182-.444-1.792l-.302-1.838l-.354-1.823c-.12-.61-.279-1.204-.309-1.838c-.12-1.242-.316-2.47-.489-3.712c-.038-.287-.12-.648-.12-.889l-.023-.701c-.022-.467-.06-.934-.106-1.4c-.045-.467-.105-.927-.165-1.394l-.03-.173l-.007-.084l-.007-.173l-.015-.715l-.045-1.423l-.139-4.564l.003-.046l.007-.234l.023-.474l.03-.949l.052-1.898c.03-.633-.023-1.272.045-1.898l.174-1.883l.15-1.876c.03-.633.053-1.258.174-1.876c.173-1.235.369-2.462.489-3.712c.03-.625.188-1.228.309-1.831l.354-1.831l.302-1.83c.113-.61.302-1.191.444-1.793c.302-1.19.542-2.402.836-3.593c.384-1.152.701-2.327 1.04-3.502c.286-1.19.731-2.305 1.123-3.442c.196-.572.392-1.137.587-1.702c.18-.573.354-1.152.602-1.687a78.403 78.403 0 0 0 1.333-3.299c.377-1.13.972-2.116 1.423-3.193c1.845-4.286 4.12-8.135 6.229-11.847c1.13-1.785 2.267-3.503 3.322-5.212a120.672 120.672 0 0 0 3.291-4.67c1.114-1.416 2.199-2.734 3.155-4.067c.512-.708.881-1.137 1.288-1.664c.399-.497.76-1.025 1.122-1.507l1.032-1.416c.075-.113.158-.226.234-.339c.135-.128.271-.256.399-.383c.264-.249.519-.49.76-.724c.987-.918 1.8-1.732 2.47-2.395a88.219 88.219 0 0 0 2.012-2.064c4.285-4.661 6.62-11.192 5.739-17.962c-1.59-12.149-12.721-20.705-24.869-19.116c0 0-1.002.136-2.847.445a98.54 98.54 0 0 0-3.382.625c-.331.06-.678.128-1.032.196c-.174.037-.354.074-.542.105c-.226.075-.46.151-.693.234c-.949.324-1.95.67-3.013 1.04c-1.062.383-2.199.768-3.374 1.227c-1.152.451-2.485.941-3.577 1.439c-2.32.994-4.783 2.184-7.464 3.45c-2.583 1.385-5.295 2.967-8.164 4.677c-2.756 1.838-5.656 3.834-8.594 6.048c-5.717 4.594-11.764 9.979-17.217 16.585c-1.192 1.339-2.321 2.76-3.43 4.217c-18.948-61.637-55.38-97.798-97.567-125.726C243.856 48.11 193.567 53.683 157.694 81.67c-35.88 27.988-32.234 96.849-32.234 96.849l283.366 57.231l-.12.2c-1.182 1.996-2.425 3.999-3.427 6.145c-1.047 2.125-2.124 4.263-3.141 6.455c-.941 2.214-1.831 4.481-2.727 6.763c-.429 1.153-.896 2.298-1.281 3.465c-.369 1.175-.737 2.357-1.107 3.54c-.347 1.198-.701 2.388-1.055 3.585c-.346 1.198-.723 2.395-.964 3.623c-.565 2.447-1.055 4.918-1.567 7.396c-.542 2.47-.746 4.994-1.092 7.51l-.452 3.781c-.158 1.265-.166 2.531-.241 3.803l-.158 3.804l-.067 1.906l-.038.949l-.016.482l-.007.234v.12c.007.64-.03-1.258.023 1.461l.241 5.709l.06 1.423l.038.708l.007.188l.03.264l.053.534l.459 4.271l.512 4.256l.287 2.116c.105.701.241 1.258.361 1.898c.512 2.478 1.001 4.948 1.567 7.388c.241 1.228.618 2.425.964 3.631c.354 1.197.708 2.388 1.055 3.577c.37 1.19.738 2.365 1.107 3.548c.384 1.167.851 2.312 1.281 3.457c.896 2.289 1.785 4.549 2.727 6.77c1.017 2.184 2.093 4.331 3.141 6.455c1.001 2.147 2.244 4.142 3.427 6.146c1.205 1.98 2.32 3.984 3.645 5.829c2.606 3.713 5.144 7.321 7.999 10.53c5.453 6.605 11.501 11.99 17.217 16.584c2.937 2.215 5.837 4.211 8.594 6.048c2.869 1.71 5.581 3.291 8.164 4.678c2.681 1.258 5.144 2.455 7.464 3.441c2.312 1.002 4.534 1.733 6.5 2.411c.987.331 1.913.64 2.794.934c.866.309 1.74.467 2.515.678c1.567.406 2.907.708 3.992.941c2.161.474 3.314.678 3.314.678c5.807.979 12.072-.406 17.036-4.368c9.247-7.382 10.761-20.857 3.38-30.106z"></path><path fill="#59CAFC" d="M440.024 284.917c0 45.996-97.158 153.524-217.016 153.524c-85.566 0-159.564-35.037-194.902-85.935c-2.493-3.586.271-8.458 4.625-8.082c4.722.415 10.469.867 15.982 1.168c6.997.392 10.153-8.601 4.459-12.683c-10.876-7.803-25.05-17.684-34.344-23.085c-7.584-4.42-12.465-12.381-12.766-21.156A119.552 119.552 0 0 1 6 284.917c0-84.79 97.157-153.523 217.007-153.523c119.859-.001 217.017 107.528 217.017 153.523"></path><path fill="#2B3B47" d="M85.367 231.356c9.151 0 16.577 7.411 16.577 16.592v20.374c0 9.165-7.426 16.592-16.577 16.592c-9.166 0-16.592-7.427-16.592-16.592v-20.374c0-9.181 7.426-16.592 16.592-16.592"></path><path fill="#00B1FF" d="M225.435 374.209c-4.791 6.726-10.673 1.431-8.27-6.477c5.566-18.301 10.122-47.637 10.122-80.693c0-33.064-4.556-62.391-10.122-80.693c-2.403-7.908 3.479-13.202 8.27-6.477c12.351 17.33 21.253 49.882 21.253 87.171c0 37.295-8.902 69.84-21.253 87.169m58.089-24.374c8.894-12.487 15.311-35.933 15.311-62.798c0-26.865-6.417-50.312-15.311-62.799c-3.458-4.843-7.691-1.024-5.958 4.67c4.014 13.188 7.29 34.313 7.29 58.129c0 23.815-3.276 44.948-7.29 58.136c-1.733 5.695 2.5 9.513 5.958 4.662"></path></svg>`;
      const SVG_SHARK = `<?xml version="1.0" encoding="utf-8"?><svg width="200px" height="200px" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg"><path d="M30.77 22.75c-15.51 7.17-26.7 18.4-26.61 21.12c.05 1.41.77 3.94 2.82 6.1c1.21 1.28 4.43 3.61 6.69 3.75c2.25.14 18.51-10.7 18.51-10.7l16.19-2.25l9.85 23.51s3.24 4.65 7.74 8.45s8.87 5.07 9.85 4.22s-1.9-6.55-2.11-8.02c-.28-1.96-1.13-6.76 3.66-6.05s13.66 4.22 13.66 9.43s-3.52 10.98-13.51 10.98s-24.07-3.24-30.55-2.96c-6.48.28-12.25.84-18.16 3.24c-4.38 1.77-9.29 5.07-9.15 5.49c.14.42 5.63 2.25 12.11 3.1s19.01.7 21.12 3.8c2.11 3.1 2.67 7.56 1.97 14.17s-.42 12.01-.28 12.01c.14 0 5.67-3.16 8.45-8.02c4.5-7.88 4.5-17.46 6.19-19.43c1.69-1.97 8.69-2.51 14.36-3.24c5.82-.75 38.86-2.11 38.86-35.05c0-26.47-25.2-32.38-25.76-32.94c-.56-.56-1.48-4.7.42-8.45c1.5-2.96 4.04-7.46 3.24-8.59c-.99-1.4-10.14.14-16.89 3.66s-11 8.02-11 8.02s-25.97-2.61-41.67 4.65z" fill="#6B7F8C"></path><path d="M34.71 36.82c5.13-2.27 13.53-4.11 19.85-4.5c11.33-.7 20.98.63 20.98.63s4.12 8.59 7.46 12.88c5.84 7.5 14.25 13.3 15.38 11.68c.94-1.35.18-8.45-1.3-12.81c-.73-2.15-3.1-7.88-3.1-7.88s10.28.84 16.19 9.29c5.91 8.45 8.3 26.33-4.65 33.93c-11.26 6.62-17.6 5.63-17.6 5.63s6.75-7.46 5.68-12.72c-1.13-5.54-3.57-7.04-7.79-7.84c-2.67-.5-25.58 0-31.63-.14s-15.16-.56-21.45-2.49c-3.01-.92-5.16-2.35-5.16-2.35l.14-5.07s-5.16 1.03-8.12.75s-7.13-1.97-7.41-2.39c-.28-.42 3.33-3.58 6.34-5.91c3.76-2.9 10.14-8.01 16.19-10.69z" fill="#A8B8C4"></path><path d="M47.52 43.91c0 1.43-1.69 1.36-3.14 1.36c-1.44 0-2.39.09-3.05.56c-.66.47-.18 3.74-6.19 9.2c-3.57 3.24-6.95 5.4-7.51 5.21c-.56-.19-1.64-2.96-1.88-3.99c-2.39.7-7.77-.37-6.95-.56c2.77-.66 6.91-2.56 9.67-4.65c1.92-1.45 5.61-4.35 6.76-5.12c.99-.66 3.85-2.77 5.12-2.91c2.05-.22 7.17-.65 7.17.9z" fill="#ff2b25"></path><path d="M39.64 36.07c0 2.33-2.16 4.32-4.83 4.04c-2.29-.24-4.18-1.89-4.18-4.22s1.82-4.43 4.13-4.5c3.72-.13 4.88 2.35 4.88 4.68z" fill="#2f2f2f"></path><path d="M29.5 53.76c.89-.75-.89-2.82-.89-2.82l-2.16 1.43c0 .01 1.84 2.42 3.05 1.39z" fill="#fffefd"></path><path d="M34.66 49.96c.89-.75-.94-3-.94-3l-2.3 1.78c.01 0 2.03 2.25 3.24 1.22z" fill="#fffefd"></path><path d="M37.01 48.7c-.76.89 1.41 2.91 1.41 2.91s1.8-2.38 1.6-2.53c-.19-.15-1.98-1.59-3.01-.38z" fill="#fffefd"></path><path d="M33.12 52.59c-.76.89.99 3.19 1.29 3.1s1.99-1.88 1.99-1.88s-2.26-2.43-3.28-1.22z" fill="#fffefd"></path><path d="M65.17 25.42c-1.13.75-.38 2.35.28 3.66s1.08 2.51 1.15 4.29c.06 1.6-.35 4.48-.54 5.47c-.17.91-.78 2.9.56 3.24c1.69.42 2.16-.89 2.53-2.16c.49-1.65.74-5.01.66-6.71c-.19-3.64-1.41-5.82-1.97-6.66s-1.57-1.87-2.67-1.13z" fill="#4A5F6D"></path><path d="M73.38 27.67c-.75.6 0 2.39.33 3.19c.33.8.49 1.92.49 3.07c0 .8-.16 2.65-.26 3.68c-.14 1.54-.06 2.46 1.08 2.67c1.78.33 1.85-2.06 2.02-3.05c.13-.79.25-3.39.15-4.61c-.09-1.22-.67-2.99-1.37-4.07c-.57-.85-1.5-1.63-2.44-.88z" fill="#4A5F6D"></path><path d="M57.66 24.72c-1.54.79.14 3.43.56 4.32s1.03 2.86.99 4.93c-.05 2.06-.21 4.18-.56 5.33c-.31 1-1.22 2.7-.52 3.4c1.03 1.03 2.69-.04 3.26-1.71c.84-2.46 1.06-4.48.96-7.67c-.12-4.29-2.39-9.78-4.69-8.6z" fill="#4A5F6D"></path><path d="M28.89 56.3c-.76.89.89 2.96.89 2.96l2.3-1.6s-2.16-2.57-3.19-1.36z" fill="#fffefd"></path><path d="M38.84 46.3c.87-.78-.61-2.44-.61-2.44s-2.11 1.27-2.02 1.41c.21.3 1.69 1.88 2.63 1.03z" fill="#fffefd"></path></svg>`;
      const SVG_FINGER_TAP = `<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path style="fill:#FDC794;" d="M427.677,326.621V220.69c0-16.772-14.124-35.31-30.897-35.31s-30.897,17.655-30.897,35.31V52.966c0-16.772-14.124-35.31-30.897-35.31c-16.772,0-30.897,18.538-30.897,35.31v185.379V35.31c0-16.772-14.124-35.31-30.897-35.31c-16.772,0-30.897,17.655-30.897,35.31v35.31c0-16.772-14.124-35.31-30.897-35.31s-30.897,17.655-30.897,35.31v211.862c0-24.717-21.186-74.152-44.138-97.103l0,0c-19.421-19.421-74.152-6.179-44.138,35.31c21.186,29.131,35.31,90.924,35.31,123.586c0,78.566,61.793,105.931,61.793,105.931v60.91h211.862v-60.91l0,0C429.442,411.366,427.677,414.014,427.677,326.621"/><g><path style="fill:#F9A671;" d="M304.091,440.497h-26.483c-5.297,0-8.828-3.531-8.828-8.828s3.531-8.828,8.828-8.828h26.483c5.297,0,8.828,3.531,8.828,8.828S309.387,440.497,304.091,440.497z"/><path style="fill:#F9A671;" d="M312.918,475.807H268.78c-5.297,0-8.828-3.531-8.828-8.828s3.531-8.828,8.828-8.828h44.138c5.297,0,8.828,3.531,8.828,8.828S318.215,475.807,312.918,475.807z"/><path style="fill:#F9A671;" d="M242.297,184.497c-5.297,0-8.828-3.531-8.828-8.828V60.91c0-5.297,3.531-8.828,8.828-8.828s8.828,3.531,8.828,8.828v114.759C251.125,180.966,247.594,184.497,242.297,184.497z"/><path style="fill:#F9A671;" d="M304.091,184.497c-5.297,0-8.828-3.531-8.828-8.828V43.255c0-5.297,3.531-8.828,8.828-8.828c5.297,0,8.828,3.531,8.828,8.828v132.414C312.918,180.966,309.387,184.497,304.091,184.497z"/><path style="fill:#F9A671;" d="M365.884,263.945c-5.297,0-8.828-3.531-8.828-8.828v-44.138c0-5.297,3.531-8.828,8.828-8.828c5.297,0,8.828,3.531,8.828,8.828v44.138C374.711,260.414,371.18,263.945,365.884,263.945z"/></g></svg>`;
      const SVG_HAND_STOP = `<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><g transform="translate(-1)"><path style="fill:#FDC794;" d="M402.635,450.207c28.248-37.959,26.483-36.193,26.483-123.586V145.655c0-16.772-14.124-30.897-30.897-30.897s-30.897,14.124-30.897,30.897V256V48.552c0-16.772-14.124-30.897-30.897-30.897c-16.772,0-30.897,14.124-30.897,30.897v189.793V30.897C305.532,14.124,291.408,0,274.635,0s-30.897,14.124-30.897,30.897v198.621V66.207c0-16.772-14.124-30.897-30.897-30.897s-30.897,14.124-30.897,30.897v216.276c0-24.717-21.186-74.152-44.138-97.103l0,0c-19.421-19.421-74.152-6.179-44.138,35.31c21.186,29.131,35.31,90.924,35.31,123.586c0,78.566,61.793,105.931,61.793,105.931v35.31c0,15.007,11.476,26.483,26.483,26.483h158.897c15.007,0,26.483-11.476,26.483-26.483V450.207z"/><g><path style="fill:#F9A671;" d="M216.373,459.034h-26.483c-5.297,0-8.828-3.531-8.828-8.828c0-5.297,3.531-8.828,8.828-8.828h26.483c5.297,0,8.828,3.531,8.828,8.828C225.201,455.503,221.67,459.034,216.373,459.034z"/><path style="fill:#F9A671;" d="M401.753,459.034H384.98c-5.297,0-8.828-3.531-8.828-8.828c0-5.297,3.531-8.828,8.828-8.828h16.772c5.297,0,8.828,3.531,8.828,8.828C410.58,455.503,407.049,459.034,401.753,459.034z"/><path style="fill:#F9A671;" d="M243.739,238.345c-5.297,0-8.828-3.531-8.828-8.828V61.793c0-5.297,3.531-8.828,8.828-8.828s8.828,3.531,8.828,8.828v167.724C252.566,234.814,249.035,238.345,243.739,238.345z"/><path style="fill:#F9A671;" d="M305.532,238.345c-5.297,0-8.828-3.531-8.828-8.828V44.138c0-5.297,3.531-8.828,8.828-8.828c5.297,0,8.828,3.531,8.828,8.828v185.379C314.36,234.814,310.828,238.345,305.532,238.345z"/><path style="fill:#F9A671;" d="M367.325,264.828c-5.297,0-8.828-3.531-8.828-8.828V123.586c0-5.297,3.531-8.828,8.828-8.828s8.828,3.531,8.828,8.828V256C376.153,261.297,372.622,264.828,367.325,264.828z"/></g></g></svg>`;
      const SVG_HAND2_CLICK = `<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path style="fill:#FDC794;" d="M425.201,347.119V242.983c0-16.488-13.885-34.712-30.373-34.712s-30.373,17.356-30.373,34.712V95.458c0-16.488-13.885-34.712-30.373-34.712s-30.373,18.224-30.373,34.712V78.102c0-16.488-13.885-34.712-30.373-34.712s-30.373,18.224-30.373,34.712v173.559V112.814c0-16.488-13.885-34.712-30.373-34.712s-30.373,18.224-30.373,34.712v190.915c0-24.298-20.827-72.895-43.39-95.458l0,0c-19.092-19.092-72.895-6.075-43.39,34.712c20.827,28.637,29.505,90.251,34.712,121.492c13.017,76.366,60.746,86.78,60.746,86.78V512h208.271v-60.746l0,0C426.936,413.939,425.201,433.031,425.201,347.119"/><path style="fill:#71C386;" d="M152.713,121.492c-4.339,0-7.81-2.603-8.678-6.942c-0.868-3.471-0.868-6.942-0.868-10.414c0-38.183,30.373-68.556,68.556-69.424C224.74,13.885,253.377,0,273.336,0c18.224,0,38.183,6.942,51.2,17.356h9.546c38.183,0,69.424,31.241,69.424,69.424c0,7.81-0.868,13.885-1.736,19.092c-0.868,4.339-6.075,7.81-10.414,6.075c-4.339-0.868-7.81-6.075-6.075-10.414c0.868-4.339,1.736-8.678,1.736-15.62c0-28.637-23.431-52.068-52.068-52.068h-13.885c-2.603,0-4.339-0.868-6.075-2.603c-8.678-8.678-26.034-14.753-41.654-14.753S232.55,29.505,224.74,45.993c-0.868,0.868-0.868,1.736-1.736,2.603c-1.736,2.603-4.339,3.471-6.942,3.471c-0.868,0-2.603,0-3.471,0c-28.637,0-52.068,23.431-52.068,52.068c0,2.603,0,4.339,0.868,6.942c0.868,4.339-1.736,9.546-6.075,10.414C154.448,121.492,153.581,121.492,152.713,121.492"/><g><path style="fill:#F9A671;" d="M303.709,442.576h-26.034c-5.207,0-8.678-3.471-8.678-8.678c0-5.207,3.471-8.678,8.678-8.678h26.034c5.207,0,8.678,3.471,8.678,8.678C312.387,439.105,308.916,442.576,303.709,442.576"/><path style="fill:#F9A671;" d="M312.387,477.288h-43.39c-5.207,0-8.678-3.471-8.678-8.678s3.471-8.678,8.678-8.678h43.39c5.207,0,8.678,3.471,8.678,8.678S317.594,477.288,312.387,477.288"/><path style="fill:#F9A671;" d="M242.964,260.339c-5.207,0-8.678-3.471-8.678-8.678V95.458c0-5.207,3.471-8.678,8.678-8.678s8.678,3.471,8.678,8.678v156.203C251.642,256.868,248.17,260.339,242.964,260.339"/><path style="fill:#F9A671;" d="M303.709,269.017c-5.207,0-8.678-3.471-8.678-8.678V86.78c0-5.207,3.471-8.678,8.678-8.678s8.678,3.471,8.678,8.678v173.559C312.387,265.546,308.916,269.017,303.709,269.017"/><path style="fill:#F9A671;" d="M364.455,286.373c-5.207,0-8.678-3.471-8.678-8.678v-52.068c0-5.207,3.471-8.678,8.678-8.678s8.678,3.471,8.678,8.678v52.068C373.133,282.902,369.662,286.373,364.455,286.373"/></g></svg>`;

      // ===== DOM =====
      const DOM = {
        container: document.getElementById("demoContainer"),
        bgLayer: document.getElementById("bgLayer"),
        fish: document.getElementById("fishStimulus"),
        shark: document.getElementById("sharkStimulus"),
        checkmark: document.getElementById("checkmark"),
        handFinger: document.getElementById("handFinger"),
        handStop: document.getElementById("handStop"),
        btn: document.getElementById("actionBtn"),
        phaseLabel: document.getElementById("phaseLabel"),
        progressFill: document.getElementById("progressFill"),
      };

      // ===== è¨ˆæ™‚å™¨ =====
      let timers = [];
      function schedule(fn, delay) {
        const id = setTimeout(fn, delay);
        timers.push(id);
        return id;
      }
      function clearAllTimers() {
        timers.forEach((id) => clearTimeout(id));
        timers = [];
      }

      // ===== æŒ‰éˆ•ä¸­å¿ƒåº§æ¨™ =====
      function getBtnCenter() {
        const c = DOM.container.getBoundingClientRect();
        const b = DOM.btn.getBoundingClientRect();
        return {
          left: b.left - c.left + b.width / 2 - 40,
          top: b.top - c.top + b.height / 2 - 50,
        };
      }

      // ===== å‹•ç•«å·¥å…· =====
      function moveHandTo(h, l, t, d, e = "cubic-bezier(0.4,0,0.2,1)") {
        h.style.transition = `left ${d}ms ${e}, top ${d}ms ${e}, opacity 0.15s`;
        h.style.left = l + "px";
        h.style.top = t + "px";
      }
      function resetFinger() {
        DOM.handFinger.style.transition = "none";
        DOM.handFinger.style.opacity = "0";
        DOM.handFinger.style.left = "440px";
        DOM.handFinger.style.top = "420px";
      }
      function resetStop() {
        DOM.handStop.style.transition = "none";
        DOM.handStop.style.opacity = "0";
        DOM.handStop.style.left = "-100px";
        DOM.handStop.style.top = "400px";
        DOM.handStop.style.animation = "none";
        DOM.handStop.style.transformOrigin = "center bottom";
      }
      function showCheck() {
        DOM.checkmark.className = "checkmark show";
      }
      function hideCheck() {
        DOM.checkmark.className = "checkmark hide";
      }
      function resetCheck() {
        DOM.checkmark.className = "checkmark";
        DOM.checkmark.style.opacity = "0";
        DOM.checkmark.style.transform = "translateX(-50%) scale(0)";
      }
      function pressBtn() {
        DOM.btn.classList.add("pressed", "glow");
      }
      function releaseBtn() {
        DOM.btn.classList.remove("pressed", "glow");
      }
      function updateProg(p, t) {
        DOM.progressFill.className = `progress-fill ${t}`;
        DOM.progressFill.style.width = p + "%";
      }

      function resetAll() {
        DOM.fish.style.opacity = "0";
        DOM.shark.style.opacity = "0";
        resetFinger();
        resetStop();
        resetCheck();
        releaseBtn();
        updateProg(0, "go");
        DOM.phaseLabel.textContent = "";
      }

      // ===== Go ç¤ºç¯„ =====
      function playGo() {
        DOM.phaseLabel.textContent = "â”€â”€ ç¤ºç¯„ 1/2ï¼šçœ‹åˆ°é¯Šé­šè¦æŒ‰ï¼â”€â”€";
        updateProg(0, "go");
        const bp = getBtnCenter();

        // é­šç¬é–“å‡ºç¾
        DOM.shark.innerHTML = SVG_SHARK; /* Go: é¯Šé­š */
        DOM.shark.style.opacity = "1";

        const CYCLE = 3300,
          GAP = 200;

        for (let i = 0; i < 3; i++) {
          const t = 400 + i * (CYCLE + GAP);

          // ç§»å…¥è“‹ä½æŒ‰éˆ•
          schedule(() => {
            resetFinger();
            DOM.handFinger.innerHTML = SVG_FINGER_TAP;
            requestAnimationFrame(() => {
              DOM.handFinger.style.opacity = "1";
              moveHandTo(DOM.handFinger, bp.left, bp.top, 800);
            });
          }, t);

          // é»æ“Šï¼ˆåˆ‡æ› Hand2 + ä¸‹å£“ 20pxï¼‰
          schedule(() => {
            DOM.handFinger.innerHTML = SVG_HAND2_CLICK;
            DOM.handFinger.style.transition = "top 150ms ease-in";
            DOM.handFinger.style.top = bp.top + 20 + "px";
            pressBtn();
          }, t + 1100);

          // å›å½ˆï¼ˆåˆ‡å› FingerTapï¼‰
          schedule(() => {
            DOM.handFinger.innerHTML = SVG_FINGER_TAP;
            DOM.handFinger.style.transition = "top 150ms ease-out";
            DOM.handFinger.style.top = bp.top + "px";
            releaseBtn();
          }, t + 1500);

          // æ‰‹é€€å‡º
          schedule(() => {
            DOM.handFinger.style.transition = "left 0.4s ease-in, opacity 0.3s";
            DOM.handFinger.style.left = "440px";
            DOM.handFinger.style.opacity = "0";
          }, t + 1700);

          // å‹¾å‹¾
          schedule(() => showCheck(), t + 2100);
          schedule(() => hideCheck(), t + 2900);
          schedule(() => {
            resetCheck();
            resetFinger();
          }, t + 3100);

          schedule(() => {
            updateProg(((i + 1) / 3) * 50, "go");
          }, t + 3200);
        }

        // æ¸…å ´
        const goEnd = 400 + 3 * (CYCLE + GAP) + 200;
        schedule(() => {
          DOM.shark.style.transition = "opacity 0.3s";
          DOM.shark.style.opacity = "0";
          updateProg(50, "go");
        }, goEnd);
        schedule(() => {
          DOM.shark.style.transition = "none";
          DOM.shark.innerHTML = "";
          resetFinger();
          resetCheck();
        }, goEnd + 500);
      }

      // ===== NoGo ç¤ºç¯„ =====
      function playNoGo() {
        DOM.phaseLabel.textContent = "â”€â”€ ç¤ºç¯„ 2/2ï¼šçœ‹åˆ°é­šä¸è¦æŒ‰ï¼â”€â”€";
        const bp = getBtnCenter();

        // é¯Šé­šç¬é–“å‡ºç¾
        schedule(() => {
          DOM.fish.innerHTML = SVG_FISH;
          DOM.fish.style.opacity = "1"; /* NoGo: é­š */
        }, 12500);

        // HandStop æ¨é–‹ Ã—3
        for (let i = 0; i < 3; i++) {
          const t = 13000 + i * 1500;

          schedule(() => {
            resetFinger();
            DOM.handFinger.innerHTML = SVG_FINGER_TAP;
            requestAnimationFrame(() => {
              DOM.handFinger.style.opacity = "1";
              moveHandTo(
                DOM.handFinger,
                bp.left + 80,
                bp.top,
                500,
                "cubic-bezier(0.6,0,0.4,1)",
              );
            });
          }, t);

          schedule(() => {
            resetStop();
            DOM.handStop.innerHTML = SVG_HAND_STOP;
            requestAnimationFrame(() => {
              DOM.handStop.style.opacity = "1";
              moveHandTo(
                DOM.handStop,
                bp.left - 10,
                bp.top - 20,
                300,
                "cubic-bezier(0.2,0,0,1)",
              );
              DOM.handStop.style.animation = "shakeHand 0.8s ease-in-out 1";
            });
            DOM.handFinger.style.transition =
              "left 0.4s cubic-bezier(0,0,0.6,1), opacity 0.3s";
            DOM.handFinger.style.left = "440px";
            DOM.handFinger.style.opacity = "0";
          }, t + 450);

          schedule(() => {
            DOM.handStop.style.animation = "none";
            DOM.handStop.style.transition = "left 0.4s ease-in, opacity 0.3s";
            DOM.handStop.style.left = "-100px";
            DOM.handStop.style.opacity = "0";
          }, t + 1100);
          schedule(() => resetStop(), t + 1450);
        }

        // å‹¾å‹¾ Ã—3
        for (let i = 0; i < 3; i++) {
          const t = 17500 + i * 1000;
          schedule(() => showCheck(), t);
          schedule(() => hideCheck(), t + 800);
          schedule(() => resetCheck(), t + 1000);
        }

        // æ¸…å ´
        schedule(() => {
          DOM.fish.style.transition = "opacity 0.3s";
          DOM.fish.style.opacity = "0";
          updateProg(100, "nogo");
        }, 20500);
        schedule(() => {
          DOM.fish.style.transition = "none";
          DOM.fish.innerHTML = "";
          resetFinger();
          resetStop();
          resetCheck();
        }, 21000);
      }

      // ===== å£è¨£ & åµŒå…¥ =====
      let _mnemonic = "";
      let _isEmbedded = false;

      function showDoneOverlay() {
        const el = document.getElementById("guideDoneOverlay");
        const mn = document.getElementById("guideDoneMnemonic");
        mn.textContent = _mnemonic;
        el.style.display = "flex";
      }

      // ===== ä¸»å¾ªç’°ï¼ˆå–®æ¬¡ï¼‰ =====
      const TOTAL = 21500;
      function startCycle() {
        clearAllTimers();
        resetAll();
        document.getElementById("guideDoneOverlay").style.display = "none";
        playGo();
        playNoGo();
        schedule(() => showDoneOverlay(), TOTAL);
      }

      // ===== æŒ‰éˆ•äº‹ä»¶ =====
      document.getElementById("btnGuideReady").addEventListener("click", () => {
        clearAllTimers();
        if (_isEmbedded)
          window.parent.postMessage({ type: "guide-ready" }, "*");
      });
      document
        .getElementById("btnGuideReplay")
        .addEventListener("click", () => {
          startCycle();
        });
      document.getElementById("btnGuideSkip").addEventListener("click", () => {
        clearAllTimers();
        if (_isEmbedded)
          window.parent.postMessage({ type: "guide-ready" }, "*");
      });

      // ===== postMessage ç›£è¯ =====
      window.addEventListener("message", (e) => {
        if (!e.data || !e.data.type) return;
        if (e.data.type === "init") {
          _isEmbedded = true;
          _mnemonic = e.data.mnemonic || "";
          const banner = document.getElementById("mnemonicBanner");
          banner.textContent = _mnemonic;
          banner.style.display = _mnemonic ? "block" : "none";
          document.getElementById("btnGuideSkip").style.display = "block";
          startCycle();
        }
        if (e.data.type === "stop") {
          clearAllTimers();
        }
      });

      // ===== åˆå§‹åŒ– =====
      function init() {
        DOM.bgLayer.innerHTML = SVG_OCEAN_BG;
        DOM.handFinger.innerHTML = SVG_FINGER_TAP;
        DOM.handStop.innerHTML = SVG_HAND_STOP;
        if (window.self === window.top) {
          _mnemonic = "ç¤ºç¯„æ¨¡å¼";
          startCycle();
        }
      }
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
