<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;"
    />
    <title>我的小雞 — 執行功能訓練遊戲</title>
    <link rel="icon" href="../favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="../favicon.svg" />
    <link rel="manifest" href="../manifest.json" />
    <meta name="theme-color" content="#302b63" />
    <link rel="stylesheet" href="../css/themes/base.css" />
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="preload" href="../css/components/landscape-hint.css" as="style" onload="this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="../css/components/landscape-hint.css" /></noscript>
    <link rel="stylesheet" href="../css/pages/pet.css" />
    <link rel="preload" href="../css/components/navbar.css" as="style" onload="this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="../css/components/navbar.css" /></noscript>
    <!-- ===== Scripts（依賴鏈載入順序）===== -->
    <script defer src="../js/game-config.js"></script>
    <script defer src="../js/utils/storage.js"></script>
    <script defer src="../js/utils/level-calculator.js"></script>
    <script defer src="../js/shop/pet-config.js"></script>
    <script defer src="../js/shop/pet-manager.js"></script>
    <script defer src="../js/shop/sticker-config.js"></script>
    <script defer src="../js/shop/sticker-manager.js"></script>
    <script defer src="../js/shop/avatar-config.js"></script>
    <script defer src="../js/shop/avatar-manager.js"></script>
    <script defer src="../js/shared/focus-trap.js"></script>
    <script defer src="../js/shared/navbar.js"></script>
    <script defer src="../js/shared/landscape-hint.js"></script>
  </head>
  <body>
    <header class="pet-header">
      <div class="header-left">
        <button class="btn-back" onclick="goBack()" aria-label="返回">←</button>
        <span class="header-title">🐔 我的小雞</span>
      </div>
      <div class="stars-display">⭐ <span id="available-stars">0</span></div>
    </header>

    <main class="pet-main" id="main-content">
      <h1 class="sr-only">我的小雞</h1>
      <!-- ===== 寵物展示區 ===== -->
      <div class="pet-stage" id="pet-stage">
        <div
          class="pet-display"
          id="pet-display"
          role="button"
          tabindex="0"
          aria-label="點擊和小雞互動"
        >
          <span class="pet-emoji pet-idle" id="pet-emoji">🥚</span>
          <span class="pet-mood-icon" id="pet-mood-icon">😐</span>
          <!-- 配件由 JS 動態注入 -->
        </div>
        <div class="pet-name-row">
          <span class="pet-name" id="pet-name">蛋寶寶</span>
          <button
            class="btn-rename"
            onclick="showRenameModal()"
            aria-label="命名小雞"
          >
            ✏️
          </button>
        </div>
        <div class="pet-stage-label" id="pet-stage-label">等級 1</div>
        <div class="pet-mood-label" id="pet-mood-label">心情：普通 😐</div>
        <div class="pet-fed-count" id="pet-fed-count">累計餵食：0 次</div>

        <!-- 成長進度 -->
        <div class="progress-section">
          <div class="progress-label">
            <span id="progress-text">距離下一階段</span>
            <span id="progress-percent">0%</span>
          </div>
          <div class="progress-bar">
            <div
              class="progress-fill"
              id="progress-fill"
              style="width: 0%"
            ></div>
          </div>
          <div class="progress-stages" id="progress-stages">
            <span>🥚</span>
            <span>🐣</span>
            <span>🐥</span>
            <span>🐓</span>
            <span>🦅</span>
          </div>
        </div>
      </div>

      <!-- ===== 分類 Tab ===== -->
      <div class="section-tabs" id="section-tabs">
        <button
          class="section-tab active"
          data-section="food"
          onclick="switchSection('food')"
        >
          🍽️ 餵食
        </button>
        <button
          class="section-tab"
          data-section="accessory"
          onclick="switchSection('accessory')"
        >
          🎀 配件
        </button>
        <button
          class="section-tab"
          data-section="sticker"
          onclick="switchSection('sticker')"
        >
          🎨 貼紙
        </button>
        <button
          class="section-tab"
          data-section="avatar"
          onclick="switchSection('avatar')"
        >
          🖼️ 換裝
        </button>
      </div>

      <!-- ===== 物品網格 ===== -->
      <div class="item-grid" id="item-grid"></div>

      <!-- ===== 開包結果彈窗 ===== -->
      <div
        class="pack-reveal-overlay"
        id="pack-reveal"
        role="dialog"
        aria-modal="true"
        aria-label="開包結果"
      >
        <div class="pack-reveal-card">
          <div class="reveal-emoji" id="reveal-emoji">🎁</div>
          <div class="reveal-name" id="reveal-name">—</div>
          <div class="reveal-rarity" id="reveal-rarity">—</div>
          <div id="reveal-new-dup"></div>
          <div class="reveal-desc" id="reveal-desc">—</div>
          <button class="btn-reveal-ok" onclick="closeReveal()">
            太棒了！
          </button>
        </div>
      </div>
    </main>

    <!-- ===== 動作確認彈窗 ===== -->
    <div
      class="action-popup"
      id="action-popup"
      role="dialog"
      aria-modal="true"
      aria-label="動作確認"
    >
      <div class="action-card">
        <div class="action-emoji" id="popup-emoji">—</div>
        <div class="action-name" id="popup-name">—</div>
        <div class="action-desc" id="popup-desc">—</div>
        <div class="action-price" id="popup-price">—</div>
        <div class="action-buttons" id="popup-buttons"></div>
      </div>
    </div>

    <!-- ===== 餵食成功動畫 ===== -->
    <div class="feed-success-overlay" id="feed-success">
      <div class="feed-success-msg" id="feed-success-msg">😋 好好吃！</div>
    </div>

    <!-- ===== 命名彈窗 ===== -->
    <div
      class="rename-modal"
      id="rename-modal"
      role="dialog"
      aria-modal="true"
      aria-label="給小雞取名字"
    >
      <div class="rename-card">
        <h3>✏️ 給小雞取個名字</h3>
        <input
          class="rename-input"
          id="rename-input"
          type="text"
          maxlength="8"
          placeholder="輸入名字（最多 8 字）"
          aria-label="小雞名字"
        />
        <div class="rename-btns">
          <button
            style="background: var(--success-green); color: #fff"
            onclick="confirmRename()"
          >
            確定
          </button>
          <button
            style="
              background: rgba(255, 255, 255, 0.1);
              color: var(--text-light);
              border: 1px solid rgba(255, 255, 255, 0.2) !important;
            "
            onclick="closeRenameModal()"
          >
            取消
          </button>
        </div>
      </div>
    </div>

    <script defer src="../js/singleplayer/pet-controller.js"></script>
  </body>
</html>
