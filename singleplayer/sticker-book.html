<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;"
    />
    <title>è²¼ç´™åœ–é‘‘ â€” åŸ·è¡ŒåŠŸèƒ½è¨“ç·´éŠæˆ²</title>
    <link rel="icon" href="../favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="../favicon.svg" />
    <link rel="manifest" href="../manifest.json" />
    <meta name="theme-color" content="#302b63" />
    <link rel="stylesheet" href="../css/themes/base.css" />
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="../css/components/landscape-hint.css" />
    <style>
      /* é›†é»å†Šé é¢è¦†å¯« */
      body {
        padding: 0;
        overflow-x: hidden;
        color: var(--text-white);
      }

      /* --- é ‚éƒ¨ç‹€æ…‹åˆ— --- */
      .sticker-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 16px;
        background: rgba(26, 35, 50, 0.92);
        backdrop-filter: blur(8px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .btn-back {
        background: none;
        border: none;
        color: var(--text-white);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 4px 8px;
        border-radius: 8px;
        transition: background var(--transition-fast);
        min-width: var(--touch-target-min);
        min-height: var(--touch-target-min);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .btn-back:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .header-title {
        font-size: var(--font-size-lg);
        font-weight: 700;
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .stars-display {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: var(--font-size-md);
        color: var(--accent-yellow);
        font-weight: 700;
      }

      /* --- ä¸»è¦å…§å®¹å€ --- */
      .sticker-main {
        margin-top: 60px;
        padding: 16px;
        padding-bottom: 100px;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
      }

      /* --- çµ±è¨ˆå¡ç‰‡ --- */
      .stats-card {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--border-radius-xl);
        padding: 20px;
        margin-bottom: 20px;
        text-align: center;
      }

      .stats-progress {
        font-size: var(--font-size-xl);
        font-weight: 900;
        margin-bottom: 8px;
      }

      .stats-bar-outer {
        width: 100%;
        height: 12px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        overflow: hidden;
        margin-bottom: 8px;
      }

      .stats-bar-inner {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--primary-blue),
          var(--accent-yellow)
        );
        border-radius: 6px;
        transition: width var(--transition-normal);
      }

      .stats-detail {
        font-size: var(--font-size-xs);
        color: var(--text-light);
      }

      /* --- é–‹åŒ…æŒ‰éˆ•å€ --- */
      .open-pack-section {
        text-align: center;
        margin-bottom: 24px;
      }

      .btn-open-pack {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 16px 32px;
        font-size: var(--font-size-lg);
        font-weight: 900;
        border: none;
        border-radius: var(--border-radius-xl);
        cursor: pointer;
        min-height: var(--touch-target-min);
        transition: all var(--transition-normal);
        background: linear-gradient(135deg, #f39c12, #e67e22);
        color: #fff;
        box-shadow: 0 4px 15px rgba(243, 156, 18, 0.4);
      }

      .btn-open-pack:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(243, 156, 18, 0.5);
      }

      .btn-open-pack:active:not(:disabled) {
        transform: scale(0.96);
      }

      .btn-open-pack:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        background: #555;
        box-shadow: none;
      }

      .pack-cost {
        font-size: var(--font-size-sm);
        color: var(--text-light);
        margin-top: 8px;
      }

      /* --- åˆ†é¡ Tab --- */
      .category-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
        overflow-x: auto;
        padding-bottom: 4px;
        -webkit-overflow-scrolling: touch;
      }

      .category-tab {
        flex-shrink: 0;
        padding: 8px 16px;
        font-size: var(--font-size-sm);
        font-weight: 600;
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 20px;
        background: none;
        color: var(--text-light);
        cursor: pointer;
        transition: all var(--transition-fast);
        min-height: 40px;
      }

      .category-tab.active {
        background: var(--primary-blue);
        color: #fff;
        border-color: var(--primary-blue);
      }

      .category-tab:hover:not(.active) {
        background: rgba(255, 255, 255, 0.08);
      }

      /* --- è²¼ç´™ç¶²æ ¼ --- */
      .sticker-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 12px;
      }

      .sticker-cell {
        aspect-ratio: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border-radius: var(--border-radius-lg);
        border: 2px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.03);
        transition: all var(--transition-fast);
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .sticker-cell.owned {
        border-color: rgba(255, 255, 255, 0.25);
        background: rgba(255, 255, 255, 0.06);
      }

      .sticker-cell.not-owned {
        opacity: 0.35;
        filter: grayscale(1);
      }

      .sticker-cell:hover {
        transform: scale(1.05);
      }

      .sticker-emoji {
        font-size: 2.5rem;
        line-height: 1;
        margin-bottom: 4px;
      }

      .sticker-name {
        font-size: 0.7rem;
        font-weight: 600;
        text-align: center;
        color: var(--text-light);
      }

      .sticker-cell.not-owned .sticker-emoji {
        filter: brightness(0.3);
      }

      .sticker-cell.not-owned .sticker-name {
        color: #555;
      }

      /* ç¨€æœ‰åº¦é‚Šæ¡†å…‰æšˆ */
      .sticker-cell.owned.rarity-rare {
        border-color: rgba(52, 152, 219, 0.6);
        box-shadow: 0 0 8px rgba(52, 152, 219, 0.2);
      }

      .sticker-cell.owned.rarity-legendary {
        border-color: rgba(243, 156, 18, 0.7);
        box-shadow: 0 0 12px rgba(243, 156, 18, 0.3);
        animation: legendary-glow 3s ease-in-out infinite;
      }

      @keyframes legendary-glow {
        0%,
        100% {
          box-shadow: 0 0 8px rgba(243, 156, 18, 0.2);
        }
        50% {
          box-shadow: 0 0 16px rgba(243, 156, 18, 0.5);
        }
      }

      /* ç¨€æœ‰åº¦è§’æ¨™ */
      .rarity-badge {
        position: absolute;
        top: 4px;
        right: 4px;
        width: 10px;
        height: 10px;
        border-radius: 50%;
      }

      /* é–å®šç‹€æ…‹ */
      .sticker-cell.locked {
        opacity: 0.3;
        filter: grayscale(1);
        pointer-events: none;
      }

      .sticker-lock-badge {
        position: absolute;
        top: 4px;
        left: 4px;
        font-size: 0.9rem;
        line-height: 1;
        z-index: 2;
      }

      .sticker-unlock-label {
        font-size: 0.55rem;
        color: rgba(255, 255, 255, 0.7);
        margin-top: 2px;
      }

      /* ã€Œ?ã€æœªçŸ¥è²¼ç´™åœ–ç¤º */
      .sticker-cell.not-owned .sticker-emoji::after {
        content: "ï¼Ÿ";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -60%);
        font-size: 1.8rem;
        color: rgba(255, 255, 255, 0.2);
      }

      /* --- é–‹åŒ…çµæœ Overlay --- */
      .pack-result-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 300;
        background: rgba(0, 0, 0, 0.8);
        align-items: center;
        justify-content: center;
      }

      .pack-result-overlay.visible {
        display: flex;
      }

      .pack-result-card {
        background: #1e2d3d;
        border: 2px solid rgba(255, 255, 255, 0.15);
        border-radius: var(--border-radius-xl);
        padding: 40px 32px;
        max-width: 320px;
        width: 90%;
        text-align: center;
        animation: pack-reveal 0.5s ease-out;
      }

      @keyframes pack-reveal {
        0% {
          opacity: 0;
          transform: scale(0.5) rotateY(90deg);
        }
        60% {
          transform: scale(1.1) rotateY(0deg);
        }
        100% {
          opacity: 1;
          transform: scale(1) rotateY(0deg);
        }
      }

      .pack-result-emoji {
        font-size: 5rem;
        line-height: 1.2;
        margin-bottom: 16px;
        animation: sticker-bounce 0.6s ease-out 0.3s both;
      }

      @keyframes sticker-bounce {
        0% {
          transform: scale(0);
        }
        60% {
          transform: scale(1.3);
        }
        80% {
          transform: scale(0.9);
        }
        100% {
          transform: scale(1);
        }
      }

      .pack-result-name {
        font-size: var(--font-size-xl);
        font-weight: 900;
        margin-bottom: 4px;
      }

      .pack-result-rarity {
        font-size: var(--font-size-sm);
        font-weight: 700;
        margin-bottom: 8px;
      }

      .pack-result-desc {
        font-size: var(--font-size-sm);
        color: var(--text-light);
        margin-bottom: 4px;
      }

      .pack-result-status {
        font-size: var(--font-size-md);
        font-weight: 700;
        margin-bottom: 20px;
      }

      .pack-result-status.is-new {
        color: var(--accent-yellow);
      }

      .pack-result-status.is-dupe {
        color: var(--text-light);
      }

      .btn-result-close {
        padding: 12px 32px;
        font-size: var(--font-size-md);
        font-weight: 700;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        min-height: var(--touch-target-min);
        background: var(--primary-blue);
        color: #fff;
        transition: background var(--transition-fast);
      }

      .btn-result-close:hover {
        background: #2980b9;
      }

      /* --- è²¼ç´™è©³æƒ… Popup --- */
      .sticker-detail-popup {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 250;
        background: rgba(0, 0, 0, 0.6);
        align-items: center;
        justify-content: center;
      }

      .sticker-detail-popup.visible {
        display: flex;
      }

      .sticker-detail-card {
        background: #1e2d3d;
        border: 2px solid rgba(255, 255, 255, 0.15);
        border-radius: var(--border-radius-xl);
        padding: 32px 24px;
        max-width: 300px;
        width: 85%;
        text-align: center;
        animation: popup-in 0.3s ease-out;
      }

      @keyframes popup-in {
        0% {
          opacity: 0;
          transform: scale(0.9) translateY(20px);
        }
        100% {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      .detail-emoji {
        font-size: 4rem;
        margin-bottom: 12px;
      }

      .detail-name {
        font-size: var(--font-size-xl);
        font-weight: 900;
        margin-bottom: 4px;
      }

      .detail-rarity {
        font-size: var(--font-size-sm);
        font-weight: 700;
        margin-bottom: 8px;
      }

      .detail-desc {
        font-size: var(--font-size-sm);
        color: var(--text-light);
        margin-bottom: 16px;
      }

      .btn-detail-close {
        padding: 10px 24px;
        font-size: var(--font-size-sm);
        font-weight: 600;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-light);
        border: 1px solid rgba(255, 255, 255, 0.2);
        min-height: 44px;
      }

      /* --- éŸ¿æ‡‰å¼ --- */
      @media (max-width: 400px) {
        .sticker-grid {
          grid-template-columns: repeat(3, 1fr);
          gap: 8px;
        }
        .sticker-emoji {
          font-size: 2rem;
        }
        .sticker-name {
          font-size: 0.6rem;
        }
      }

      @media (min-width: 601px) {
        .sticker-grid {
          grid-template-columns: repeat(5, 1fr);
        }
      }
    </style>
    <link rel="stylesheet" href="../css/components/navbar.css" />
    <!-- === JS ä¾è³´ï¼ˆè¼‰å…¥é †åºé‡è¦ï¼‰=== -->
    <script defer src="../js/game-config.js"></script>
    <script defer src="../js/utils/storage.js"></script>
    <script defer src="../js/utils/level-calculator.js"></script>
    <script defer src="../js/shop/sticker-config.js"></script>
    <script defer src="../js/shop/sticker-manager.js"></script>
    <script defer src="../js/shared/navbar.js"></script>
    <script defer src="../js/shared/landscape-hint.js"></script>
  </head>
  <body>
    <!-- === é ‚éƒ¨ç‹€æ…‹åˆ— === -->
    <header class="sticker-header">
      <div class="header-left">
        <button class="btn-back" onclick="goBack()" aria-label="è¿”å›æ¢éšªåœ°åœ–">
          â†
        </button>
        <span class="header-title">ğŸ“– è²¼ç´™åœ–é‘‘</span>
      </div>
      <div class="header-right">
        <div class="stars-display">â­ <span id="available-stars">0</span></div>
      </div>
    </header>

    <!-- === ä¸»è¦å…§å®¹ === -->
    <main class="sticker-main" id="main-content">
      <h1 class="sr-only">è²¼ç´™åœ–é‘‘</h1>
      <!-- çµ±è¨ˆå¡ç‰‡ -->
      <div class="stats-card">
        <div class="stats-progress" id="stats-progress">0 / 23</div>
        <div class="stats-bar-outer">
          <div class="stats-bar-inner" id="stats-bar" style="width: 0%"></div>
        </div>
        <div class="stats-detail" id="stats-detail">æ”¶é›†é€²åº¦ 0%</div>
      </div>

      <!-- é–‹åŒ…æŒ‰éˆ• -->
      <div class="open-pack-section">
        <button
          class="btn-open-pack"
          id="btn-open-pack"
          onclick="handleOpenPack()"
        >
          ğŸ é–‹å•Ÿè²¼ç´™åŒ…
        </button>
        <div class="pack-cost" id="pack-cost">èŠ±è²» 3 â­ é–‹å•Ÿä¸€åŒ…</div>
      </div>

      <!-- åˆ†é¡ Tab -->
      <div class="category-tabs" id="category-tabs">
        <button
          class="category-tab active"
          data-category="all"
          onclick="filterByCategory('all')"
        >
          ğŸ“‹ å…¨éƒ¨
        </button>
        <!-- ç”± JS å‹•æ…‹ç”Ÿæˆåˆ†é¡æŒ‰éˆ• -->
      </div>

      <!-- è²¼ç´™ç¶²æ ¼ -->
      <div class="sticker-grid" id="sticker-grid">
        <!-- ç”± JS å‹•æ…‹æ¸²æŸ“ -->
      </div>
    </main>

    <!-- === é–‹åŒ…çµæœ Overlay === -->
    <div
      class="pack-result-overlay"
      id="pack-result-overlay"
      role="dialog"
      aria-modal="true"
      aria-label="é–‹åŒ…çµæœ"
    >
      <div class="pack-result-card">
        <div class="pack-result-emoji" id="result-emoji">ğŸ</div>
        <div class="pack-result-name" id="result-name">â€”</div>
        <div class="pack-result-rarity" id="result-rarity">â€”</div>
        <div class="pack-result-desc" id="result-desc">â€”</div>
        <div class="pack-result-status" id="result-status">â€”</div>
        <button class="btn-result-close" onclick="closePackResult()">
          å¥½çš„ï¼
        </button>
      </div>
    </div>

    <!-- === è²¼ç´™è©³æƒ… Popup === -->
    <div
      class="sticker-detail-popup"
      id="sticker-detail-popup"
      role="dialog"
      aria-modal="true"
      aria-label="è²¼ç´™è©³æƒ…"
    >
      <div class="sticker-detail-card">
        <div class="detail-emoji" id="detail-emoji">â€”</div>
        <div class="detail-name" id="detail-name">â€”</div>
        <div class="detail-rarity" id="detail-rarity">â€”</div>
        <div class="detail-desc" id="detail-desc">â€”</div>
        <button class="btn-detail-close" onclick="closeDetail()">é—œé–‰</button>
      </div>
    </div>

    <script>
      // =========================================
      // è²¼ç´™åœ–é‘‘é é¢æ§åˆ¶
      // =========================================

      var currentCategory = "all";

      // â”€â”€â”€ åˆå§‹åŒ– â”€â”€â”€

      document.addEventListener("DOMContentLoaded", function () {
        buildCategoryTabs();
        refreshAll();
      });

      // â”€â”€â”€ è¿”å› â”€â”€â”€

      function goBack() {
        if (
          document.referrer &&
          document.referrer.indexOf("adventure-map") !== -1
        ) {
          history.back();
        } else {
          window.location.href = "adventure-map.html";
        }
      }

      // â”€â”€â”€ åˆ·æ–°å…¨éƒ¨ UI â”€â”€â”€

      function refreshAll() {
        updateStarsDisplay();
        updateStats();
        updateOpenPackButton();
        renderStickerGrid(currentCategory);
      }

      // â”€â”€â”€ æ˜Ÿæ˜Ÿé¡¯ç¤º â”€â”€â”€

      function updateStarsDisplay() {
        var available = getAvailableStars();
        document.getElementById("available-stars").textContent = available;
      }

      // â”€â”€â”€ çµ±è¨ˆå¡ç‰‡ â”€â”€â”€

      function updateStats() {
        var stats = StickerManager.getCollectionStats();
        document.getElementById("stats-progress").textContent =
          stats.totalOwned + " / " + stats.totalDefined;
        document.getElementById("stats-bar").style.width =
          stats.completionPercent + "%";
        document.getElementById("stats-detail").textContent =
          "æ”¶é›†é€²åº¦ " +
          stats.completionPercent +
          "%ã€€ï½œã€€å·²è§£é– " +
          stats.totalUnlocked +
          " / " +
          stats.totalDefined +
          "ã€€ï½œã€€å·²é–‹ " +
          stats.openedPacks +
          " åŒ…";
      }

      // â”€â”€â”€ é–‹åŒ…æŒ‰éˆ•ç‹€æ…‹ â”€â”€â”€

      function updateOpenPackButton() {
        var check = StickerManager.canOpenPack();
        var btn = document.getElementById("btn-open-pack");
        btn.disabled = !check.canOpen;

        var costText = document.getElementById("pack-cost");
        if (StickerManager.isCollectionComplete()) {
          costText.textContent = "ğŸ‰ å·²å…¨éƒ¨æ”¶é›†å®Œæˆï¼";
          btn.disabled = true;
          btn.textContent = "ğŸ† åœ–é‘‘å…¨æ»¿";
        } else if (!check.canOpen) {
          costText.textContent =
            "æ˜Ÿæ˜Ÿä¸è¶³ï¼ˆéœ€è¦ " +
            check.cost +
            " â­ï¼Œç›®å‰ " +
            check.available +
            " â­ï¼‰";
        } else {
          costText.textContent = "èŠ±è²» " + check.cost + " â­ é–‹å•Ÿä¸€åŒ…";
        }
      }

      // â”€â”€â”€ åˆ†é¡ Tab â”€â”€â”€

      function buildCategoryTabs() {
        var container = document.getElementById("category-tabs");
        // ã€Œå…¨éƒ¨ã€æŒ‰éˆ•å·²åœ¨ HTML ä¸­

        var categories = getAllCategories();
        categories.forEach(function (cat) {
          var btn = document.createElement("button");
          btn.className = "category-tab";
          btn.dataset.category = cat.id;
          btn.textContent = cat.label;
          btn.onclick = function () {
            filterByCategory(cat.id);
          };
          container.appendChild(btn);
        });
      }

      function filterByCategory(categoryId) {
        currentCategory = categoryId;

        // æ›´æ–° tab æ¨£å¼
        document.querySelectorAll(".category-tab").forEach(function (tab) {
          tab.classList.toggle("active", tab.dataset.category === categoryId);
        });

        renderStickerGrid(categoryId);
      }

      // â”€â”€â”€ è²¼ç´™ç¶²æ ¼æ¸²æŸ“ â”€â”€â”€

      function renderStickerGrid(category) {
        var grid = document.getElementById("sticker-grid");
        grid.innerHTML = "";

        var filter = category === "all" ? null : category;
        var items = StickerManager.getAllStickersWithStatus(filter);

        items.forEach(function (item) {
          var cell = document.createElement("div");

          // åˆ¤æ–·ç‹€æ…‹ï¼šlocked > not-owned > owned
          var stateClass;
          if (item.locked) {
            stateClass = "locked";
          } else if (item.owned) {
            stateClass = "owned";
          } else {
            stateClass = "not-owned";
          }

          cell.className =
            "sticker-cell " + stateClass + " rarity-" + item.sticker.rarity;

          // ğŸ”’ é–å®šæ¨™ç¤º
          if (item.locked) {
            var lockBadge = document.createElement("div");
            lockBadge.className = "sticker-lock-badge";
            lockBadge.textContent = "ğŸ”’";
            cell.appendChild(lockBadge);
          }

          // ç¨€æœ‰åº¦è§’æ¨™
          if (item.owned && item.sticker.rarity !== "common") {
            var badge = document.createElement("div");
            badge.className = "rarity-badge";
            badge.style.background = item.rarity.color;
            cell.appendChild(badge);
          }

          // emoji
          var emoji = document.createElement("div");
          emoji.className = "sticker-emoji";
          if (item.locked) {
            emoji.textContent = "ğŸ”’";
          } else {
            emoji.textContent = item.owned ? item.sticker.emoji : "â“";
          }
          cell.appendChild(emoji);

          // åç¨± / è§£é–æç¤º
          var name = document.createElement("div");
          name.className = "sticker-name";
          if (item.locked) {
            name.textContent = "Lv." + item.requiredLevel + " è§£é–";
          } else {
            name.textContent = item.owned ? item.sticker.name : "???";
          }
          cell.appendChild(name);

          // é»æ“Šäº‹ä»¶ï¼ˆå·²æ“æœ‰æ‰é¡¯ç¤ºè©³æƒ…ï¼‰
          if (item.owned) {
            cell.addEventListener("click", function () {
              showDetail(item.sticker);
            });
          }

          grid.appendChild(cell);
        });
      }

      // â”€â”€â”€ é–‹åŒ… â”€â”€â”€

      function handleOpenPack() {
        var result = StickerManager.openPack();

        if (!result.success) {
          alert(result.reason);
          return;
        }

        // é¡¯ç¤ºçµæœ
        var first = result.results[0];
        var sticker = first.sticker;
        var rarity = STICKER_RARITY[sticker.rarity];

        document.getElementById("result-emoji").textContent = sticker.emoji;
        document.getElementById("result-name").textContent = sticker.name;
        document.getElementById("result-rarity").textContent = rarity.label;
        document.getElementById("result-rarity").style.color = rarity.color;
        document.getElementById("result-desc").textContent = sticker.desc;

        var statusEl = document.getElementById("result-status");
        if (first.isNew) {
          statusEl.textContent = "âœ¨ æ–°æ”¶è—ï¼";
          statusEl.className = "pack-result-status is-new";
        } else {
          statusEl.textContent = "å·²æ“æœ‰ï¼ˆé‡è¤‡ï¼‰";
          statusEl.className = "pack-result-status is-dupe";
        }

        // é¡¯ç¤º overlay
        document.getElementById("pack-result-overlay").classList.add("visible");

        // åˆ·æ–°èƒŒæ™¯è³‡æ–™
        refreshAll();
      }

      function closePackResult() {
        document
          .getElementById("pack-result-overlay")
          .classList.remove("visible");
      }

      // â”€â”€â”€ è²¼ç´™è©³æƒ… â”€â”€â”€

      function showDetail(sticker) {
        var rarity = STICKER_RARITY[sticker.rarity];

        document.getElementById("detail-emoji").textContent = sticker.emoji;
        document.getElementById("detail-name").textContent = sticker.name;
        document.getElementById("detail-rarity").textContent = rarity.label;
        document.getElementById("detail-rarity").style.color = rarity.color;
        document.getElementById("detail-desc").textContent = sticker.desc;

        document
          .getElementById("sticker-detail-popup")
          .classList.add("visible");
      }

      function closeDetail() {
        document
          .getElementById("sticker-detail-popup")
          .classList.remove("visible");
      }

      // é»æ“Š overlay å¤–éƒ¨é—œé–‰
      document
        .getElementById("pack-result-overlay")
        .addEventListener("click", function (e) {
          if (e.target === this) closePackResult();
        });

      document
        .getElementById("sticker-detail-popup")
        .addEventListener("click", function (e) {
          if (e.target === this) closeDetail();
        });
    </script>
  </body>
</html>
