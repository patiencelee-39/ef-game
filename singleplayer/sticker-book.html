<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;"
    />
    <title>貼紙圖鑑 — 執行功能訓練遊戲</title>
    <link rel="icon" href="../favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="../favicon.svg" />
    <link rel="manifest" href="../manifest.json" />
    <meta name="theme-color" content="#302b63" />
    <link rel="stylesheet" href="../css/themes/base.css" />
    <link rel="stylesheet" href="../css/main.css" />
    <link
      rel="preload"
      href="../css/components/landscape-hint.css"
      as="style"
      onload="this.rel = 'stylesheet'"
    />
    <noscript
      ><link rel="stylesheet" href="../css/components/landscape-hint.css"
    /></noscript>
    <link rel="stylesheet" href="../css/pages/sticker-book.css" />
    <link
      rel="preload"
      href="../css/components/navbar.css"
      as="style"
      onload="this.rel = 'stylesheet'"
    />
    <noscript
      ><link rel="stylesheet" href="../css/components/navbar.css"
    /></noscript>
    <!-- === JS 依賴（載入順序重要）=== -->
    <script defer src="../js/game-config.js"></script>
    <script defer src="../js/utils/storage.js"></script>
    <script defer src="../js/utils/level-calculator.js"></script>
    <script defer src="../js/shop/sticker-config.js"></script>
    <script defer src="../js/shop/sticker-manager.js"></script>
    <script defer src="../js/shared/navbar.js"></script>
    <script defer src="../js/shared/landscape-hint.js"></script>
    <script defer src="../js/singleplayer/sticker-book-controller.js"></script>
  </head>
  <body>
    <!-- === 頂部狀態列 === -->
    <header class="sticker-header">
      <div class="header-left">
        <button class="btn-back" onclick="goBack()" aria-label="返回探險地圖">
          ←
        </button>
        <span class="header-title">📖 貼紙圖鑑</span>
      </div>
      <div class="header-right">
        <div class="stars-display">⭐ <span id="available-stars">0</span></div>
      </div>
    </header>

    <!-- === 主要內容 === -->
    <main class="sticker-main" id="main-content">
      <h1 class="sr-only">貼紙圖鑑</h1>
      <!-- 統計卡片 -->
      <div class="stats-card">
        <div class="stats-progress" id="stats-progress">0 / 23</div>
        <div class="stats-bar-outer">
          <div class="stats-bar-inner" id="stats-bar" style="width: 0%"></div>
        </div>
        <div class="stats-detail" id="stats-detail">收集進度 0%</div>
      </div>

      <!-- 開包按鈕 -->
      <div class="open-pack-section">
        <button
          class="btn-open-pack"
          id="btn-open-pack"
          onclick="handleOpenPack()"
        >
          🎁 開啟貼紙包
        </button>
        <div class="pack-cost" id="pack-cost">花費 3 ⭐ 開啟一包</div>
      </div>

      <!-- 分類 Tab -->
      <div class="category-tabs" id="category-tabs">
        <button
          class="category-tab active"
          data-category="all"
          onclick="filterByCategory('all')"
        >
          📋 全部
        </button>
        <!-- 由 JS 動態生成分類按鈕 -->
      </div>

      <!-- 貼紙網格 -->
      <div class="sticker-grid" id="sticker-grid">
        <!-- 由 JS 動態渲染 -->
      </div>
    </main>

    <!-- === 開包結果 Overlay === -->
    <div
      class="pack-result-overlay"
      id="pack-result-overlay"
      role="dialog"
      aria-modal="true"
      aria-label="開包結果"
    >
      <div class="pack-result-card">
        <div class="pack-result-emoji" id="result-emoji">🎁</div>
        <div class="pack-result-name" id="result-name">—</div>
        <div class="pack-result-rarity" id="result-rarity">—</div>
        <div class="pack-result-desc" id="result-desc">—</div>
        <div class="pack-result-status" id="result-status">—</div>
        <button class="btn-result-close" onclick="closePackResult()">
          好的！
        </button>
      </div>
    </div>

    <!-- === 貼紙詳情 Popup === -->
    <div
      class="sticker-detail-popup"
      id="sticker-detail-popup"
      role="dialog"
      aria-modal="true"
      aria-label="貼紙詳情"
    >
      <div class="sticker-detail-card">
        <div class="detail-emoji" id="detail-emoji">—</div>
        <div class="detail-name" id="detail-name">—</div>
        <div class="detail-rarity" id="detail-rarity">—</div>
        <div class="detail-desc" id="detail-desc">—</div>
        <button class="btn-detail-close" onclick="closeDetail()">關閉</button>
      </div>
    </div>
  </body>
</html>
