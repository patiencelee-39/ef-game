# 📋 執行功能訓練遊戲 - 完整需求文件 v3.0

**專案名稱**：3-6歲聽障學齡前幼兒執行功能訓練遊戲  
**開發目標**：多人 Kahoot 風格 → 單人模式（優先順序）  
**部署環境**：Firebase Hosting  
**文件版本**：v3.0（2026/02/11）  
**文件作者**：小摩研究助理  
**前版差異**：計分系統改版、新增工作記憶（場地E）、整合配色系統/命名規範/除錯指南

---

<a id="目錄"></a>

## 📑 目錄

1. [核心設計原則](#一核心設計原則)
2. [多人模式（Kahoot 風格）](#二多人模式kahoot-風格)
3. [單人模式](#三單人模式)
4. [多感官設計（聲音與配色系統）](#四多感官設計聲音與配色系統)
5. [技術架構](#五技術架構)
6. [檔案結構規劃](#六檔案結構規劃)
7. [開發時程](#七開發時程)
8. [關鍵設計決策總覽](#八關鍵設計決策總覽)
9. [待辦事項檢查表](#九待辦事項檢查表)
10. [文件版本紀錄](#十文件版本紀錄)
11. [附錄](#十一附錄)

---

## 一、核心設計原則

### 1.1 多感官設計（參考聲音設計文件）

```
✅ 視覺為主（必要），聽覺為輔（增強）
✅ 無聲音 100% 可玩，有聲音體驗更佳
✅ 「多一個感官輸入，多一個理解機會」
```

### 1.2 目標使用者

- **年齡層**：3-6歲學齡前幼兒
- **障礙類別**：聽障學齡前幼兒
- **設計原則**：視覺優先、極簡文字、大圖示

### 1.3 系統流程圖

> 📌 **[流程圖預留區域 - 待製作]**
>
> 預計包含以下流程圖：

| 流程圖名稱 | 說明 | 狀態 |
|---|---|---|
| 多人模式完整流程圖 | 從建立房間到遊戲結束的完整流程 | ⏳ 待製作 |
| 單人模式完整流程圖 | 從場地選擇到成績結算的完整流程 | ⏳ 待製作 |
| 工作記憶測驗流程圖 | 位置記憶→回憶→計分的詳細流程 | ⏳ 待製作 |
| 計分系統流程圖 | 基礎分數+額外獎勵的計算流程 | ⏳ 待製作 |
| Firebase 資料流程圖 | 前端↔後端的資料同步流程 | ⏳ 待製作 |

[🔝 回到目錄](#目錄)

---

## 二、多人模式（Kahoot 風格）

### 2.1 核心特性

| 特性 | 說明 |
|------|------|
| **遊戲性質** | 同場競賽（各自節奏） |
| **題目同步** | 題目順序一致，但進度獨立 |
| **題目切換** | 答題後立即切換（0秒） ⭐ |
| **即時回饋** | 在原畫面疊加綠/紅框（0.3秒） ⭐ |
| **完成通知** | 僅「完成整個場地」時顯示（3秒） ⭐ |
| **場地切換** | 各自按開始 → 各自倒數 → 各自開始 ⭐ |
| **遊戲開始** | 僅最開始需所有玩家一起倒數 ⭐ |
| **工作記憶** | 可選擇開啟，每場地後自動附加 🆕 |

⭐ = v2.0 對話修正的關鍵設計  
🆕 = v3.0 新增

---

### 2.2 房間系統

#### 房間代碼

```
長度：5位字元
格式：英文字母 + 數字（排除 I/O/0/1）
顯示：H7K 2M（加空格分隔）
功能：代碼 = 短網址 ID
範例：https://game.web.app/r/H7K2M
```

#### 房間設定

```
基本設定：
  ✅ 房間名稱（有預設，可修改）
  ✅ 房間代碼（自動生成 / 自訂）
  ✅ 房間密碼（開關式）

遊戲設定：
  ✅ 遊戲場積木式選擇（1-4個場地，A~D）
  ✅ 每場地題數（5-20題）
  ✅ 倒數秒數（2-5秒）

🆕 工作記憶設定：
  ✅ 啟用工作記憶測驗（開關式）
    → 開啟：每個遊戲場結束後，自動進行一次工作記憶測驗
    → 關閉：僅進行選定的遊戲場（預設）
    → 此為全域開關，適用於所有已選遊戲場
    → 記憶數量隨機（1~n 個位置）
    → 順向/逆向隨機指定

進階設定：
  ✅ 顯示即時計分板
  ✅ 顯示答題狀態
  ✅ 顯示場地完成通知
  ✅ 允許中途加入
  ✅ 顯示最終排名
```

---

### 2.3 遊戲場系統（積木式選擇）

#### 可選場地

| 代號 | 名稱 | 圖示 | 難度 | 規則 | 訓練目標 |
|------|------|------|------|------|----------|
| **A** | 起司森林 | 🧀 | 簡單（3-4歲） | 🧀按，😺不按 | 抑制控制 |
| **B** | 人類村莊 | 🧑 | 中等（4-5歲） | 🧑+🧀按，😺不按 | 工作記憶+抑制 |
| **C** | 海洋世界 | 🐟 | 中等（4-5歲） | 🐟按，🦈不按 | 抑制+規則切換 |
| **D** | 晝夜迷宮 | 🌙 | 困難（5-6歲） | 白天晚上規則相反 | 認知彈性+DCCS |
| **E** | 記憶星空 | 🧠 | 變動 | 記住位置順序（順向/逆向隨機） | 工作記憶 |

> **🆕 場地E 特殊說明**
> - **多人模式**：場地E 不在積木式選擇中獨立選取，而是透過「啟用工作記憶測驗」開關控制。開啟後，每完成一個遊戲場（A~D）就自動附加一次工作記憶測驗，作為**每個遊戲場的共同附加環節**。
> - **單人模式**：場地E 可作為獨立場地選擇遊玩（詳見 [3.3 工作記憶計分系統](#33-工作記憶計分系統場地e-🆕)）。

#### 選擇介面

```
┌─────────────────────────────────────┐
│ 📌 已選擇的遊戲場（拖曳排序）       │
│ ┌─────────────────────────────────┐ │
│ │ [🧀 A] [🧑 B]                   │ │
│ │  ↑拖曳排序（由左到右）           │ │
│ │  點擊「✕」可移除                 │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 🎮 點選下方遊戲場加入：             │
│ [🐟 C] [🌙 D]                       │
│  ↑點擊後移至上方                    │
│                                     │
│ 🧠 工作記憶測驗：                    │
│ [━━━━━○] OFF                        │
│  ↑開啟後每場地自動附加              │
└─────────────────────────────────────┘
```

**技術實作**：
- HTML5 Drag & Drop API
- 數量限制：1-4 個遊戲場（A~D）
- 工作記憶為獨立開關（非積木式選擇）
- 房主建立時預先生成所有場地的題目序列

---

### 2.4 題目同步機制 ⭐

#### 核心概念

```
✅ 題目順序同步：所有玩家題目順序一致
✅ 進度獨立：各自答題，互不等待
✅ 立即切換：答題後 0 秒切換下一題
```

#### 題目生成流程

```
房主建立房間
  ↓
選擇遊戲場（例如：A、B）+ 工作記憶開關
  ↓
系統自動生成題目序列：
  場地A：[🧀, 😺, 🧀, 🧀, 😺, ...] 共10題
  場地B：[🧑, 🧀, 😺, 🧑, 🧀, ...] 共10題
  若工作記憶開啟：
    場地A後-WM：{方向:隨機, 長度:隨機1~n}
    場地B後-WM：{方向:隨機, 長度:隨機1~n}
  ↓
儲存到 Firebase：
  gameStages[0].questions[]
  gameStages[0].workingMemoryTest (if enabled)
  gameStages[1].questions[]
  gameStages[1].workingMemoryTest (if enabled)
  ↓
所有玩家讀取相同題目序列
```

#### 遊戲進行範例

```
時間點 T1：
  玩家A：正在答場地A的題目5 (🧀)
  玩家B：正在答場地A的題目2 (😺)
  玩家C：正在答場地A的題目8 (🧀)
  
  → 題目內容相同，但進度獨立

時間點 T2（玩家A答完題目5）：
  玩家A：立即顯示題目6 (😺)
  玩家B：仍在題目2（不受影響）
  玩家C：仍在題目8（不受影響）
```

---

### 2.5 即時回饋設計 ⭐

#### 視覺設計（在原畫面疊加）

**答對範例**：

```
原題目畫面：
┌────────────────────────────┐
│                            │
│        🧀                  │
│     (起司出現)              │
│                            │
└────────────────────────────┘
       ↓ 玩家按空白鍵
┌────────────────────────────┐
│                            │
│        🧀                  │ ← 刺激物保持
│  ┌──────────────────────┐  │
│  │  ✅ 正確！           │  │ ← 疊加綠框
│  │  +1 ⭐ +1 分         │  │
│  └──────────────────────┘  │
└────────────────────────────┘
       ↓ 0.3秒淡出動畫
┌────────────────────────────┐
│                            │
│        😺                  │ ← 下一題刺激物
│     (貓咪出現)              │
│                            │
└────────────────────────────┘
```

**答錯範例**：

```
┌────────────────────────────┐
│                            │
│        😺                  │ ← 刺激物保持
│  ┌──────────────────────┐  │
│  │  ❌ 錯誤！           │  │ ← 疊加紅框
│  └──────────────────────┘  │
└────────────────────────────┘
       ↓ 0.3秒淡出動畫
       ↓ 立即顯示下一題
```

#### 技術細節

```
1. 玩家按下空白鍵（或時間到）
2. 記錄答案到 Firebase
3. 在原畫面上方顯示回饋框（CSS absolute positioning）
4. 播放淡入動畫（0.1秒）
5. 停留（0.1秒）
6. 播放淡出動畫（0.1秒）
7. 移除回饋元素
8. 更新 currentQuestion++
9. 顯示下一題刺激物

總時長：0.3秒
```

#### 樣式設計

```
答對回饋框：
  背景：綠色漸層 (#4CAF50)
  邊框：深綠色 3px solid
  文字：白色、粗體、大字
  圖示：✅ + ⭐
  動畫：scale(0.8 → 1.0) + opacity(0 → 1 → 0)

答錯回饋框：
  背景：紅色漸層 (#F44336)
  邊框：深紅色 3px solid
  文字：白色、粗體、大字
  圖示：❌
  動畫：shake + opacity(0 → 1 → 0)
```

---

### 2.6 完成通知設計 ⭐

#### 觸發時機

```
✅ 僅在「完成整個場地」時觸發
❌ 不在「完成每一題」時觸發

範例：
  玩家完成場地A的第10題（最後一題）
    → Firebase: justCompleted = true
    → 通知：「✅ 小花 完成場地A了！」
    → 3秒後消失
    → Firebase: justCompleted = false
```

#### 顯示位置與樣式

```
位置：畫面右上角（不干擾主視覺）

┌────────────────────────────┐
│ ┌────────────────────┐     │
│ │ ✅ 小花 完成場地A了！│     │ ← 右上角
│ └────────────────────┘     │
│                            │
│        🐟                  │ ← 主視覺不受影響
│     (繼續遊戲)              │
│                            │
└────────────────────────────┘

樣式：
  背景：半透明藍色 (rgba(33, 150, 243, 0.9))
  邊框：圓角 8px
  文字：白色、粗體
  圖示：✅ + 場地圖示 (🧀/🧑/🐟/🌙)
  動畫：
    淡入 (0.5秒)
    → 停留 (3秒)
    → 淡出 (0.5秒)
  總時長：4秒
```

#### 多玩家完成時的堆疊

```
若多位玩家接連完成：

┌────────────────────────────┐
│ ┌────────────────────┐     │
│ │ ✅ 小花 完成場地A了！│ ← 最新
│ └────────────────────┘     │
│ ┌────────────────────┐     │
│ │ ✅ 小明 完成場地A了！│ ← 較舊（往下推）
│ └────────────────────┘     │
│                            │
│        🐟                  │
│                            │
└────────────────────────────┘

最多顯示：3個通知（超過則移除最舊的）
```

---

### 2.7 倒數機制 ⭐

#### 適用範圍

```
✅ 遊戲最開始（場地A開始前）
    → 所有玩家「一起」倒數

✅ 場地切換（場地B/C/D開始前）
    → 各自倒數（不用等彼此）

✅ 工作記憶測驗開始前（若啟用）
    → 各自倒數

❌ 題目之間
    → 無倒數，立即切換
```

#### 倒數時長

```
房主可設定：2-5 秒
預設值：3 秒
```

#### 視覺設計

```
┌────────────────────────────┐
│                            │
│      準備開始！            │
│                            │
│      [3] ← 大數字 120px    │
│                            │
│  🎹 請將手指放在空白鍵上    │
│     ↑ 閃爍動畫              │
│                            │
│  ⏸️ 所有按鈕已鎖定          │
│                            │
│  背景：紅色                │
└────────────────────────────┘
       ↓ 1秒後
┌────────────────────────────┐
│      [2]                   │
│  背景：黃色                │
└────────────────────────────┘
       ↓ 1秒後
┌────────────────────────────┐
│      [1]                   │
│  背景：綠色                │
└────────────────────────────┘
       ↓ 1秒後
┌────────────────────────────┐
│    🚀 開始！               │
│  背景：閃爍白光            │
└────────────────────────────┘
       ↓ 0.5秒後
       題目1出現
```

#### 音效同步

```
數字3：🔊 "滴"（低音）
數字2：🔊 "滴"（中音）
數字1：🔊 "滴"（高音）
開始：🔊 "開始！"（語音）+ 短促音效
```

---

### 2.8 遊戲流程（完整版）⭐🆕

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━
階段 1：遊戲開始（唯一需要一起的時刻）
━━━━━━━━━━━━━━━━━━━━━━━━━━━

所有玩家進入房間
  ↓
房主按「開始遊戲」
  ↓
所有玩家一起看到倒數畫面
  ↓
3... 2... 1... 開始！
  ↓
場地A 題目1 開始

━━━━━━━━━━━━━━━━━━━━━━━━━━━
階段 2：場地內遊戲（各自節奏）
━━━━━━━━━━━━━━━━━━━━━━━━━━━

玩家A：
  題目1 (🧀) → 按空白鍵 → ✅ 正確 +1分（0.3秒）
    → 立即顯示題目2 (😺)
  題目2 (😺) → 沒按 → ✅ 正確 +1分（0.3秒）
    → 立即顯示題目3 (🧀)
  ...
  題目10 → 完成！

玩家B（較慢）：
  題目1 (🧀) → 按空白鍵 → ✅ 正確 +1分（0.3秒）
    → 立即顯示題目2 (😺)
  題目2 (😺) → 按了 → ❌ 錯誤 +0分（0.3秒）
    → 立即顯示題目3 (🧀)
  ...
  （仍在進行中）

玩家C（最快）：
  ...（已完成題目10）
  
→ 所有玩家看到通知：
  「✅ 玩家C 完成場地A了！」（3秒）

━━━━━━━━━━━━━━━━━━━━━━━━━━━
階段 2.5：工作記憶測驗（若啟用）🆕
━━━━━━━━━━━━━━━━━━━━━━━━━━━

（每位玩家完成場地A後，自動進入工作記憶測驗）

玩家C（最快完成場地A）：
  ↓
  系統隨機：逆向 / 位置數量=3
  ↓
  📍 位置依序亮起：位置2 → 位置5 → 位置1
  ↓
  🧠 請以「逆向」順序點選：
  玩家點選：位置1 → 位置5 → 位置2
  ↓
  結果：3/3 全對 → 基礎 3分 + 逆向全對獎勵 +2分 = 5分

（其他玩家各自完成場地A後，也各自進行WM測驗）

━━━━━━━━━━━━━━━━━━━━━━━━━━━
階段 3：場地完成等待
━━━━━━━━━━━━━━━━━━━━━━━━━━━

玩家C（已完成場地A + WM）：
┌────────────────────────────┐
│ 🎉 太棒了！你完成場地A了！  │
│                            │
│ 等待其他玩家完成...        │
│                            │
│ 📊 當前排名：              │
│ 1. 玩家C  15分 ✅          │
│ 2. 玩家A  12分 (8/10)      │
│ 3. 玩家B   9分 (6/10)      │
└────────────────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━
階段 4：場地切換（各自準備）⭐
━━━━━━━━━━━━━━━━━━━━━━━━━━━

所有玩家看到過場畫面：
┌────────────────────────────┐
│ 🎊 場地A 全部完成！        │
│                            │
│ 即將進入：                 │
│ 🧑 場地B：人類村莊         │
│                            │
│ 新規則：                   │
│ 🧑+🧀 按空白鍵             │
│ 😺 不要按                  │
│                            │
│ [🔊 聽規則說明]            │
│ [開始場地B] ← 各自按        │
└────────────────────────────┘

玩家C（準備好了）：
  按下「開始場地B」
    ↓
  進入倒數（僅玩家C看到）
    3... 2... 1... 開始！
    ↓
  場地B 題目1 開始
    ↓
  （完成後若啟用WM → 自動進入WM測驗）

玩家A、B：
  仍在過場畫面
  可隨時按「開始」
  不用等玩家C

━━━━━━━━━━━━━━━━━━━━━━━━━━━
階段 5：重複流程
━━━━━━━━━━━━━━━━━━━━━━━━━━━

場地B、C、D 重複上述流程（含WM測驗，若啟用）
  ↓
所有場地完成
  ↓
最終排名

━━━━━━━━━━━━━━━━━━━━━━━━━━━
階段 6：遊戲結束
━━━━━━━━━━━━━━━━━━━━━━━━━━━

┌────────────────────────────┐
│ 🏆 遊戲結束！              │
│ 最終排名                   │
├────────────────────────────┤
│ 🥇 玩家C  52分  ⭐×35      │
│ 🥈 玩家A  46分  ⭐×32      │
│ 🥉 玩家B  38分  ⭐×28      │
│                            │
│ ─── 輸出選項 ───           │
│ [📸 下載成績截圖]          │
│ [📊 匯出 CSV 檔案]         │
│                            │
│ [回到首頁]                 │
└────────────────────────────┘
```

---

### 2.9 邀請功能

#### 三種邀請方式

```
方法1：掃描 QR Code
  ┌──────────┐
  │ [QR碼]   │
  └──────────┘
  前端生成（qrcode.js）

方法2：分享短網址
  https://game.web.app/r/H7K2M
  [📋 複製連結]
  遊戲結束後連結失效

方法3：告訴朋友代碼
  ┌────────┐
  │ H7K 2M │ ← 大數字顯示
  └────────┘
```

---

### 2.10 成績處理 ⭐🆕

#### 分離儲存（不寫入 Firestore）

```
✅ 所有成績僅在 Realtime Database
✅ 遊戲結束後 1 小時自動刪除
❌ 不寫入個人歷史紀錄（Firestore）
```

#### 輸出功能

**1. 截圖功能**

```
技術：html2canvas
格式：PNG
檔名：遊戲成績_YYYYMMDD_HHMMSS.png

內容：
┌─────────────────────────────────┐
│ 執行功能訓練遊戲 - 遊戲成績      │
│                                 │
│ 房間名稱：王老師的練習房         │
│ 遊戲日期：2026/02/08 14:30      │
│                                 │
│ 🏆 最終排名                     │
│ ────────────────────            │
│ 🥇 小花  52分  ⭐×35  98%      │
│ 🥈 小明  46分  ⭐×32  92%      │
│ 🥉 小美  38分  ⭐×28  87%      │
│                                 │
│ 完成場地：🧀🧑🐟🌙 (+🧠)       │
└─────────────────────────────────┘
```

**2. CSV 匯出**

```
格式：UTF-8 BOM（Excel 可開啟中文）
檔名：多人遊戲成績_YYYYMMDD_HHMMSS.csv

內容（無工作記憶時）：
排名,暱稱,總分,答對數,答對率,場地A,場地B,場地C,場地D,獎勵分,平均反應
1,小花,52,35,98%,10,10,8,7,5,1.5
2,小明,46,32,92%,9,8,8,7,4,1.8

內容（含工作記憶時）：
排名,暱稱,總分,場地A,A-WM,場地B,B-WM,場地C,C-WM,場地D,D-WM,獎勵分,平均反應
1,小花,58,10,5,10,4,8,3,7,3,5,1.5
```

---

### 2.11 Firebase 資料結構（最終版）⭐🆕

```javascript
{
  "rooms": {
    "H7K2M": {
      // ===== 基本資訊 =====
      "roomCode": "H7K2M",
      "roomName": "王老師的練習房",
      "hostId": "user_abc123",
      "hasPassword": true,
      "passwordHash": "hashed_password",
      "createdAt": 1739001600000,
      "expiresAt": 1739005200000, // 1小時後
      "status": "playing", // waiting / playing / finished
      
      // ===== 遊戲開始狀態 =====
      "gameStarted": true,
      "countdownSeconds": 3,
      
      // ===== 🆕 工作記憶設定 =====
      "enableWorkingMemory": true,  // 是否啟用工作記憶測驗
      
      // ===== 遊戲場設定 =====
      "gameStages": [
        {
          "id": "stage_A_1",
          "stageId": "A",
          "type": "cheese_cat",
          "name": "場地A：起司森林",
          "icon": "🧀",
          "difficulty": "easy",
          "order": 1,
          "questionsCount": 10,
          
          // ✅ 題目序列（房主建立時生成）
          "questions": [
            {
              "id": "q1",
              "stimulusType": "cheese",
              "correctAction": "press",
              "dayNight": null
            },
            {
              "id": "q2",
              "stimulusType": "cat",
              "correctAction": "nopress",
              "dayNight": null
            }
            // ... 共10題
          ],
          
          // 🆕 工作記憶測驗（房主建立時生成，若啟用）
          "workingMemoryTest": {
            "direction": "reverse",  // forward / reverse（隨機）
            "sequenceLength": 3,     // 隨機 1~n
            "sequence": [2, 5, 1],   // 位置索引序列
            "maxPositions": 9        // 位置總數（如 3×3 九宮格）
          }
        },
        {
          "id": "stage_B_1",
          "stageId": "B",
          "type": "person_cheese_cat",
          "name": "場地B：人類村莊",
          "icon": "🧑",
          "difficulty": "medium",
          "order": 2,
          "questionsCount": 10,
          "questions": [ /* 10題 */ ],
          "workingMemoryTest": {
            "direction": "forward",
            "sequenceLength": 5,
            "sequence": [3, 7, 1, 8, 4],
            "maxPositions": 9
          }
        }
      ],
      
      // ===== 進階設定 =====
      "displaySettings": {
        "showLeaderboard": true,
        "showAnswerStatus": true,
        "showCompletionNotification": true,
        "allowLateJoin": true,
        "showFinalRanking": true
      },
      
      // ===== 玩家資料 =====
      "players": {
        "user_abc123": {
          "nickname": "小花",
          "isHost": true,
          "online": true,
          "joinedAt": 1739001600000,
          
          // ===== 當前進度 =====
          "currentStageIndex": 0,
          "currentQuestion": 5,
          "completedStages": [],
          
          // ===== 場地狀態 =====
          "stageStatus": {
            "stage_A_1": {
              "started": true,
              "startedAt": 1739001610000,
              "completed": false,
              "completedAt": null,
              "justCompleted": false,
              "score": 4,              // 基礎分數（答對題數）
              "bonusScore": 0,         // 🆕 額外獎勵分數
              
              // 詳細答題記錄
              "answers": [
                {
                  "questionId": "q1",
                  "stimulusType": "cheese",
                  "playerAction": "press",
                  "correct": true,
                  "reactionTime": 1.2,
                  "timestamp": 1739001611000
                }
              ],
              
              // 🆕 工作記憶測驗結果
              "workingMemoryResult": {
                "direction": "reverse",
                "sequenceLength": 3,
                "playerAnswer": [1, 5, 2],
                "correctPositions": 3,
                "isAllCorrect": true,
                "baseScore": 3,         // 答對位置數
                "allCorrectBonus": 2,   // 逆向n=3全對獎勵
                "totalWmScore": 5,
                "reactionTime": 3.2,
                "timestamp": 1739001620000
              }
            }
          },
          
          // ===== 總成績 =====
          "totalScore": 9,       // 場地基礎分 + 獎勵 + WM分
          "totalCorrect": 4,
          "totalQuestions": 4,
          "accuracy": 100
        }
      }
    }
  }
}
```

[🔝 回到目錄](#目錄)

---

## 三、單人模式

### 3.1 核心特性

| 特性 | 說明 |
|------|------|
| **資料儲存** | localStorage（優先）+ Firestore（選擇性） |
| **題目切換** | 答題後立即切換（0秒，與多人模式一致） |
| **即時回饋** | 在原畫面疊加綠/紅框（0.3秒，與多人模式一致） |
| **計分系統** | 答對 +1 分，額外獎勵各 +1 分 🆕 |
| **排行榜** | 本地班級榜 + 全球榜（選擇性上傳） |
| **工作記憶** | 場地E，可獨立選擇遊玩 🆕 |

---

### 3.2 計分系統（v3.0 改版）🆕

#### 計分原則

```
✅ 簡單明確：答對 = +1 分
✅ 額外獎勵：達成條件 = 各 +1 分
✅ 不使用乘法加權
```

#### 基礎計分（適用場地 A~D）

```
每題答對 → +1 分（= +1 顆亮星 ⭐）
每題答錯 → +0 分（不顯示星星）

範例：10 題答對 8 題 → 基礎 8 分
```

#### 額外獎勵（每項各 +1 分）

| 獎勵 | 條件 | 額外分數 |
|------|------|----------|
| 🏆 全對獎勵 | 該場地答對率 100% | +1 分 |
| ⚡ 最佳速度 | 平均反應 < 個人該場地最快紀錄 | +1 分 |
| 📈 進步獎勵 | 總分 > 個人該場地最佳紀錄 | +1 分 |
| 🎯 完美表現 | 連續 5 題答對 | +1 分 |
| 🌟 首次通關 | 首次完成該場地該模式 | +1 分 |

#### 計算範例

```
場地A（10題）：

範例1 - 高手：
  答對：10/10 → 基礎 10 分
  🏆 全對獎勵      +1（答對率 100%）
  ⚡ 最佳速度      +1（平均 1.2 秒 < 歷史最快 1.5 秒）
  📈 進步獎勵      +1（12 分 > 歷史最佳 10 分）
  🎯 完美表現      +1（連續 10 題答對 ≥ 5 題）
  🌟 首次通關      +1（第一次完成）
  ─────────────
  最終得分：15 分

範例2 - 普通：
  答對：7/10 → 基礎 7 分
  🏆 全對獎勵      ✗（未全對）
  ⚡ 最佳速度      +1（比上次快）
  📈 進步獎勵      ✗（未超越紀錄）
  🎯 完美表現      +1（第 1-5 題連續答對）
  🌟 首次通關      ✗（非首次）
  ─────────────
  最終得分：9 分
```

#### 獎勵細節說明

**1. 最佳速度獎勵**

```
條件：平均反應時間 < 個人該場地該模式最快紀錄

紀錄分開：
  場地A 正式模式：最快 1.5 秒
  場地A 挑戰模式：最快 2.0 秒
  場地B 正式模式：最快 1.8 秒
  ...

判斷：
  本次平均 1.2 秒 < 歷史最快 1.5 秒
  → ✅ 獲得最佳速度 +1 分
```

**2. 進步獎勵**

```
條件：最終分數（含其他獎勵）> 該場地個人最佳紀錄

計算順序：
  1. 基礎分數 + 其他獎勵（全對、速度、完美、首次）
  2. 比對歷史最佳紀錄
  3. 若超越 → +1 分
  4. 更新歷史最佳紀錄

避免循環：
  進步獎勵不參與比對，僅在判定後才加上
```

**3. 完美表現獎勵**

```
條件：整場遊戲中有出現連續 5 題答對

範例：
  題目序列：✓✓✓✓✓✗✓✓✓✓
  判斷：前 5 題連續答對 → ✅ 獲得 +1 分

  題目序列：✓✓✗✓✓✓✓✓✓✓
  判斷：第 4-10 題連續答對 → ✅ 獲得 +1 分

不需要：
  從頭到尾無失誤（那是「全對獎勵」）
```

**4. 首次通關獎勵**

```
條件：首次完成該場地該模式

範例：
  首次完成「場地A 正式模式」→ ✅ +1 分
  再次完成「場地A 正式模式」→ ❌ 不獲得
  首次完成「場地A 挑戰模式」→ ✅ +1 分（不同模式）
```

---

### 3.3 工作記憶計分系統（場地E）🆕

#### 遊戲機制

```
1. 系統隨機決定：順向（Forward）或 逆向（Reverse）
2. 系統隨機決定：記憶位置數量（1 ~ n 個）
3. 畫面顯示 n 個位置依序亮起
4. 玩家需按照指定方向（順向/逆向）依序點選
5. 每答對一個位置 → +1 分
6. 全對時 → 依規則給予額外獎勵
```

#### 基礎計分

```
每答對一個位置 → +1 分

範例：
  序列長度 = 4，答對 3 個位置
  → 基礎分數 = 3 分
```

#### 全對額外獎勵（Bonus）

##### 逆向（Reverse）全對獎勵

```
公式：位置數量 n ≥ 2 時，獎勵 = n - 1 分

| 位置數量 (n) | 全對獎勵 | 說明 |
|:---:|:---:|:---|
| 1 | +0（無獎勵） | 僅基礎分 +1 |
| 2 | +1 | 逆向記住 2 個位置 |
| 3 | +2 | 逆向記住 3 個位置 |
| 4 | +3 | 逆向記住 4 個位置 |
| 5 | +4 | 逆向記住 5 個位置 |
| 6 | +5 | 依此類推... |
| n | +(n-1) | 通用公式 |
```

##### 順向（Forward）全對獎勵

```
分段公式：

| 位置數量 (n) | 全對獎勵 | 說明 |
|:---:|:---:|:---|
| 1 | +0（無獎勵） | 僅基礎分 +1 |
| 2~6 | +1 | 基礎順向記憶 |
| 7~9 | +2 | 中等難度 |
| 10 | +3 | 公式：n-7 |
| 11 | +4 | 公式：n-7 |
| 12 | +5 | 公式：n-7 |
| n (n≥10) | +(n-7) | 通用公式 |
```

#### 工作記憶額外獎勵（與場地A~D相同邏輯）

| 獎勵 | 條件 | 額外分數 |
|------|------|----------|
| ⚡ 最佳速度 | 完成速度 < 個人最快紀錄 | +1 分 |

> **備註**：工作記憶場地的額外獎勵僅保留「最佳速度」。全對獎勵已由上方的方向×數量公式涵蓋，不再額外 +1。

#### 計算範例

```
━━━ 範例1：逆向，位置數量=4，全對 ━━━
基礎分：4 分（4/4 位置全對）
全對獎勵：+3 分（逆向 n=4 → n-1=3）
最佳速度：+1 分（比上次快）
─────────
總計：8 分

━━━ 範例2：順向，位置數量=5，全對 ━━━
基礎分：5 分（5/5 位置全對）
全對獎勵：+1 分（順向 n=5 在 2~6 區間 → +1）
最佳速度：+0 分（沒比上次快）
─────────
總計：6 分

━━━ 範例3：順向，位置數量=11，全對 ━━━
基礎分：11 分（11/11 位置全對）
全對獎勵：+4 分（順向 n=11 → n-7=4）
最佳速度：+1 分
─────────
總計：16 分

━━━ 範例4：逆向，位置數量=3，答對2個 ━━━
基礎分：2 分（2/3 位置答對）
全對獎勵：+0 分（未全對，不適用）
最佳速度：+0 分
─────────
總計：2 分

━━━ 範例5：順向或逆向，位置數量=1，全對 ━━━
基礎分：1 分（1/1 位置答對）
全對獎勵：+0 分（n=1 時無獎勵）
─────────
總計：1 分
```

#### 工作記憶顯示介面

```
┌────────────────────────────┐
│ 🧠 工作記憶測驗             │
├────────────────────────────┤
│                            │
│ 方向：逆向（Reverse）🔄    │
│ 位置數量：4 個              │
│                            │
│  ┌───┬───┬───┐             │
│  │   │ 2 │   │ ← 九宮格   │
│  ├───┼───┼───┤   位置亮起  │
│  │ 4 │   │ 3 │   順序顯示  │
│  ├───┼───┼───┤             │
│  │   │ 1 │   │             │
│  └───┴───┴───┘             │
│                            │
│ 🔔 請以「逆向」順序點選！   │
│                            │
└────────────────────────────┘
       ↓ 玩家依序點選
┌────────────────────────────┐
│ 🎉 工作記憶測驗完成！       │
├────────────────────────────┤
│ 答對位置：4 / 4 ✓           │
│ 完成速度：3.2 秒            │
│                            │
│ ─── 分數計算 ───           │
│ 基礎分數：4 分              │
│ 🏆 逆向全對獎勵：+3 分      │
│ ⚡ 最佳速度：+1 分          │
│ ════════════════           │
│ 工作記憶得分：8 分 🎊       │
│                            │
│ [繼續下一場地]              │
└────────────────────────────┘
```

#### 在多人模式中的運作方式

```
✅ 房主開啟「啟用工作記憶測驗」開關
✅ 每個遊戲場（A~D）完成後，自動附加一次 WM 測驗
✅ 全域規則：所有遊戲場統一適用，無法針對單一場地開關
✅ WM 分數加入該遊戲場的分數中
✅ 每次 WM 測驗的順向/逆向、位置數量皆為隨機
✅ 所有玩家的 WM 測驗題目相同（與主題目一樣預先生成）
```

---

### 3.4 成績顯示介面（v3.0 改版）🆕

```
┌────────────────────────────┐
│ 🎉 場地A完成！             │
├────────────────────────────┤
│ 答對題數：10 / 10 ✓        │
│ 平均反應：1.2 秒           │
│ 連續答對：10 題（最長）    │
│ 獲得星星：⭐ × 10          │
│                            │
│ ─── 分數計算 ───           │
│ 基礎分數：10 分            │
│                            │
│ 🎁 額外獎勵：              │
│ 🏆 全對獎勵      +1 分     │
│ ⚡ 最佳速度      +1 分     │
│    💬 比上次快 0.3 秒！     │
│ 📈 進步獎勵      +1 分     │
│    💬 超越紀錄 1 分！       │
│ 🎯 完美表現      +1 分     │
│    💬 連續 10 題答對！      │
│ 🌟 首次通關      +1 分     │
│    💬 第一次完成此場地！    │
│                            │
│ ════════════════           │
│ 場地得分：15 分 🎊         │
│                            │
│ 💡 個人最佳紀錄已更新！    │
│                            │
│ [繼續下一場地]             │
└────────────────────────────┘
```

**若無獲得任何獎勵**：

```
┌────────────────────────────┐
│ 🎉 場地A完成！             │
├────────────────────────────┤
│ 答對題數：7 / 10           │
│ 獲得星星：⭐ × 7           │
│                            │
│ ─── 分數計算 ───           │
│ 基礎分數：7 分             │
│                            │
│ 💬 繼續加油！              │
│    再試試看能否全對獲得獎勵 │
│                            │
│ [重新挑戰] [下一場地]      │
└────────────────────────────┘
```

---

### 3.5 排行榜系統（雙軌制）

#### 本地班級排行榜（localStorage）

```
完全離線，隱私安全

功能：
✅ 教師建立多個班級
✅ 學生選擇班級後，分數儲存至該班級
✅ 匯出班級資料（JSON / CSV）
✅ 匯入班級資料（還原備份）

介面：
┌──────────────────────────────┐
│       📚 班級管理            │
├──────────────────────────────┤
│ 📁 A001: 快樂幼兒園小班      │
│    學生數：25 人             │
│    [查看排行] [匯出] [刪除]  │
│                              │
│ 📁 B002: 陽光幼兒園中班      │
│    學生數：30 人             │
│    [查看排行] [匯出] [刪除]  │
│                              │
│ [➕ 新增班級]               │
│ [📥 匯入班級資料]           │
└──────────────────────────────┘
```

#### 全球排行榜（Firestore，選擇性）

**上傳控制**：

```
預設：關閉（不自動上傳）

設定頁面：
┌──────────────────────────────┐
│       ⚙️ 設定                │
├──────────────────────────────┤
│ 排行榜設定                   │
│                              │
│ 上傳到全球排行榜             │
│ [━━━━━○] OFF ← 開關         │
│                              │
│ 說明：                       │
│ • 關閉：僅儲存在本地班級     │
│ • 開啟：自動上傳到全球排行榜 │
│ • 僅個人可選擇，教師端不可   │
│                              │
│ [儲存設定]                   │
└──────────────────────────────┘

遊戲結束提示：
┌──────────────────────────────┐
│ ✅ 遊戲完成！                │
├──────────────────────────────┤
│ 你的成績：15分  ⭐×10        │
│ 已儲存到本地班級排行榜 ✓     │
│                              │
│ ─────────────────────        │
│ 上傳到全球排行榜？           │
│                              │
│ 目前設定：[━━━━━○] OFF      │
│                              │
│ [開啟並上傳] [保持關閉]      │
│ ☐ 記住我的選擇               │
└──────────────────────────────┘
```

**隱私保護**：

```
✅ 全球排行榜不顯示班級代碼
✅ 僅顯示暱稱 + 分數
✅ 個人可選擇上傳
❌ 教師端不可上傳全班資料
```

---

### 3.6 徽章系統（16個）🆕

#### 基礎徽章（5個）🆕

| 徽章 | 名稱 | 條件 |
|------|------|------|
| 🧀🏆 | 起司王 | 完成場地A |
| 🧑🎖️ | 村莊探險家 | 完成場地B |
| 🐟🌊 | 海洋冒險者 | 完成場地C |
| 🌙👑 | 晝夜大師 | 完成場地D |
| 🧠💫 | 記憶達人 | 完成場地E（工作記憶）🆕 |

#### 進階徽章（6個）

| 徽章 | 名稱 | 條件 |
|------|------|------|
| 🧠⭐ | 記憶之星 | 場地B答對≥8題 |
| 🎯✨ | 彈性天才 | 場地C答對≥8題 |
| ⚡👑 | 速度之王 | 平均反應<2秒 |
| 💯🏅 | 完美主義者 | 任一場地全對 |
| 🔥💪 | 連勝高手 | 連續5題答對 |
| 📈🚀 | 進步之星 | 總分超越個人最佳紀錄 |

#### 隱藏徽章（5個）

| 徽章 | 名稱 | 條件 | 提示 |
|------|------|------|------|
| 🎂🎉 | 生日快樂 | 生日當天遊玩 | ??? |
| 🌟🌈 | 七彩收藏家 | 獲得7個不同徽章 | 收集更多徽章... |
| 🦸‍♂️⚔️ | 不屈勇士 | 失敗後立刻重試並通過 | 跌倒了要... |
| 🌅☀️ | 早起鳥兒 | 上午8點前遊玩 | 早起的鳥兒... |
| 🎮🕹️ | 遊戲達人 | 累積遊玩10次 | 持續練習... |

---

### 3.7 等級系統

```
Level 1 (0-10星)   → 🥚 蛋寶寶
Level 2 (11-20星)  → 🐣 破殼雞
Level 3 (21-40星)  → 🐥 小雞仔
Level 4 (41-60星)  → 🐓 雞大王
Level 5 (61+星)    → 🦅 金鷹王者

顯示介面：
┌────────────────────────────┐
│   你的成長階段               │
│                            │
│        🐣                  │
│     破殼雞                  │
│                            │
│  累積星星：15 顆            │
│                            │
│  [▓▓▓▓▓▓░░░░]             │
│  距離下一階段：還差 6 顆星  │
└────────────────────────────┘
```

---

### 3.8 關卡系統

```
每個場地（A/B/C/D）：
  ├─ 正式模式（10題）
  └─ 挑戰模式（15題，需解鎖）

場地E（工作記憶）：
  ├─ 練習模式（固定順向，短序列）
  └─ 正式模式（隨機順向/逆向，隨機 1~n 序列）

解鎖機制：
  ✅ 場地依序解鎖（完成A才能玩B）
  ✅ 場地E：完成場地A後即解鎖
  ✅ 挑戰模式：正式模式達標後解鎖
  ✅ 教師用 ?unlock=all 解鎖全部

重試機制：
  ✅ 無限免費重試
  ✅ 可重複挑戰刷新紀錄
```

[🔝 回到目錄](#目錄)

---

## 四、多感官設計（聲音與配色系統）

**本章整合《聲音設計》與《配色系統完整文檔》**

### 4.1 聲音系統核心原則

```
✅ 「多一個感官輸入，多一個理解機會」
✅ 視覺為主（必要），聽覺為輔（增強）
✅ 無聲音 100% 可玩，有聲音體驗更佳
```

### 4.2 聲音應用場景

```
1. 語音指導：規則說明
2. 即時回饋音效：答對/答錯/徽章/升級
3. 背景音樂：各場地主題
4. 刺激音效：題目出現提示
5. 倒數音效：3-2-1-開始
6. 工作記憶音效：位置亮起提示音、回答正確/錯誤音 🆕
```

### 4.3 音效開關

```
分類控制：
  [━━━●━] 語音指導
  [━━━●━] 回饋音效
  [━━━●━] 背景音樂
  [━━━●━] 刺激音效

快速切換：
  🔊 / 🔇（右上角）
```

---

### 4.4 配色系統

> **本節整合自《配色系統完整文檔》，所有色彩定義皆於此處統一管理。**

#### 4.4.1 核心設計理念

**視覺優先原則**
- 利用聽障學生的視覺處理優勢
- 色彩作為主要的資訊傳遞管道
- 每個遊戲場有獨立的色彩識別系統

**認知負荷考量**
- 高對比度（深色背景+明亮前景）
- 色彩語意清晰（成功=綠、錯誤=紅、警示=黃）
- 避免過度複雜的漸層或圖案

**可及性設計**
- 符合 WCAG 2.1 AA 級對比度標準
- 考量色盲友善（不僅依賴顏色，也有形狀/文字/邊框輔助）
- 跨裝置顯示一致性

#### 4.4.2 完整配色表（CSS 變數定義）

```css
:root {
    /* === 背景與文字 === */
    --bg-dark: #1a2332;           /* 深藍灰背景（主要背景色） */
    --text-white: #FFFFFF;        /* 純白文字（主要文字色） */
    --text-light: #ecf0f1;        /* 淺灰文字（次要文字、說明） */
    
    /* === 功能色彩 === */
    --primary-blue: #3498db;      /* 主要藍色（標題、強調） */
    --success-green: #2ecc71;     /* 成功綠色（正確回饋） */
    --error-red: #e74c3c;         /* 錯誤紅色（錯誤回饋） */
    --accent-yellow: #FFD700;     /* 強調黃色（高亮、重點標記） */
    
    /* === 遊戲場主題色 === */
    --round1-orange: #e67e22;     /* 遊戲場A 橘色（起司森林） */
    --round2-red: #e74c3c;        /* 遊戲場B 紅色（人類村莊） */
    --round3-purple: #9b59b6;     /* 遊戲場C 紫色（海洋世界） */
    --round4-navy: #34495e;       /* 遊戲場D 深藍（晝夜迷宮） */
    --round5-indigo: #5c6bc0;     /* 遊戲場E 靛藍（記憶星空）🆕 */
    
    /* === 特殊功能色 === */
    --practice-teal: #1abc9c;     /* 青綠色（練習模式） */
    --person-border: #ff6b6b;     /* 粉紅色（人物出現邊框） */
    --night-border: #f39c12;      /* 橙黃色（晚上場景邊框） */
    --game-area-bg: #34495e;      /* 深灰藍（遊戲區域背景） */
}
```

> **CSS 變數名稱說明**：變數名稱保留 `round1~round5` 格式以維持向下相容，
> 文件與介面中統一使用「遊戲場A~E」術語。

#### 4.4.3 配色應用規則

**背景色系統**

| 用途 | 色碼 | CSS 變數 | 使用情境 |
|------|------|----------|----------|
| 主背景 | `#1a2332` | `--bg-dark` | 整體網頁背景、投影片背景 |
| 遊戲區域背景 | `#34495e` | `--game-area-bg` | 刺激物顯示區域、內容框 |
| 半透明遮罩 | `rgba(255,255,255,0.05)` | - | 卡片背景、浮動框 |

**文字色系統**

| 用途 | 色碼 | CSS 變數 | 字重 | 使用情境 |
|------|------|----------|------|----------|
| 主要文字 | `#FFFFFF` | `--text-white` | bold | 標題、重點內容 |
| 次要文字 | `#ecf0f1` | `--text-light` | normal | 說明文字、註腳 |
| 強調文字 | `#FFD700` | `--accent-yellow` | bold | 關鍵術語、重點標記 |

**功能色系統（回饋機制）**

| 功能 | 色碼 | CSS 變數 | 使用情境 | 視覺呈現 |
|------|------|----------|----------|----------|
| ✅ 正確 | `#2ecc71` | `--success-green` | 正確回饋、成功訊息 | 綠色邊框+叮聲 |
| ❌ 錯誤 | `#e74c3c` | `--error-red` | 錯誤回饋、警告訊息 | 紅色邊框+噗聲 |
| ⚠️ 警示 | `#FFD700` | `--accent-yellow` | 提示訊息、注意事項 | 黃色邊框 |
| ℹ️ 資訊 | `#3498db` | `--primary-blue` | 一般資訊、標題 | 藍色標題列 |

#### 4.4.4 遊戲場主題色系統 ⭐

##### 遊戲場A：起司森林（Go/No-Go）

```css
/* 主題色：橘色 */
--round1-orange: #e67e22;

.round1 {
    background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
    border: 4px solid var(--round1-orange);
}
/* 刺激物：起司 🧀 (Go) / 貓咪 🐱 (No-Go) */
```

**色彩心理學**：橘色代表溫暖、友善，適合作為第一個遊戲場吸引學生注意力。

##### 遊戲場B：人類村莊（DCCS 標準版）

```css
/* 主題色：紅色 */
--round2-red: #e74c3c;
--person-border: #ff6b6b;

.round2 {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
}
.person-present {
    border: 6px solid var(--person-border);
    box-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
}
/* 刺激物：起司 🧀 / 貓咪 🐱 + 人物 👤 (情境線索) */
```

**色彩心理學**：紅色代表警示、轉換，提醒學生規則已改變。

##### 遊戲場C：海洋世界（場景轉換）

```css
/* 主題色：紫色 */
--round3-purple: #9b59b6;

.round3 {
    background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
    border: 4px solid var(--round3-purple);
}
/* 刺激物：魚 🐟 (Go) / 鯊魚 🦈 (No-Go) */
```

**色彩心理學**：紫色代表神秘、深海，與海洋主題相呼應。

##### 遊戲場D：晝夜迷宮（DCCS 進階版）

```css
/* 主題色：深藍灰 */
--round4-navy: #34495e;
--night-border: #f39c12;

.day-scene {
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    border: 4px solid var(--primary-blue);
}
.night-scene {
    background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
    border: 6px solid var(--night-border);
    box-shadow: 0 0 30px rgba(243, 156, 18, 0.4);
}
.day-scene::before { content: '☀️'; }
.night-scene::before { content: '🌙'; }
/* 刺激物：魚 🐟 / 鯊魚 🦈 + 白天 ☀️ / 晚上 🌙 */
```

**色彩心理學**：深藍代表夜晚寧靜，橙黃邊框強化晚上情境的辨識度。

##### 遊戲場E：記憶星空（工作記憶）🆕

```css
/* 主題色：靛藍 */
--round5-indigo: #5c6bc0;

.round5 {
    background: linear-gradient(135deg, #5c6bc0 0%, #3f51b5 100%);
    border: 4px solid var(--round5-indigo);
}
.wm-position-highlight {
    background: var(--accent-yellow);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
    animation: pulse-glow 0.8s ease;
}
/* 刺激物：位置亮起 💡 → 玩家回憶點選 */
```

**色彩心理學**：靛藍代表專注、深思，與記憶訓練的認知需求相呼應。

#### 4.4.5 配色對照表（快速參考）

**遊戲場識別色**

| 遊戲場 | 場景 | 主題色 | 色碼 | Emoji |
|--------|------|--------|------|-------|
| A | 起司森林 | 橘色 | `#e67e22` | 🧀🐱 |
| B | 人類村莊 | 紅色 | `#e74c3c` | 👤 |
| C | 海洋世界 | 紫色 | `#9b59b6` | 🐟🦈 |
| D | 晝夜迷宮 | 深藍灰 | `#34495e` | ☀️🌙 |
| E | 記憶星空 | 靛藍 | `#5c6bc0` | 🧠💡 |

**功能識別色**

| 功能 | 色碼 | 用途 |
|------|------|------|
| ✅ 正確 | `#2ecc71` | 綠色邊框 |
| ❌ 錯誤 | `#e74c3c` | 紅色邊框 |
| ⚠️ 練習 | `#1abc9c` | 青綠色主題 |
| 📊 標題 | `#3498db` | 藍色標題 |
| ⭐ 強調 | `#FFD700` | 黃色高亮 |

#### 4.4.6 技術實作範例

**正確/錯誤回饋動畫**

```css
.correct-feedback {
    border: 6px solid var(--success-green);
    animation: pulse-green 0.5s ease;
    box-shadow: 0 0 30px rgba(46, 204, 113, 0.6);
}
@keyframes pulse-green {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.incorrect-feedback {
    border: 6px solid var(--error-red);
    animation: shake-red 0.5s ease;
    box-shadow: 0 0 30px rgba(231, 76, 60, 0.6);
}
@keyframes shake-red {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    75% { transform: translateX(10px); }
}
```

**邊框顏色條件判斷**

```javascript
function updateBorderColor(hasPerson, isNightTime) {
    const gameArea = document.getElementById('game-area');
    
    if (hasPerson) {
        gameArea.style.border = '6px solid var(--person-border)';
        gameArea.style.boxShadow = '0 0 20px rgba(255, 107, 107, 0.5)';
    } else if (isNightTime) {
        gameArea.style.border = '6px solid var(--night-border)';
        gameArea.style.boxShadow = '0 0 30px rgba(243, 156, 18, 0.4)';
    } else {
        gameArea.style.border = '4px solid var(--current-round-color)';
        gameArea.style.boxShadow = 'none';
    }
}
```

#### 4.4.7 對比度檢查表（WCAG 2.1 AA 級）

**文字對比度**

| 組合 | 對比度 | 是否通過 |
|------|--------|----------|
| 白色文字 + 深藍灰背景 | 12.63:1 | ✅ AAA 級 |
| 淺灰文字 + 深藍灰背景 | 10.42:1 | ✅ AAA 級 |
| 黃色強調 + 深藍灰背景 | 10.89:1 | ✅ AAA 級 |

**元件對比度**

| 組合 | 對比度 | 是否通過 |
|------|--------|----------|
| 綠色邊框 + 深藍灰背景 | 4.89:1 | ✅ AA 級 |
| 紅色邊框 + 深藍灰背景 | 4.12:1 | ✅ AA 級 |
| 橘色邊框 + 深藍灰背景 | 4.25:1 | ✅ AA 級 |
| 靛藍邊框 + 深藍灰背景 | 3.5:1 | ⚠️ 需加粗邊框 |

#### 4.4.8 簡報與遊戲配色對應

| 簡報元素 | 遊戲元素 | 色碼 |
|----------|----------|------|
| 投影片背景 | 網頁背景 | `#1a2332` |
| 投影片標題 | 頁面標題 | `#3498db` |
| 遊戲場A截圖 | 遊戲場A遊戲 | `#e67e22` |
| 遊戲場B截圖 | 遊戲場B遊戲 | `#e74c3c` |
| 遊戲場C截圖 | 遊戲場C遊戲 | `#9b59b6` |
| 遊戲場D截圖 | 遊戲場D遊戲 | `#34495e` |
| 遊戲場E截圖 | 遊戲場E遊戲 | `#5c6bc0` |
| 正確回饋框 | 正確動畫 | `#2ecc71` |
| 錯誤回饋框 | 錯誤動畫 | `#e74c3c` |
| 強調文字 | 重點提示 | `#FFD700` |

#### 4.4.9 配色更新流程

```
步驟1：確認修改原因
  □ 使用者測試回饋（色彩不夠明顯）
  □ 無障礙檢測問題（對比度不足）
  □ 新增功能需求
  □ 視覺識別優化

步驟2：修改 CSS 變數（:root 區塊）
步驟3：同步更新簡報
步驟4：更新本文檔配色表
步驟5：版本控制 git commit
```

#### 4.4.10 配色快速參考（列印用）

```
=== 遊戲場主題色 ===
A 🧀🐱 橘色 #e67e22
B 👤   紅色 #e74c3c
C 🐟🦈 紫色 #9b59b6
D ☀️🌙 深藍 #34495e
E 🧠💡 靛藍 #5c6bc0

=== 功能色 ===
✅ 正確 #2ecc71
❌ 錯誤 #e74c3c
⚠️ 練習 #1abc9c
📊 標題 #3498db
⭐ 強調 #FFD700

=== 基礎色 ===
背景 #1a2332
文字 #FFFFFF
次要 #ecf0f1
```

[🔝 回到目錄](#目錄)

---

## 五、技術架構

### 5.1 前端技術

```
✅ HTML5 + CSS3 + Vanilla JavaScript
✅ HTML5 Drag & Drop API（積木式選擇）
✅ Web Audio API（聲音系統）
✅ html2canvas（截圖功能）
✅ qrcode.js（QR Code 生成）
```

### 5.2 後端服務（Firebase）

```
✅ Realtime Database（多人即時同步）
✅ Firestore（單人成績儲存，選擇性）
✅ Authentication（匿名登入）
✅ Hosting（部署）
✅ Storage（音效檔案）
```

### 5.3 資料儲存層次

```
Layer 1: localStorage（本地，永遠優先）
  ├─ 玩家設定（暱稱、偏好）
  ├─ 本地班級排行榜
  ├─ 徽章收藏
  ├─ 關卡進度
  ├─ 等級資訊
  └─ 聲音設定

Layer 2: Realtime Database（多人即時）
  └─ 房間資料（遊戲結束後1小時刪除）

Layer 3: Firestore（選擇性，全球排行榜）
  └─ 分數資料（使用者主動上傳時）
```

---

### 5.4 命名規範（摘要版）

> 📎 **完整版**：[NAMING-CONVENTION.md](NAMING-CONVENTION.md)（6,100 行）

#### 核心規範總覽

| 項目 | 規範 | 範例 |
|------|------|------|
| 檔案名稱 | kebab-case | `firebase-config.js`, `room-manager.js` |
| 變數 | camelCase | `roomCode`, `userName`, `isActive` |
| 布林變數 | is/has/can/should 前綴 | `isActive`, `hasPassword`, `canJoin` |
| 函式 | camelCase + 動詞開頭 | `generateCode()`, `updatePlayer()` |
| 類別 | PascalCase | `RoomManager`, `GameController` |
| 常數 | UPPER_SNAKE_CASE | `MAX_PLAYERS`, `ROOM_EXPIRY_TIME` |
| 全域物件 | PascalCase | `window.RoomManager` |
| 事件名稱 | 名詞:過去式 | `'room:updated'`, `'player:joined'` |
| Firebase 路徑 | camelCase + 複數 | `rooms/`, `players/` |
| Git Commit | Conventional | `feat:`, `fix:`, `docs:` |

#### 三條黃金規則

1. **檔案用 kebab**：`room-manager.js` ✅ ｜ `RoomManager.js` ❌
2. **變數用 camel**：`roomCode` ✅ ｜ `room_code` ❌
3. **函式加註解**：必須有 `@returns`，即使是 `{void}`

#### 最常見的 3 個錯誤

```javascript
// ❌ 錯誤 1：魔法值
expires: Date.now() + 3600000;
// ✅ 正確
const ROOM_EXPIRY_TIME = 3600000;
expires: Date.now() + ROOM_EXPIRY_TIME;

// ❌ 錯誤 2：布林變數缺前綴
let active = true;
// ✅ 正確
let isActive = true;

// ❌ 錯誤 3：缺少 @returns
function getData() { return data; }
// ✅ 正確
/** @returns {Object} 資料物件 */
function getData() { return data; }
```

#### ⛔ 禁用清單

| ❌ 禁止 | ✅ 正確 | 原因 |
|---------|---------|------|
| `3600000` | `ROOM_EXPIRY_TIME` | 禁止魔法值 |
| `let active = true` | `let isActive = true` | 布林需前綴 |
| `catch (e)` | `catch (error)` | 錯誤變數全名 |
| `let playerList = []` | `let players = []` | 陣列用複數 |

---

### 5.5 程式除錯指南（摘要版）

> 📎 **完整版**：[程式除錯完整指南.md](程式除錯完整指南.md)（4,049 行）

#### 除錯方法速查表

| 方法 | 用途 | 適合場景 | 學習成本 |
|------|------|----------|----------|
| `console.log()` | 基本輸出 | 快速驗證變數值 | ⭐ |
| `console.error()` | 錯誤訊息（紅色） | API 失敗、驗證錯誤 | ⭐ |
| `console.warn()` | 警告訊息（黃色） | 效能問題、過時 API | ⭐ |
| `console.table()` | 表格顯示 | 陣列/物件資料 | ⭐⭐ |
| `console.group()` | 群組顯示 | 多步驟流程 | ⭐⭐ |
| `console.time()` | 計時 | 效能測量 | ⭐⭐ |
| `console.count()` | 計次 | 事件重複觸發 | ⭐ |
| `debugger` | 暫停執行 | 複雜邏輯除錯 | ⭐⭐⭐ |
| Visual Debug | 畫面顯示 | 遊戲開發即時監控 | ⭐⭐⭐ |

#### DCCS 遊戲專用除錯策略

```javascript
// 1. 遊戲狀態追蹤
console.group('🎮 遊戲狀態');
console.log('當前場地:', currentStage);
console.log('當前題號:', currentQuestion);
console.log('玩家分數:', score);
console.groupEnd();

// 2. Firebase 同步追蹤
console.time('Firebase 資料載入');
await firebase.database().ref('rooms').once('value');
console.timeEnd('Firebase 資料載入');

// 3. 事件重複觸發偵測
function handleKeyPress(e) {
    console.count('按鍵事件');
    // ...
}

// 4. 條件式除錯（僅異常時觸發）
if (score < 0) {
    debugger; // 分數不應為負
}
```

#### 除錯核心思維

```
1. 重現問題 → 2. 縮小範圍 → 3. 提出假設 → 4. 驗證假設 → 5. 修復
```

[🔝 回到目錄](#目錄)

---

## 六、檔案結構規劃

```
project/
├── index.html                      # 起始頁面（模式選擇）
├── multiplayer/
│   ├── room-create.html           # 建立房間
│   ├── room-join.html             # 加入房間
│   ├── waiting-room.html          # 等待室
│   ├── game.html                  # 遊戲進行
│   ├── stage-transition.html     # 場地切換過場
│   └── result.html                # 成績結果
├── singleplayer/
│   ├── stage-select.html          # 場地選擇（含場地E）
│   ├── game.html                  # 遊戲進行
│   ├── working-memory.html        # 🆕 工作記憶測驗
│   ├── result.html                # 成績結果
│   └── badges.html                # 徽章收藏
├── leaderboard/
│   ├── class.html                 # 班級排行榜
│   └── global.html                # 全球排行榜
├── management/
│   └── class-admin.html           # 班級管理
│
├── js/
│   ├── firebase-config.js         # Firebase 設定
│   ├── utils/
│   │   ├── room-code.js          # 房間代碼處理
│   │   ├── score-calculator.js   # 🆕 分數計算（取代 bonus-calculator）
│   │   ├── wm-score-calculator.js # 🆕 工作記憶分數計算
│   │   ├── storage.js            # localStorage 封裝
│   │   ├── export.js             # 截圖 & CSV 匯出
│   │   └── question-generator.js # 題目序列生成
│   ├── multiplayer/
│   │   ├── room-manager.js       # 房間管理
│   │   ├── game-sync.js          # 即時同步
│   │   ├── countdown.js          # 倒數機制
│   │   ├── feedback-overlay.js   # 即時回饋疊加
│   │   └── completion-notify.js  # 完成通知
│   ├── singleplayer/
│   │   ├── game-logic.js         # 遊戲邏輯
│   │   ├── progress-tracker.js   # 進度追蹤
│   │   └── working-memory.js     # 🆕 工作記憶邏輯
│   ├── stages/
│   │   ├── stage-A.js            # 場地 A 邏輯
│   │   ├── stage-B.js
│   │   ├── stage-C.js
│   │   ├── stage-D.js
│   │   └── stage-E.js            # 🆕 場地 E 邏輯（工作記憶）
│   └── sound/
│       └── sound-manager.js      # 聲音系統
│
├── css/
│   ├── main.css                  # 主樣式
│   ├── components/
│   │   ├── countdown.css         # 倒數動畫
│   │   ├── stage-selector.css    # 積木式選擇器
│   │   ├── feedback-overlay.css  # 即時回饋疊加
│   │   ├── completion-notify.css # 完成通知
│   │   ├── score-display.css     # 🆕 成績顯示（取代 bonus-display）
│   │   ├── working-memory.css    # 🆕 工作記憶介面
│   │   └── toggle-switch.css     # 開關按鈕
│   └── themes/
│       └── stages.css            # 各場地主題（含場地E）
│
├── audio/（參考聲音設計文件）
│   ├── guide/                    # 語音指導
│   ├── feedback/                 # 即時回饋音效
│   ├── bgmusic/                  # 背景音樂
│   ├── stimuli/                  # 刺激音效
│   └── ui/                       # UI音效（含倒數）
│
└── firebase.json                 # Firebase 設定
```

[🔝 回到目錄](#目錄)

---

## 七、開發時程

> ⚠️ 原定時程已過（2026/02/08-09），以下為實際開發參考。

### 核心開發任務

```
階段 1：Firebase 建立與基礎設定
  ✅ Firebase 專案建立
  ✅ Realtime Database 規則設定
  ✅ 匿名登入啟用

階段 2：房間建立系統
  ✅ 房間代碼生成
  ✅ 積木式遊戲場選擇介面
  ✅ 題目序列生成（房主建立時）
  ✅ 倒數秒數設定
  🆕 工作記憶開關

階段 3：房間加入與等待室
  ✅ 房間代碼輸入與驗證
  ✅ 密碼驗證
  ✅ QR Code 生成
  ✅ 等待室玩家列表

階段 4：遊戲進行核心
  ✅ 題目顯示（讀取序列）
  ✅ 即時回饋疊加（0.3秒動畫）
  ✅ 立即切換下一題
  ✅ 個人進度追蹤
  🆕 工作記憶測驗環節

階段 5：場地完成與通知
  ✅ 完成場地判定
  ✅ 完成通知顯示（3秒）
  ✅ 等待其他玩家畫面
  🆕 WM 測驗完成後進入等待

階段 6：成績與輸出
  ✅ 最終排名顯示
  ✅ 截圖功能（html2canvas）
  ✅ CSV 匯出
  🆕 WM 分數整合

階段 7：單人模式
  ✅ 計分系統（v3.0 +1 分制）
  ✅ 本地班級排行榜
  ✅ 成績顯示介面
  🆕 場地E 工作記憶獨立遊玩
```

[🔝 回到目錄](#目錄)

---

## 八、關鍵設計決策總覽

### 8.1 v2.0 核心設計 ⭐

| 項目 | 決策 | 理由 |
|------|------|------|
| **題目切換** | 立即（0秒） | 提升遊戲節奏，減少等待 |
| **即時回饋** | 原畫面疊加（0.3秒） | 減少畫面切換感，更流暢 |
| **完成通知** | 僅場地完成時 | 避免過於頻繁，保持專注 |
| **題目同步** | 順序一致，進度獨立 | 公平競賽，各自節奏 |
| **場地切換** | 各自開始 | 尊重個人準備時間 |
| **遊戲開始** | 僅首次一起倒數 | 儀式感 + 公平起跑 |

### 8.2 v3.0 新增設計 🆕

| 項目 | 決策 | 理由 |
|------|------|------|
| **計分系統** | 答對 +1，獎勵各 +1 | 簡化計算，幼兒可理解 |
| **工作記憶** | 新增場地E | 擴充訓練面向 |
| **WM 方向** | 順向/逆向隨機 | 增加變化性 |
| **WM 數量** | 隨機 1~n | 適性難度 |
| **WM 多人模式** | 全域開關，附屬每場地 | 統一規則，簡化操作 |
| **配色系統** | 整合入需求文件 | 集中管理，減少文件散落 |

### 8.3 所有設計決策總覽

| 項目 | 決策 | 理由 |
|------|------|------|
| 年齡層 | 3-6歲學齡前 | 口試委員建議 |
| 模式優先順序 | 多人→單人 | 使用者指定 |
| 場地概念 | 「遊戲場」A~E | 彈性、直覺 |
| 遊戲場選擇 | 積木式拖曳 | 符合幼教直覺操作 |
| 房間代碼 | 5位英數字 | 代碼=短網址ID |
| 班級排行榜 | 本地單機版 | 隱私+離線 |
| 全球排行榜 | 開關式選擇 | 使用者自主 |
| 暗星顯示 | 不顯示 | 減少挫折感 |
| 徽章數量 | 16個 | 混合難度（含WM徽章） |
| 重試機制 | 無限免費 | 鼓勵練習 |

[🔝 回到目錄](#目錄)

---

## 九、待辦事項檢查表

### ✅ 需求確認（已完成）

- [x] 年齡層確認（3-6歲）
- [x] 遊戲模式（多人優先）
- [x] 題目切換機制（立即切換）
- [x] 即時回饋設計（原畫面疊加）
- [x] 完成通知時機（場地完成時）
- [x] 題目同步方式（順序一致，進度獨立）
- [x] 場地切換流程（各自開始）
- [x] 倒數機制（首次一起，之後各自）
- [x] 計分系統改版（+1 分制）🆕
- [x] 工作記憶場地E 設計 🆕
- [x] 排行榜雙軌制（本地+全球）
- [x] 配色系統整合 🆕
- [x] 命名規範摘要整合 🆕
- [x] 除錯指南摘要整合 🆕
- [x] 所有細節確認

### ⏳ 待執行（下一步）

- [ ] Firebase 專案建立（待指示）
- [ ] 開始產生程式碼（待指示）
- [ ] 流程圖製作

[🔝 回到目錄](#目錄)

---

## 十、文件版本紀錄

### v1.0（2026/02/06）
- 初版完成

### v2.0（2026/02/08）
- ✅ 修正題目切換機制（3秒 → 0秒）
- ✅ 修正即時回饋設計（獨立畫面 → 原畫面疊加）
- ✅ 修正完成通知時機（每題 → 場地完成時）
- ✅ 確認題目同步方式（順序一致，進度獨立）
- ✅ 確認場地切換流程（各自開始）
- ✅ 確認倒數機制（首次一起，之後各自）
- ✅ 完善加權計算系統
- ✅ 完善 Firebase 資料結構

### v3.0（2026/02/11）🆕
- ✅ 計分系統改版：加權乘法 → 答對 +1 分、額外獎勵各 +1 分
- ✅ 新增場地E：工作記憶（順向/逆向隨機、位置數量隨機）
- ✅ 新增工作記憶全對獎勵公式（逆向: n-1、順向: 分段公式）
- ✅ 多人模式新增工作記憶全域開關
- ✅ 整合配色系統完整文檔（含場地E 靛藍色）
- ✅ 整合命名規範摘要版 + 附錄連結
- ✅ 整合程式除錯指南摘要版 + 附錄連結
- ✅ 統一術語：「回合」→「遊戲場」
- ✅ 新增系統流程圖預留區域
- ✅ 每章新增「回到目錄」導航連結
- ✅ 更新 Firebase 資料結構（WM 欄位）
- ✅ 更新檔案結構（WM 相關檔案）
- ✅ 更新徽章系統（16個，含 WM 徽章）

---

## 📊 統計總覽

```
總確認項目：75+
v2.0 核心修正：6 個 ⭐
v3.0 核心修正：9 個 🆕
遊戲場數量：5 個（A~E）
計分方式：答對 +1 分，額外獎勵各 +1 分
工作記憶獎勵：逆向 n-1 / 順向 分段公式
優先順序：多人模式 > 單人模式
檔案數量：25+ 個檔案
Firebase 服務：4 個服務
儲存層次：3 層
額外獎勵種類：5 種（各 +1 分）
徽章總數：16 個
配色變數：15+ 個 CSS 變數
```

---

## 🚀 準備狀態

### 當前狀態

✅ 所有需求 100% 確認完畢  
✅ 所有核心設計已確定  
✅ 計分系統已改版（v3.0）  
✅ 工作記憶場地E 已定義  
✅ 配色系統已整合  
✅ 命名規範 + 除錯指南已整合  
✅ 檔案結構已規劃  
✅ 資料庫架構已定案

### 文件用途

```
✅ 可直接複製到新對話使用
✅ 作為開發參考文件
✅ 作為需求確認紀錄
✅ 配色系統統一管理
✅ 命名規範快速查閱
✅ 除錯策略參考
```

[🔝 回到目錄](#目錄)

---

## 十一、附錄

### 附錄A：命名規範完整版

📎 **檔案連結**：[NAMING-CONVENTION.md](NAMING-CONVENTION.md)

**內容概要**（6,100 行）：
- 完整 32 項細分命名規則
- TypeScript 型別命名、React/Vue 元件命名
- Firebase 路徑命名、API 端點命名
- 資源檔案命名、Z-Index 層級管理
- 測試屬性命名（data-testid）
- JSDoc 完整註解規範
- Git Commit 訊息規範
- 禁用清單 & 檢查清單
- 常見錯誤速查表 & FAQ
- AI 協作指南

### 附錄B：程式除錯完整指南

📎 **檔案連結**：[程式除錯完整指南.md](程式除錯完整指南.md)

**內容概要**（4,049 行）：
- Console 家族 11 種方法詳解
- Debugger 暫停 & 逐步執行
- Visual Debugging 畫面顯示系統
- Network Tab 網路偵探
- 錯誤處理機制（try-catch、全域錯誤）
- 自訂 DEBUG 工具系統
- 效能監控工具
- VS Code 整合偵錯
- Chrome DevTools 進階斷點
- 除錯思維方法論
- DCCS 遊戲專用除錯策略

### 附錄C：配色系統獨立文檔（歷史版本）

📎 **檔案連結**：[配色系統完整文檔.md](配色系統完整文檔.md)

> 本文件的配色系統已完整整合至 [四、多感官設計 → 4.4 配色系統](#44-配色系統)。
> 獨立文檔保留作為歷史參考。

---

**文件完成日期**：2026年2月11日  
**文件版本**：v3.0  
**文件作者**：小摩研究助理

---

## 📝 附註

本文件為「3-6歲聽障學齡前幼兒執行功能訓練遊戲」專案的完整需求統整文件，包含多人模式（Kahoot 風格）、單人模式、工作記憶（場地E）、配色系統、命名規範摘要、除錯指南摘要等所有設計細節。

**重要提醒**：
1. 本文件已確認所有核心設計與細節
2. 標註 ⭐ 的項目為 v2.0 修正的關鍵設計
3. 標註 🆕 的項目為 v3.0 新增/修改的設計
4. 完整的命名規範請參閱附錄A
5. 完整的除錯指南請參閱附錄B

**下一步行動**：
- 若要建立 Firebase 專案，請告知
- 若要開始產生程式碼，請告知
- 若要製作流程圖，請告知
- 若還有需要確認的細節，請提出

---

**END OF DOCUMENT**
